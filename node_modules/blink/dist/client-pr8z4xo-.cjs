const e=require(`./chunk-hhQzssFb.cjs`),t=require(`./api-DhKQVJLF.cjs`);let n=require(`zod/v4`);n=e.__toESM(n);let r=require(`zod/v3`);r=e.__toESM(r);var i=`vercel.ai.error`,a=Symbol.for(i),o,s=class e extends Error{constructor({name:e,message:t,cause:n}){super(t),this[o]=!0,this.name=e,this.cause=n}static isInstance(t){return e.hasMarker(t,i)}static hasMarker(e,t){let n=Symbol.for(t);return typeof e==`object`&&!!e&&n in e&&typeof e[n]==`boolean`&&e[n]===!0}};o=a;var c=s,l=`AI_APICallError`,u=`vercel.ai.error.${l}`,d=Symbol.for(u),f,p=class extends c{constructor({message:e,url:t,requestBodyValues:n,statusCode:r,responseHeaders:i,responseBody:a,cause:o,isRetryable:s=r!=null&&(r===408||r===409||r===429||r>=500),data:c}){super({name:l,message:e,cause:o}),this[f]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=i,this.responseBody=a,this.isRetryable=s,this.data=c}static isInstance(e){return c.hasMarker(e,u)}};f=d;var m=`AI_EmptyResponseBodyError`,h=`vercel.ai.error.${m}`,g=Symbol.for(h),_,v=class extends c{constructor({message:e=`Empty response body`}={}){super({name:m,message:e}),this[_]=!0}static isInstance(e){return c.hasMarker(e,h)}};_=g;function y(e){return e==null?`unknown error`:typeof e==`string`?e:e instanceof Error?e.message:JSON.stringify(e)}var b=`AI_InvalidArgumentError`,x=`vercel.ai.error.${b}`,S=Symbol.for(x),C,w=class extends c{constructor({message:e,cause:t,argument:n}){super({name:b,message:e,cause:t}),this[C]=!0,this.argument=n}static isInstance(e){return c.hasMarker(e,x)}};C=S;var T=`AI_InvalidPromptError`,E=`vercel.ai.error.${T}`,D=Symbol.for(E),O,k=class extends c{constructor({prompt:e,message:t,cause:n}){super({name:T,message:`Invalid prompt: ${t}`,cause:n}),this[O]=!0,this.prompt=e}static isInstance(e){return c.hasMarker(e,E)}};O=D;var A=`AI_InvalidResponseDataError`,ee=`vercel.ai.error.${A}`,te=Symbol.for(ee),j,M=class extends c{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:A,message:t}),this[j]=!0,this.data=e}static isInstance(e){return c.hasMarker(e,ee)}};j=te;var N=`AI_JSONParseError`,P=`vercel.ai.error.${N}`,ne=Symbol.for(P),re,F=class extends c{constructor({text:e,cause:t}){super({name:N,message:`JSON parsing failed: Text: ${e}.
Error message: ${y(t)}`,cause:t}),this[re]=!0,this.text=e}static isInstance(e){return c.hasMarker(e,P)}};re=ne;var ie=`AI_LoadAPIKeyError`,ae=`vercel.ai.error.${ie}`,oe=Symbol.for(ae),se,ce=class extends c{constructor({message:e}){super({name:ie,message:e}),this[se]=!0}static isInstance(e){return c.hasMarker(e,ae)}};se=oe;var le=`AI_LoadSettingError`,ue=`vercel.ai.error.${le}`,de=Symbol.for(ue),fe;fe=de;var I=`AI_NoContentGeneratedError`,pe=`vercel.ai.error.${I}`,me=Symbol.for(pe),he;he=me;var ge=`AI_NoSuchModelError`,_e=`vercel.ai.error.${ge}`,ve=Symbol.for(_e),L,ye=class extends c{constructor({errorName:e=ge,modelId:t,modelType:n,message:r=`No such ${n}: ${t}`}){super({name:e,message:r}),this[L]=!0,this.modelId=t,this.modelType=n}static isInstance(e){return c.hasMarker(e,_e)}};L=ve;var be=`AI_TooManyEmbeddingValuesForCallError`,R=`vercel.ai.error.${be}`,xe=Symbol.for(R),Se,Ce=class extends c{constructor(e){super({name:be,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Se]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return c.hasMarker(e,R)}};Se=xe;var we=`AI_TypeValidationError`,Te=`vercel.ai.error.${we}`,Ee=Symbol.for(Te),De,Oe=class e extends c{constructor({value:e,cause:t}){super({name:we,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${y(t)}`,cause:t}),this[De]=!0,this.value=e}static isInstance(e){return c.hasMarker(e,Te)}static wrap({value:t,cause:n}){return e.isInstance(n)&&n.value===t?n:new e({value:t,cause:n})}};De=Ee;var ke=Oe,Ae=`AI_UnsupportedFunctionalityError`,je=`vercel.ai.error.${Ae}`,Me=Symbol.for(je),Ne,z=class extends c{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Ae,message:t}),this[Ne]=!0,this.functionality=e}static isInstance(e){return c.hasMarker(e,je)}};Ne=Me;var Pe=class extends Error{constructor(e,t){super(e),this.name=`ParseError`,this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}};function Fe(e){}function Ie(e){if(typeof e==`function`)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:t=Fe,onError:n=Fe,onRetry:r=Fe,onComment:i}=e,a=``,o=!0,s,c=``,l=``;function u(e){let t=o?e.replace(/^\xEF\xBB\xBF/,``):e,[n,r]=Le(`${a}${t}`);for(let e of n)d(e);a=r,o=!1}function d(e){if(e===``){p();return}if(e.startsWith(`:`)){i&&i(e.slice(e.startsWith(`: `)?2:1));return}let t=e.indexOf(`:`);if(t!==-1){let n=e.slice(0,t),r=e[t+1]===` `?2:1,i=e.slice(t+r);f(n,i,e);return}f(e,``,e)}function f(e,t,i){switch(e){case`event`:l=t;break;case`data`:c=`${c}${t}
`;break;case`id`:s=t.includes(`\0`)?void 0:t;break;case`retry`:/^\d+$/.test(t)?r(parseInt(t,10)):n(new Pe(`Invalid \`retry\` value: "${t}"`,{type:`invalid-retry`,value:t,line:i}));break;default:n(new Pe(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:`unknown-field`,field:e,value:t,line:i}));break}}function p(){c.length>0&&t({id:s,event:l||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),s=void 0,c=``,l=``}function m(e={}){a&&e.consume&&d(a),o=!0,s=void 0,c=``,l=``,a=``}return{feed:u,reset:m}}function Le(e){let t=[],n=``,r=0;for(;r<e.length;){let i=e.indexOf(`\r`,r),a=e.indexOf(`
`,r),o=-1;if(i!==-1&&a!==-1?o=Math.min(i,a):i===-1?a!==-1&&(o=a):o=i===e.length-1?-1:i,o===-1){n=e.slice(r);break}else{let n=e.slice(r,o);t.push(n),r=o+1,e[r-1]===`\r`&&e[r]===`
`&&r++}}return[t,n]}var Re=class extends TransformStream{constructor({onError:e,onRetry:t,onComment:n}={}){let r;super({start(i){r=Ie({onEvent:e=>{i.enqueue(e)},onError(t){e===`terminate`?i.error(t):typeof e==`function`&&e(t)},onRetry:t,onComment:n})},transform(e){r.feed(e)}})}};function B(...e){return e.reduce((e,t)=>({...e,...t??{}}),{})}async function ze(e,t){if(e==null)return Promise.resolve();let n=t?.abortSignal;return new Promise((t,r)=>{if(n?.aborted){r(Be());return}let i=setTimeout(()=>{a(),t()},e),a=()=>{clearTimeout(i),n?.removeEventListener(`abort`,o)},o=()=>{a(),r(Be())};n?.addEventListener(`abort`,o)})}function Be(){return new DOMException(`Delay was aborted`,`AbortError`)}function Ve(e){return Object.fromEntries([...e.headers])}var He=({prefix:e,size:t=16,alphabet:n=`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz`,separator:r=`-`}={})=>{let i=()=>{let e=n.length,r=Array(t);for(let i=0;i<t;i++)r[i]=n[Math.random()*e|0];return r.join(``)};if(e==null)return i;if(n.includes(r))throw new w({argument:`separator`,message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${i()}`},V=He();function Ue(e){return e==null?`unknown error`:typeof e==`string`?e:e instanceof Error?e.message:JSON.stringify(e)}function We(e){return(e instanceof Error||e instanceof DOMException)&&(e.name===`AbortError`||e.name===`ResponseAborted`||e.name===`TimeoutError`)}var Ge=[`fetch failed`,`failed to fetch`];function Ke({error:e,url:t,requestBodyValues:n}){if(We(e))return e;if(e instanceof TypeError&&Ge.includes(e.message.toLowerCase())){let r=e.cause;if(r!=null)return new p({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:n,isRetryable:!0})}return e}function qe(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>t!=null))}var Je=()=>globalThis.fetch,Ye=async({url:e,headers:t={},successfulResponseHandler:n,failedResponseHandler:r,abortSignal:i,fetch:a=Je()})=>{try{let o=await a(e,{method:`GET`,headers:qe(t),signal:i}),s=Ve(o);if(!o.ok){let t;try{t=await r({response:o,url:e,requestBodyValues:{}})}catch(t){throw We(t)||p.isInstance(t)?t:new p({message:`Failed to process error response`,cause:t,statusCode:o.status,url:e,responseHeaders:s,requestBodyValues:{}})}throw t.value}try{return await n({response:o,url:e,requestBodyValues:{}})}catch(t){throw t instanceof Error&&(We(t)||p.isInstance(t))?t:new p({message:`Failed to process successful response`,cause:t,statusCode:o.status,url:e,responseHeaders:s,requestBodyValues:{}})}}catch(t){throw Ke({error:t,url:e,requestBodyValues:{}})}};function Xe({mediaType:e,url:t,supportedUrls:n}){return t=t.toLowerCase(),e=e.toLowerCase(),Object.entries(n).map(([e,t])=>{let n=e.toLowerCase();return n===`*`||n===`*/*`?{mediaTypePrefix:``,regexes:t}:{mediaTypePrefix:n.replace(/\*/,``),regexes:t}}).filter(({mediaTypePrefix:t})=>e.startsWith(t)).flatMap(({regexes:e})=>e).some(e=>e.test(t))}function Ze({apiKey:e,environmentVariableName:t,apiKeyParameterName:n=`apiKey`,description:r}){if(typeof e==`string`)return e;if(e!=null)throw new ce({message:`${r} API key must be a string.`});if(typeof process>`u`)throw new ce({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new ce({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if(typeof e!=`string`)throw new ce({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}function Qe({settingValue:e,environmentVariableName:t}){if(typeof e==`string`||!(e!=null||typeof process>`u`)&&(e=process.env[t],!(e==null||typeof e!=`string`)))return e}function $e(e){var t;let[n,r=``]=e.toLowerCase().split(`/`);return(t={mpeg:`mp3`,"x-wav":`wav`,opus:`ogg`,mp4:`m4a`,"x-m4a":`m4a`}[r])??r}var et=/"__proto__"\s*:/,tt=/"constructor"\s*:/;function nt(e){let t=JSON.parse(e);return typeof t!=`object`||!t||et.test(e)===!1&&tt.test(e)===!1?t:rt(t)}function rt(e){let t=[e];for(;t.length;){let e=t;t=[];for(let n of e){if(Object.prototype.hasOwnProperty.call(n,`__proto__`)||Object.prototype.hasOwnProperty.call(n,`constructor`)&&Object.prototype.hasOwnProperty.call(n.constructor,`prototype`))throw SyntaxError(`Object contains forbidden prototype property`);for(let e in n){let r=n[e];r&&typeof r==`object`&&t.push(r)}}}return e}function it(e){let{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{return nt(e)}finally{Error.stackTraceLimit=t}}var at=Symbol.for(`vercel.ai.validator`);function ot(e){return{[at]:!0,validate:e}}function st(e){return typeof e==`object`&&!!e&&at in e&&e[at]===!0&&`validate`in e}function ct(e){return st(e)?e:lt(e)}function lt(e){return ot(async t=>{let n=await e[`~standard`].validate(t);return n.issues==null?{success:!0,value:n.value}:{success:!1,error:new ke({value:t,cause:n.issues})}})}async function ut({value:e,schema:t}){let n=await dt({value:e,schema:t});if(!n.success)throw ke.wrap({value:e,cause:n.error});return n.value}async function dt({value:e,schema:t}){let n=ct(t);try{if(n.validate==null)return{success:!0,value:e,rawValue:e};let t=await n.validate(e);return t.success?{success:!0,value:t.value,rawValue:e}:{success:!1,error:ke.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:ke.wrap({value:e,cause:t}),rawValue:e}}}async function ft({text:e,schema:t}){try{let n=it(e);return t==null?n:ut({value:n,schema:t})}catch(t){throw F.isInstance(t)||ke.isInstance(t)?t:new F({text:e,cause:t})}}async function pt({text:e,schema:t}){try{let n=it(e);return t==null?{success:!0,value:n,rawValue:n}:await dt({value:n,schema:t})}catch(t){return{success:!1,error:F.isInstance(t)?t:new F({text:e,cause:t}),rawValue:void 0}}}function mt(e){try{return it(e),!0}catch{return!1}}function ht({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new Re).pipeThrough(new TransformStream({async transform({data:e},n){e!==`[DONE]`&&n.enqueue(await pt({text:e,schema:t}))}}))}async function H({provider:e,providerOptions:t,schema:n}){if(t?.[e]==null)return;let r=await dt({value:t[e],schema:n});if(!r.success)throw new w({argument:`providerOptions`,message:`invalid ${e} provider options`,cause:r.error});return r.value}var gt=()=>globalThis.fetch,U=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o})=>vt({url:e,headers:{"Content-Type":`application/json`,...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o}),_t=async({url:e,headers:t,formData:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o})=>vt({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:o}),vt=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:i,abortSignal:a,fetch:o=gt()})=>{try{let s=await o(e,{method:`POST`,headers:qe(t),body:n.content,signal:a}),c=Ve(s);if(!s.ok){let t;try{t=await i({response:s,url:e,requestBodyValues:n.values})}catch(t){throw We(t)||p.isInstance(t)?t:new p({message:`Failed to process error response`,cause:t,statusCode:s.status,url:e,responseHeaders:c,requestBodyValues:n.values})}throw t.value}try{return await r({response:s,url:e,requestBodyValues:n.values})}catch(t){throw t instanceof Error&&(We(t)||p.isInstance(t))?t:new p({message:`Failed to process successful response`,cause:t,statusCode:s.status,url:e,responseHeaders:c,requestBodyValues:n.values})}}catch(t){throw Ke({error:t,url:e,requestBodyValues:n.values})}};function yt(e){return e}function W({id:e,name:t,inputSchema:n}){return({execute:r,outputSchema:i,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c,...l})=>yt({type:`provider-defined`,id:e,name:t,args:l,inputSchema:n,outputSchema:i,execute:r,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c})}function bt({id:e,name:t,inputSchema:n,outputSchema:r}){return({execute:i,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c,...l})=>yt({type:`provider-defined`,id:e,name:t,args:l,inputSchema:n,outputSchema:r,execute:i,toModelOutput:a,onInputStart:o,onInputDelta:s,onInputAvailable:c})}async function G(e){return typeof e==`function`&&(e=e()),Promise.resolve(e)}var xt=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:i,requestBodyValues:a})=>{let o=await r.text(),s=Ve(r);if(o.trim()===``)return{responseHeaders:s,value:new p({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,isRetryable:n?.(r)})};try{let c=await ft({text:o,schema:e});return{responseHeaders:s,value:new p({message:t(c),url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,data:c,isRetryable:n?.(r,c)})}}catch{return{responseHeaders:s,value:new p({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:s,responseBody:o,isRetryable:n?.(r)})}}},St=e=>async({response:t})=>{let n=Ve(t);if(t.body==null)throw new v({});return{responseHeaders:n,value:ht({stream:t.body,schema:e})}},K=e=>async({response:t,url:n,requestBodyValues:r})=>{let i=await t.text(),a=await pt({text:i,schema:e}),o=Ve(t);if(!a.success)throw new p({message:`Invalid JSON response`,cause:a.error,statusCode:t.status,responseHeaders:o,responseBody:i,url:n,requestBodyValues:r});return{responseHeaders:o,value:a.value,rawValue:a.rawValue}},Ct=()=>async({response:e,url:t,requestBodyValues:n})=>{let r=Ve(e);if(!e.body)throw new p({message:`Response body is empty`,url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0});try{let t=await e.arrayBuffer();return{responseHeaders:r,value:new Uint8Array(t)}}catch(i){throw new p({message:`Failed to read response as array buffer`,url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0,cause:i})}},wt=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join(`/`)},Tt=Symbol(`Let zodToJsonSchema decide on which parser to use`),Et={name:void 0,$refStrategy:`root`,basePath:[`#`],effectStrategy:`input`,pipeStrategy:`all`,dateStrategy:`format:date-time`,mapStrategy:`entries`,removeAdditionalStrategy:`passthrough`,allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:`definitions`,strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:`escape`,applyRegexFlags:!1,emailStrategy:`format:email`,base64Strategy:`contentEncoding:base64`,nameStrategy:`ref`},Dt=e=>typeof e==`string`?{...Et,name:e}:{...Et,...e};function q(){return{}}function Ot(e,t){var n,i,a;let o={type:`array`};return(n=e.type)?._def&&(a=(i=e.type)?._def)?.typeName!==r.ZodFirstPartyTypeKind.ZodAny&&(o.items=X(e.type._def,{...t,currentPath:[...t.currentPath,`items`]})),e.minLength&&(o.minItems=e.minLength.value),e.maxLength&&(o.maxItems=e.maxLength.value),e.exactLength&&(o.minItems=e.exactLength.value,o.maxItems=e.exactLength.value),o}function kt(e){let t={type:`integer`,format:`int64`};if(!e.checks)return t;for(let n of e.checks)switch(n.kind){case`min`:n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case`max`:n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case`multipleOf`:t.multipleOf=n.value;break}return t}function At(){return{type:`boolean`}}function jt(e,t){return X(e.type._def,t)}var Mt=(e,t)=>X(e.innerType._def,t);function Nt(e,t,n){let r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,r)=>Nt(e,t,n))};switch(r){case`string`:case`format:date-time`:return{type:`string`,format:`date-time`};case`format:date`:return{type:`string`,format:`date`};case`integer`:return Pt(e)}}var Pt=e=>{let t={type:`integer`,format:`unix-time`};for(let n of e.checks)switch(n.kind){case`min`:t.minimum=n.value;break;case`max`:t.maximum=n.value;break}return t};function Ft(e,t){return{...X(e.innerType._def,t),default:e.defaultValue()}}function It(e,t){return t.effectStrategy===`input`?X(e.schema._def,t):q()}function Lt(e){return{type:`string`,enum:Array.from(e.values)}}var Rt=e=>`type`in e&&e.type===`string`?!1:`allOf`in e;function zt(e,t){let n=[X(e.left._def,{...t,currentPath:[...t.currentPath,`allOf`,`0`]}),X(e.right._def,{...t,currentPath:[...t.currentPath,`allOf`,`1`]})].filter(e=>!!e),r=[];return n.forEach(e=>{if(Rt(e))r.push(...e.allOf);else{let t=e;if(`additionalProperties`in e&&e.additionalProperties===!1){let{additionalProperties:n,...r}=e;t=r}r.push(t)}}),r.length?{allOf:r}:void 0}function Bt(e){let t=typeof e.value;return t!==`bigint`&&t!==`number`&&t!==`boolean`&&t!==`string`?{type:Array.isArray(e.value)?`array`:`object`}:{type:t===`bigint`?`integer`:t,const:e.value}}var Vt=void 0,J={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Vt===void 0&&(Vt=RegExp(`^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$`,`u`)),Vt),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Ht(e,t){let n={type:`string`};if(e.checks)for(let r of e.checks)switch(r.kind){case`min`:n.minLength=typeof n.minLength==`number`?Math.max(n.minLength,r.value):r.value;break;case`max`:n.maxLength=typeof n.maxLength==`number`?Math.min(n.maxLength,r.value):r.value;break;case`email`:switch(t.emailStrategy){case`format:email`:Kt(n,`email`,r.message,t);break;case`format:idn-email`:Kt(n,`idn-email`,r.message,t);break;case`pattern:zod`:Y(n,J.email,r.message,t);break}break;case`url`:Kt(n,`uri`,r.message,t);break;case`uuid`:Kt(n,`uuid`,r.message,t);break;case`regex`:Y(n,r.regex,r.message,t);break;case`cuid`:Y(n,J.cuid,r.message,t);break;case`cuid2`:Y(n,J.cuid2,r.message,t);break;case`startsWith`:Y(n,RegExp(`^${Ut(r.value,t)}`),r.message,t);break;case`endsWith`:Y(n,RegExp(`${Ut(r.value,t)}$`),r.message,t);break;case`datetime`:Kt(n,`date-time`,r.message,t);break;case`date`:Kt(n,`date`,r.message,t);break;case`time`:Kt(n,`time`,r.message,t);break;case`duration`:Kt(n,`duration`,r.message,t);break;case`length`:n.minLength=typeof n.minLength==`number`?Math.max(n.minLength,r.value):r.value,n.maxLength=typeof n.maxLength==`number`?Math.min(n.maxLength,r.value):r.value;break;case`includes`:Y(n,RegExp(Ut(r.value,t)),r.message,t);break;case`ip`:r.version!==`v6`&&Kt(n,`ipv4`,r.message,t),r.version!==`v4`&&Kt(n,`ipv6`,r.message,t);break;case`base64url`:Y(n,J.base64url,r.message,t);break;case`jwt`:Y(n,J.jwt,r.message,t);break;case`cidr`:r.version!==`v6`&&Y(n,J.ipv4Cidr,r.message,t),r.version!==`v4`&&Y(n,J.ipv6Cidr,r.message,t);break;case`emoji`:Y(n,J.emoji(),r.message,t);break;case`ulid`:Y(n,J.ulid,r.message,t);break;case`base64`:switch(t.base64Strategy){case`format:binary`:Kt(n,`binary`,r.message,t);break;case`contentEncoding:base64`:n.contentEncoding=`base64`;break;case`pattern:zod`:Y(n,J.base64,r.message,t);break}break;case`nanoid`:Y(n,J.nanoid,r.message,t);case`toLowerCase`:case`toUpperCase`:case`trim`:break;default:}return n}function Ut(e,t){return t.patternStrategy===`escape`?Gt(e):e}var Wt=new Set(`ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789`);function Gt(e){let t=``;for(let n=0;n<e.length;n++)Wt.has(e[n])||(t+=`\\`),t+=e[n];return t}function Kt(e,t,n,r){var i;e.format||(i=e.anyOf)?.some(e=>e.format)?(e.anyOf||=[],e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):e.format=t}function Y(e,t,n,r){var i;e.pattern||(i=e.allOf)?.some(e=>e.pattern)?(e.allOf||=[],e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:qt(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):e.pattern=qt(t,r)}function qt(e,t){var n;if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes(`i`),m:e.flags.includes(`m`),s:e.flags.includes(`s`)},i=r.i?e.source.toLowerCase():e.source,a=``,o=!1,s=!1,c=!1;for(let e=0;e<i.length;e++){if(o){a+=i[e],o=!1;continue}if(r.i){if(s){if(i[e].match(/[a-z]/)){c?(a+=i[e],a+=`${i[e-2]}-${i[e]}`.toUpperCase(),c=!1):i[e+1]===`-`&&(n=i[e+2])?.match(/[a-z]/)?(a+=i[e],c=!0):a+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){a+=`[${i[e]}${i[e].toUpperCase()}]`;continue}}if(r.m){if(i[e]===`^`){a+=`(^|(?<=[\r
]))`;continue}else if(i[e]===`$`){a+=`($|(?=[\r
]))`;continue}}if(r.s&&i[e]===`.`){a+=s?`${i[e]}\r
`:`[${i[e]}\r
]`;continue}a+=i[e],i[e]===`\\`?o=!0:s&&i[e]===`]`?s=!1:!s&&i[e]===`[`&&(s=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join(`/`)} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function Jt(e,t){var n,i,a,o,s,c;let l={type:`object`,additionalProperties:(n=X(e.valueType._def,{...t,currentPath:[...t.currentPath,`additionalProperties`]}))??t.allowedAdditionalProperties};if((i=e.keyType)?._def.typeName===r.ZodFirstPartyTypeKind.ZodString&&(a=e.keyType._def.checks)?.length){let{type:n,...r}=Ht(e.keyType._def,t);return{...l,propertyNames:r}}else if((o=e.keyType)?._def.typeName===r.ZodFirstPartyTypeKind.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};else if((s=e.keyType)?._def.typeName===r.ZodFirstPartyTypeKind.ZodBranded&&e.keyType._def.type._def.typeName===r.ZodFirstPartyTypeKind.ZodString&&(c=e.keyType._def.type._def.checks)?.length){let{type:n,...r}=jt(e.keyType._def,t);return{...l,propertyNames:r}}return l}function Yt(e,t){if(t.mapStrategy===`record`)return Jt(e,t);let n=X(e.keyType._def,{...t,currentPath:[...t.currentPath,`items`,`items`,`0`]})||q(),r=X(e.valueType._def,{...t,currentPath:[...t.currentPath,`items`,`items`,`1`]})||q();return{type:`array`,maxItems:125,items:{type:`array`,items:[n,r],minItems:2,maxItems:2}}}function Xt(e){let t=e.values,n=Object.keys(e.values).filter(e=>typeof t[t[e]]!=`number`),r=n.map(e=>t[e]),i=Array.from(new Set(r.map(e=>typeof e)));return{type:i.length===1?i[0]===`string`?`string`:`number`:[`string`,`number`],enum:r}}function Zt(){return{not:q()}}function Qt(){return{type:`null`}}var $t={ZodString:`string`,ZodNumber:`number`,ZodBigInt:`integer`,ZodBoolean:`boolean`,ZodNull:`null`};function en(e,t){let n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(e=>e._def.typeName in $t&&(!e._def.checks||!e._def.checks.length))){let e=n.reduce((e,t)=>{let n=$t[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}else if(n.every(e=>e._def.typeName===`ZodLiteral`&&!e.description)){let e=n.reduce((e,t)=>{let n=typeof t._def.value;switch(n){case`string`:case`number`:case`boolean`:return[...e,n];case`bigint`:return[...e,`integer`];case`object`:if(t._def.value===null)return[...e,`null`];case`symbol`:case`undefined`:case`function`:default:return e}},[]);if(e.length===n.length){let t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:n.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(n.every(e=>e._def.typeName===`ZodEnum`))return{type:`string`,enum:n.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return tn(e,t)}var tn=(e,t)=>{let n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,n)=>X(e._def,{...t,currentPath:[...t.currentPath,`anyOf`,`${n}`]})).filter(e=>!!e&&(!t.strictUnions||typeof e==`object`&&Object.keys(e).length>0));return n.length?{anyOf:n}:void 0};function nn(e,t){if([`ZodString`,`ZodNumber`,`ZodBigInt`,`ZodBoolean`,`ZodNull`].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[$t[e.innerType._def.typeName],`null`]};let n=X(e.innerType._def,{...t,currentPath:[...t.currentPath,`anyOf`,`0`]});return n&&{anyOf:[n,{type:`null`}]}}function rn(e){let t={type:`number`};if(!e.checks)return t;for(let n of e.checks)switch(n.kind){case`int`:t.type=`integer`;break;case`min`:n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case`max`:n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case`multipleOf`:t.multipleOf=n.value;break}return t}function an(e,t){let n={type:`object`,properties:{}},r=[],i=e.shape();for(let e in i){let a=i[e];if(a===void 0||a._def===void 0)continue;let o=sn(a),s=X(a._def,{...t,currentPath:[...t.currentPath,`properties`,e],propertyPath:[...t.currentPath,`properties`,e]});if(s===void 0)continue;n.properties[e]=s,o||r.push(e)}r.length&&(n.required=r);let a=on(e,t);return a!==void 0&&(n.additionalProperties=a),n}function on(e,t){if(e.catchall._def.typeName!==`ZodNever`)return X(e.catchall._def,{...t,currentPath:[...t.currentPath,`additionalProperties`]});switch(e.unknownKeys){case`passthrough`:return t.allowedAdditionalProperties;case`strict`:return t.rejectedAdditionalProperties;case`strip`:return t.removeAdditionalStrategy===`strict`?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function sn(e){try{return e.isOptional()}catch{return!0}}var cn=(e,t)=>{var n;if(t.currentPath.toString()===(n=t.propertyPath)?.toString())return X(e.innerType._def,t);let r=X(e.innerType._def,{...t,currentPath:[...t.currentPath,`anyOf`,`1`]});return r?{anyOf:[{not:q()},r]}:q()},ln=(e,t)=>{if(t.pipeStrategy===`input`)return X(e.in._def,t);if(t.pipeStrategy===`output`)return X(e.out._def,t);let n=X(e.in._def,{...t,currentPath:[...t.currentPath,`allOf`,`0`]}),r=X(e.out._def,{...t,currentPath:[...t.currentPath,`allOf`,n?`1`:`0`]});return{allOf:[n,r].filter(e=>e!==void 0)}};function un(e,t){return X(e.type._def,t)}function dn(e,t){let n=X(e.valueType._def,{...t,currentPath:[...t.currentPath,`items`]}),r={type:`array`,uniqueItems:!0,items:n};return e.minSize&&(r.minItems=e.minSize.value),e.maxSize&&(r.maxItems=e.maxSize.value),r}function fn(e,t){return e.rest?{type:`array`,minItems:e.items.length,items:e.items.map((e,n)=>X(e._def,{...t,currentPath:[...t.currentPath,`items`,`${n}`]})).reduce((e,t)=>t===void 0?e:[...e,t],[]),additionalItems:X(e.rest._def,{...t,currentPath:[...t.currentPath,`additionalItems`]})}:{type:`array`,minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,n)=>X(e._def,{...t,currentPath:[...t.currentPath,`items`,`${n}`]})).reduce((e,t)=>t===void 0?e:[...e,t],[])}}function pn(){return{not:q()}}function mn(){return q()}var hn=(e,t)=>X(e.innerType._def,t),gn=(e,t,n)=>{switch(t){case r.ZodFirstPartyTypeKind.ZodString:return Ht(e,n);case r.ZodFirstPartyTypeKind.ZodNumber:return rn(e);case r.ZodFirstPartyTypeKind.ZodObject:return an(e,n);case r.ZodFirstPartyTypeKind.ZodBigInt:return kt(e);case r.ZodFirstPartyTypeKind.ZodBoolean:return At();case r.ZodFirstPartyTypeKind.ZodDate:return Nt(e,n);case r.ZodFirstPartyTypeKind.ZodUndefined:return pn();case r.ZodFirstPartyTypeKind.ZodNull:return Qt();case r.ZodFirstPartyTypeKind.ZodArray:return Ot(e,n);case r.ZodFirstPartyTypeKind.ZodUnion:case r.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return en(e,n);case r.ZodFirstPartyTypeKind.ZodIntersection:return zt(e,n);case r.ZodFirstPartyTypeKind.ZodTuple:return fn(e,n);case r.ZodFirstPartyTypeKind.ZodRecord:return Jt(e,n);case r.ZodFirstPartyTypeKind.ZodLiteral:return Bt(e);case r.ZodFirstPartyTypeKind.ZodEnum:return Lt(e);case r.ZodFirstPartyTypeKind.ZodNativeEnum:return Xt(e);case r.ZodFirstPartyTypeKind.ZodNullable:return nn(e,n);case r.ZodFirstPartyTypeKind.ZodOptional:return cn(e,n);case r.ZodFirstPartyTypeKind.ZodMap:return Yt(e,n);case r.ZodFirstPartyTypeKind.ZodSet:return dn(e,n);case r.ZodFirstPartyTypeKind.ZodLazy:return()=>e.getter()._def;case r.ZodFirstPartyTypeKind.ZodPromise:return un(e,n);case r.ZodFirstPartyTypeKind.ZodNaN:case r.ZodFirstPartyTypeKind.ZodNever:return Zt();case r.ZodFirstPartyTypeKind.ZodEffects:return It(e,n);case r.ZodFirstPartyTypeKind.ZodAny:return q();case r.ZodFirstPartyTypeKind.ZodUnknown:return mn();case r.ZodFirstPartyTypeKind.ZodDefault:return Ft(e,n);case r.ZodFirstPartyTypeKind.ZodBranded:return jt(e,n);case r.ZodFirstPartyTypeKind.ZodReadonly:return hn(e,n);case r.ZodFirstPartyTypeKind.ZodCatch:return Mt(e,n);case r.ZodFirstPartyTypeKind.ZodPipeline:return ln(e,n);case r.ZodFirstPartyTypeKind.ZodFunction:case r.ZodFirstPartyTypeKind.ZodVoid:case r.ZodFirstPartyTypeKind.ZodSymbol:return;default:return(e=>void 0)(t)}};function X(e,t,n=!1){var r;let i=t.seen.get(e);if(t.override){let a=(r=t.override)?.call(t,e,t,i,n);if(a!==Tt)return a}if(i&&!n){let e=_n(i,t);if(e!==void 0)return e}let a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);let o=gn(e,e.typeName,t),s=typeof o==`function`?X(o(),t):o;if(s&&vn(e,t,s),t.postProcess){let n=t.postProcess(s,e,t);return a.jsonSchema=s,n}return a.jsonSchema=s,s}var _n=(e,t)=>{switch(t.$refStrategy){case`root`:return{$ref:e.path.join(`/`)};case`relative`:return{$ref:wt(t.currentPath,e.path)};case`none`:case`seen`:return e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join(`/`)}! Defaulting to any`),q()):t.$refStrategy===`seen`?q():void 0}},vn=(e,t,n)=>(e.description&&(n.description=e.description),n),yn=e=>{let t=Dt(e),n=t.name===void 0?t.basePath:[...t.basePath,t.definitionPath,t.name];return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}},bn=(e,t)=>{var n;let r=yn(t),i=typeof t==`object`&&t.definitions?Object.entries(t.definitions).reduce((e,[t,n])=>{var i;return{...e,[t]:(i=X(n._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0))??q()}},{}):void 0,a=typeof t==`string`?t:t?.nameStrategy===`title`?void 0:t?.name,o=(n=X(e._def,a===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,a]},!1))??q(),s=typeof t==`object`&&t.name!==void 0&&t.nameStrategy===`title`?t.name:void 0;s!==void 0&&(o.title=s);let c=a===void 0?i?{...o,[r.definitionPath]:i}:o:{$ref:[...r.$refStrategy===`relative`?[]:r.basePath,r.definitionPath,a].join(`/`),[r.definitionPath]:{...i,[a]:o}};return c.$schema=`http://json-schema.org/draft-07/schema#`,c},xn=bn;function Sn(e,t){var n;let r=(n=t?.useReferences)??!1;return Dn(xn(e,{$refStrategy:r?`root`:`none`}),{validate:async t=>{let n=await e.safeParseAsync(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}function Cn(e,t){var r;let i=(r=t?.useReferences)??!1,a=n.toJSONSchema(e,{target:`draft-7`,io:`output`,reused:i?`ref`:`inline`});return Dn(a,{validate:async t=>{let r=await n.safeParseAsync(e,t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function wn(e){return`_zod`in e}function Tn(e,t){return wn(e)?Cn(e,t):Sn(e,t)}var En=Symbol.for(`vercel.ai.schema`);function Dn(e,{validate:t}={}){return{[En]:!0,_type:void 0,[at]:!0,jsonSchema:e,validate:t}}function On(e){return typeof e==`object`&&!!e&&En in e&&e[En]===!0&&`jsonSchema`in e&&`validate`in e}function kn(e){return e==null?Dn({properties:{},additionalProperties:!1}):On(e)?e:Tn(e)}var{btoa:An,atob:jn}=globalThis;function Mn(e){let t=e.replace(/-/g,`+`).replace(/_/g,`/`),n=jn(t);return Uint8Array.from(n,e=>e.codePointAt(0))}function Nn(e){let t=``;for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return An(t)}function Pn(e){return e instanceof Uint8Array?Nn(e):e}function Fn(e){return e?.replace(/\/$/,``)}function In(e){return e!=null&&typeof e[Symbol.asyncIterator]==`function`}async function*Ln({execute:e,input:t,options:n}){let r=e(t,n);if(In(r)){let e;for await(let t of r)e=t,yield{type:`preliminary`,output:t};yield{type:`final`,output:e}}else yield{type:`final`,output:await r}}var Rn=n.z.object({error:n.z.object({message:n.z.string(),type:n.z.string().nullish(),param:n.z.any().nullish(),code:n.z.union([n.z.string(),n.z.number()]).nullish()})}),zn=xt({errorSchema:Rn,errorToMessage:e=>e.error.message});function Bn({prompt:e,systemMessageMode:t=`system`}){let n=[],r=[];for(let{role:i,content:a}of e)switch(i){case`system`:switch(t){case`system`:n.push({role:`system`,content:a});break;case`developer`:n.push({role:`developer`,content:a});break;case`remove`:r.push({type:`other`,message:`system messages are removed for this model`});break;default:{let e=t;throw Error(`Unsupported system message mode: ${e}`)}}break;case`user`:if(a.length===1&&a[0].type===`text`){n.push({role:`user`,content:a[0].text});break}n.push({role:`user`,content:a.map((e,t)=>{var n,r,i;switch(e.type){case`text`:return{type:`text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`image_url`,image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${Pn(e.data)}`,detail:(r=(n=e.providerOptions)?.openai)?.imageDetail}}}else if(e.mediaType.startsWith(`audio/`)){if(e.data instanceof URL)throw new z({functionality:`audio file parts with URLs`});switch(e.mediaType){case`audio/wav`:return{type:`input_audio`,input_audio:{data:Pn(e.data),format:`wav`}};case`audio/mp3`:case`audio/mpeg`:return{type:`input_audio`,input_audio:{data:Pn(e.data),format:`mp3`}};default:throw new z({functionality:`audio content parts with media type ${e.mediaType}`})}}else if(e.mediaType===`application/pdf`){if(e.data instanceof URL)throw new z({functionality:`PDF file parts with URLs`});return{type:`file`,file:typeof e.data==`string`&&e.data.startsWith(`file-`)?{file_id:e.data}:{filename:(i=e.filename)??`part-${t}.pdf`,file_data:`data:application/pdf;base64,${Pn(e.data)}`}}}else throw new z({functionality:`file part media type ${e.mediaType}`})}})});break;case`assistant`:{let e=``,t=[];for(let n of a)switch(n.type){case`text`:e+=n.text;break;case`tool-call`:t.push({id:n.toolCallId,type:`function`,function:{name:n.toolName,arguments:JSON.stringify(n.input)}});break}n.push({role:`assistant`,content:e,tool_calls:t.length>0?t:void 0});break}case`tool`:for(let e of a){let t=e.output,r;switch(t.type){case`text`:case`error-text`:r=t.value;break;case`content`:case`json`:case`error-json`:r=JSON.stringify(t.value);break}n.push({role:`tool`,tool_call_id:e.toolCallId,content:r})}break;default:{let e=i;throw Error(`Unsupported role: ${e}`)}}return{messages:n,warnings:r}}function Vn({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n==null?void 0:new Date(n*1e3)}}function Hn(e){switch(e){case`stop`:return`stop`;case`length`:return`length`;case`content_filter`:return`content-filter`;case`function_call`:case`tool_calls`:return`tool-calls`;default:return`unknown`}}var Un=n.z.object({logitBias:n.z.record(n.z.coerce.number(),n.z.number()).optional(),logprobs:n.z.union([n.z.boolean(),n.z.number()]).optional(),parallelToolCalls:n.z.boolean().optional(),user:n.z.string().optional(),reasoningEffort:n.z.enum([`minimal`,`low`,`medium`,`high`]).optional(),maxCompletionTokens:n.z.number().optional(),store:n.z.boolean().optional(),metadata:n.z.record(n.z.string().max(64),n.z.string().max(512)).optional(),prediction:n.z.record(n.z.string(),n.z.any()).optional(),structuredOutputs:n.z.boolean().optional(),serviceTier:n.z.enum([`auto`,`flex`,`priority`]).optional(),strictJsonSchema:n.z.boolean().optional(),textVerbosity:n.z.enum([`low`,`medium`,`high`]).optional(),promptCacheKey:n.z.string().optional(),safetyIdentifier:n.z.string().optional()}),Wn=n.z.object({key:n.z.string(),type:n.z.enum([`eq`,`ne`,`gt`,`gte`,`lt`,`lte`]),value:n.z.union([n.z.string(),n.z.number(),n.z.boolean()])}),Gn=n.z.object({type:n.z.enum([`and`,`or`]),filters:n.z.array(n.z.union([Wn,n.z.lazy(()=>Gn)]))}),Kn=n.z.union([Wn,Gn]),qn=n.z.object({vectorStoreIds:n.z.array(n.z.string()).optional(),maxNumResults:n.z.number().optional(),ranking:n.z.object({ranker:n.z.enum([`auto`,`default-2024-08-21`]).optional()}).optional(),filters:Kn.optional()}),Jn=W({id:`openai.file_search`,name:`file_search`,inputSchema:n.z.object({query:n.z.string()})}),Yn=n.z.object({searchContextSize:n.z.enum([`low`,`medium`,`high`]).optional(),userLocation:n.z.object({type:n.z.literal(`approximate`),country:n.z.string().optional(),city:n.z.string().optional(),region:n.z.string().optional(),timezone:n.z.string().optional()}).optional()}),Xn=W({id:`openai.web_search_preview`,name:`web_search_preview`,inputSchema:n.z.object({action:n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`search`),query:n.z.string().nullish()}),n.z.object({type:n.z.literal(`open_page`),url:n.z.string()}),n.z.object({type:n.z.literal(`find`),url:n.z.string(),pattern:n.z.string()})]).nullish()})});function Zn({tools:e,toolChoice:t,structuredOutputs:n,strictJsonSchema:r}){e=e?.length?e:void 0;let i=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:i};let a=[];for(let t of e)switch(t.type){case`function`:a.push({type:`function`,function:{name:t.name,description:t.description,parameters:t.inputSchema,strict:n?r:void 0}});break;case`provider-defined`:switch(t.id){case`openai.file_search`:{let e=qn.parse(t.args);a.push({type:`file_search`,vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker}:void 0,filters:e.filters});break}case`openai.web_search_preview`:{let e=Yn.parse(t.args);a.push({type:`web_search_preview`,search_context_size:e.searchContextSize,user_location:e.userLocation});break}default:i.push({type:`unsupported-tool`,tool:t});break}break;default:i.push({type:`unsupported-tool`,tool:t});break}if(t==null)return{tools:a,toolChoice:void 0,toolWarnings:i};let o=t.type;switch(o){case`auto`:case`none`:case`required`:return{tools:a,toolChoice:o,toolWarnings:i};case`tool`:return{tools:a,toolChoice:{type:`function`,function:{name:t.toolName}},toolWarnings:i};default:{let e=o;throw new z({functionality:`tool choice type: ${e}`})}}}var Qn=class{constructor(e,t){this.specificationVersion=`v2`,this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,tools:u,toolChoice:d,providerOptions:f}){var p,m,h,g;let _=[],v=(p=await H({provider:`openai`,providerOptions:f,schema:Un}))??{},y=(m=v.structuredOutputs)??!0;i!=null&&_.push({type:`unsupported-setting`,setting:`topK`}),c?.type===`json`&&c.schema!=null&&!y&&_.push({type:`unsupported-setting`,setting:`responseFormat`,details:`JSON response format schema is only supported with structuredOutputs`});let{messages:b,warnings:x}=Bn({prompt:e,systemMessageMode:ar(this.modelId)});_.push(...x);let S=(h=v.strictJsonSchema)??!1,C={model:this.modelId,logit_bias:v.logitBias,logprobs:v.logprobs===!0||typeof v.logprobs==`number`?!0:void 0,top_logprobs:typeof v.logprobs==`number`?v.logprobs:typeof v.logprobs==`boolean`&&v.logprobs?0:void 0,user:v.user,parallel_tool_calls:v.parallelToolCalls,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:o,response_format:c?.type===`json`?y&&c.schema!=null?{type:`json_schema`,json_schema:{schema:c.schema,strict:S,name:(g=c.name)??`response`,description:c.description}}:{type:`json_object`}:void 0,stop:s,seed:l,verbosity:v.textVerbosity,max_completion_tokens:v.maxCompletionTokens,store:v.store,metadata:v.metadata,prediction:v.prediction,reasoning_effort:v.reasoningEffort,service_tier:v.serviceTier,prompt_cache_key:v.promptCacheKey,safety_identifier:v.safetyIdentifier,messages:b};nr(this.modelId)?(C.temperature!=null&&(C.temperature=void 0,_.push({type:`unsupported-setting`,setting:`temperature`,details:`temperature is not supported for reasoning models`})),C.top_p!=null&&(C.top_p=void 0,_.push({type:`unsupported-setting`,setting:`topP`,details:`topP is not supported for reasoning models`})),C.frequency_penalty!=null&&(C.frequency_penalty=void 0,_.push({type:`unsupported-setting`,setting:`frequencyPenalty`,details:`frequencyPenalty is not supported for reasoning models`})),C.presence_penalty!=null&&(C.presence_penalty=void 0,_.push({type:`unsupported-setting`,setting:`presencePenalty`,details:`presencePenalty is not supported for reasoning models`})),C.logit_bias!=null&&(C.logit_bias=void 0,_.push({type:`other`,message:`logitBias is not supported for reasoning models`})),C.logprobs!=null&&(C.logprobs=void 0,_.push({type:`other`,message:`logprobs is not supported for reasoning models`})),C.top_logprobs!=null&&(C.top_logprobs=void 0,_.push({type:`other`,message:`topLogprobs is not supported for reasoning models`})),C.max_tokens!=null&&(C.max_completion_tokens??=C.max_tokens,C.max_tokens=void 0)):(this.modelId.startsWith(`gpt-4o-search-preview`)||this.modelId.startsWith(`gpt-4o-mini-search-preview`))&&C.temperature!=null&&(C.temperature=void 0,_.push({type:`unsupported-setting`,setting:`temperature`,details:`temperature is not supported for the search preview models and has been removed.`})),v.serviceTier===`flex`&&!rr(this.modelId)&&(_.push({type:`unsupported-setting`,setting:`serviceTier`,details:`flex processing is only available for o3, o4-mini, and gpt-5 models`}),C.service_tier=void 0),v.serviceTier===`priority`&&!ir(this.modelId)&&(_.push({type:`unsupported-setting`,setting:`serviceTier`,details:`priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported`}),C.service_tier=void 0);let{tools:w,toolChoice:T,toolWarnings:E}=Zn({tools:u,toolChoice:d,structuredOutputs:y,strictJsonSchema:S});return{args:{...C,tools:w,tool_choice:T},warnings:[..._,...E]}}async doGenerate(e){var t,n,r,i,a,o,s,c,l,u,d,f,p,m;let{args:h,warnings:g}=await this.getArgs(e),{responseHeaders:_,value:v,rawValue:y}=await U({url:this.config.url({path:`/chat/completions`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:h,failedResponseHandler:zn,successfulResponseHandler:K(er),abortSignal:e.abortSignal,fetch:this.config.fetch}),b=v.choices[0],x=[],S=b.message.content;S!=null&&S.length>0&&x.push({type:`text`,text:S});for(let e of(t=b.message.tool_calls)??[])x.push({type:`tool-call`,toolCallId:(n=e.id)??V(),toolName:e.function.name,input:e.function.arguments});for(let e of(r=b.message.annotations)??[])x.push({type:`source`,sourceType:`url`,id:V(),url:e.url,title:e.title});let C=(i=v.usage)?.completion_tokens_details,w=(a=v.usage)?.prompt_tokens_details,T={openai:{}};return C?.accepted_prediction_tokens!=null&&(T.openai.acceptedPredictionTokens=C?.accepted_prediction_tokens),C?.rejected_prediction_tokens!=null&&(T.openai.rejectedPredictionTokens=C?.rejected_prediction_tokens),(o=b.logprobs)?.content!=null&&(T.openai.logprobs=b.logprobs.content),{content:x,finishReason:Hn(b.finish_reason),usage:{inputTokens:(c=(s=v.usage)?.prompt_tokens)??void 0,outputTokens:(u=(l=v.usage)?.completion_tokens)??void 0,totalTokens:(f=(d=v.usage)?.total_tokens)??void 0,reasoningTokens:(p=C?.reasoning_tokens)??void 0,cachedInputTokens:(m=w?.cached_tokens)??void 0},request:{body:h},response:{...Vn(v),headers:_,body:y},warnings:g,providerMetadata:T}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await U({url:this.config.url({path:`/chat/completions`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:r,failedResponseHandler:zn,successfulResponseHandler:St(tr),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=[],s=`unknown`,c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l=!0,u=!1,d={openai:{}};return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){var r,i,a,f,p,m,h,g,_,v,y,b,x,S,C,w,T,E,D,O,k,A,ee,te;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){s=`error`,n.enqueue({type:`error`,error:t.error});return}let j=t.value;if(`error`in j){s=`error`,n.enqueue({type:`error`,error:j.error});return}l&&(l=!1,n.enqueue({type:`response-metadata`,...Vn(j)})),j.usage!=null&&(c.inputTokens=(r=j.usage.prompt_tokens)??void 0,c.outputTokens=(i=j.usage.completion_tokens)??void 0,c.totalTokens=(a=j.usage.total_tokens)??void 0,c.reasoningTokens=(p=(f=j.usage.completion_tokens_details)?.reasoning_tokens)??void 0,c.cachedInputTokens=(h=(m=j.usage.prompt_tokens_details)?.cached_tokens)??void 0,(g=j.usage.completion_tokens_details)?.accepted_prediction_tokens!=null&&(d.openai.acceptedPredictionTokens=(_=j.usage.completion_tokens_details)?.accepted_prediction_tokens),(v=j.usage.completion_tokens_details)?.rejected_prediction_tokens!=null&&(d.openai.rejectedPredictionTokens=(y=j.usage.completion_tokens_details)?.rejected_prediction_tokens));let N=j.choices[0];if(N?.finish_reason!=null&&(s=Hn(N.finish_reason)),(b=N?.logprobs)?.content!=null&&(d.openai.logprobs=N.logprobs.content),N?.delta==null)return;let P=N.delta;if(P.content!=null&&(u||=(n.enqueue({type:`text-start`,id:`0`}),!0),n.enqueue({type:`text-delta`,id:`0`,delta:P.content})),P.tool_calls!=null)for(let e of P.tool_calls){let t=e.index;if(o[t]==null){if(e.type!==`function`)throw new M({data:e,message:`Expected 'function' type.`});if(e.id==null)throw new M({data:e,message:`Expected 'id' to be a string.`});if((x=e.function)?.name==null)throw new M({data:e,message:`Expected 'function.name' to be a string.`});n.enqueue({type:`tool-input-start`,id:e.id,toolName:e.function.name}),o[t]={id:e.id,type:`function`,function:{name:e.function.name,arguments:(S=e.function.arguments)??``},hasFinished:!1};let r=o[t];(C=r.function)?.name!=null&&(w=r.function)?.arguments!=null&&(r.function.arguments.length>0&&n.enqueue({type:`tool-input-delta`,id:r.id,delta:r.function.arguments}),mt(r.function.arguments)&&(n.enqueue({type:`tool-input-end`,id:r.id}),n.enqueue({type:`tool-call`,toolCallId:(T=r.id)??V(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0));continue}let r=o[t];if(r.hasFinished)continue;(E=e.function)?.arguments!=null&&(r.function.arguments+=(O=(D=e.function)?.arguments)??``),n.enqueue({type:`tool-input-delta`,id:r.id,delta:(k=e.function.arguments)??``}),(A=r.function)?.name!=null&&(ee=r.function)?.arguments!=null&&mt(r.function.arguments)&&(n.enqueue({type:`tool-input-end`,id:r.id}),n.enqueue({type:`tool-call`,toolCallId:(te=r.id)??V(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0)}if(P.annotations!=null)for(let e of P.annotations)n.enqueue({type:`source`,sourceType:`url`,id:V(),url:e.url,title:e.title})},flush(e){u&&e.enqueue({type:`text-end`,id:`0`}),e.enqueue({type:`finish`,finishReason:s,usage:c,...d==null?{}:{providerMetadata:d}})}})),request:{body:r},response:{headers:i}}}},$n=n.z.object({prompt_tokens:n.z.number().nullish(),completion_tokens:n.z.number().nullish(),total_tokens:n.z.number().nullish(),prompt_tokens_details:n.z.object({cached_tokens:n.z.number().nullish()}).nullish(),completion_tokens_details:n.z.object({reasoning_tokens:n.z.number().nullish(),accepted_prediction_tokens:n.z.number().nullish(),rejected_prediction_tokens:n.z.number().nullish()}).nullish()}).nullish(),er=n.z.object({id:n.z.string().nullish(),created:n.z.number().nullish(),model:n.z.string().nullish(),choices:n.z.array(n.z.object({message:n.z.object({role:n.z.literal(`assistant`).nullish(),content:n.z.string().nullish(),tool_calls:n.z.array(n.z.object({id:n.z.string().nullish(),type:n.z.literal(`function`),function:n.z.object({name:n.z.string(),arguments:n.z.string()})})).nullish(),annotations:n.z.array(n.z.object({type:n.z.literal(`url_citation`),start_index:n.z.number(),end_index:n.z.number(),url:n.z.string(),title:n.z.string()})).nullish()}),index:n.z.number(),logprobs:n.z.object({content:n.z.array(n.z.object({token:n.z.string(),logprob:n.z.number(),top_logprobs:n.z.array(n.z.object({token:n.z.string(),logprob:n.z.number()}))})).nullish()}).nullish(),finish_reason:n.z.string().nullish()})),usage:$n}),tr=n.z.union([n.z.object({id:n.z.string().nullish(),created:n.z.number().nullish(),model:n.z.string().nullish(),choices:n.z.array(n.z.object({delta:n.z.object({role:n.z.enum([`assistant`]).nullish(),content:n.z.string().nullish(),tool_calls:n.z.array(n.z.object({index:n.z.number(),id:n.z.string().nullish(),type:n.z.literal(`function`).nullish(),function:n.z.object({name:n.z.string().nullish(),arguments:n.z.string().nullish()})})).nullish(),annotations:n.z.array(n.z.object({type:n.z.literal(`url_citation`),start_index:n.z.number(),end_index:n.z.number(),url:n.z.string(),title:n.z.string()})).nullish()}).nullish(),logprobs:n.z.object({content:n.z.array(n.z.object({token:n.z.string(),logprob:n.z.number(),top_logprobs:n.z.array(n.z.object({token:n.z.string(),logprob:n.z.number()}))})).nullish()}).nullish(),finish_reason:n.z.string().nullish(),index:n.z.number()})),usage:$n}),Rn]);function nr(e){return(e.startsWith(`o`)||e.startsWith(`gpt-5`))&&!e.startsWith(`gpt-5-chat`)}function rr(e){return e.startsWith(`o3`)||e.startsWith(`o4-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-chat`)}function ir(e){return e.startsWith(`gpt-4`)||e.startsWith(`gpt-5-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-nano`)&&!e.startsWith(`gpt-5-chat`)||e.startsWith(`o3`)||e.startsWith(`o4-mini`)}function ar(e){var t,n;return nr(e)?(n=(t=or[e])?.systemMessageMode)??`developer`:`system`}var or={"o1-mini":{systemMessageMode:`remove`},"o1-mini-2024-09-12":{systemMessageMode:`remove`},"o1-preview":{systemMessageMode:`remove`},"o1-preview-2024-09-12":{systemMessageMode:`remove`},o3:{systemMessageMode:`developer`},"o3-2025-04-16":{systemMessageMode:`developer`},"o3-mini":{systemMessageMode:`developer`},"o3-mini-2025-01-31":{systemMessageMode:`developer`},"o4-mini":{systemMessageMode:`developer`},"o4-mini-2025-04-16":{systemMessageMode:`developer`}};function sr({prompt:e,user:t=`user`,assistant:n=`assistant`}){let r=``;e[0].role===`system`&&(r+=`${e[0].content}

`,e=e.slice(1));for(let{role:i,content:a}of e)switch(i){case`system`:throw new k({message:"Unexpected system message in prompt: ${content}",prompt:e});case`user`:{let e=a.map(e=>{switch(e.type){case`text`:return e.text}}).filter(Boolean).join(``);r+=`${t}:
${e}

`;break}case`assistant`:{let e=a.map(e=>{switch(e.type){case`text`:return e.text;case`tool-call`:throw new z({functionality:`tool-call messages`})}}).join(``);r+=`${n}:
${e}

`;break}case`tool`:throw new z({functionality:`tool messages`});default:{let e=i;throw Error(`Unsupported role: ${e}`)}}return r+=`${n}:
`,{prompt:r,stopSequences:[`
${t}:`]}}function cr({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n==null?void 0:new Date(n*1e3)}}function lr(e){switch(e){case`stop`:return`stop`;case`length`:return`length`;case`content_filter`:return`content-filter`;case`function_call`:case`tool_calls`:return`tool-calls`;default:return`unknown`}}var ur=n.z.object({echo:n.z.boolean().optional(),logitBias:n.z.record(n.z.string(),n.z.number()).optional(),suffix:n.z.string().optional(),user:n.z.string().optional(),logprobs:n.z.union([n.z.boolean(),n.z.number()]).optional()}),dr=class{constructor(e,t){this.specificationVersion=`v2`,this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(`.`)[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,tools:l,toolChoice:u,seed:d,providerOptions:f}){let p=[],m={...await H({provider:`openai`,providerOptions:f,schema:ur}),...await H({provider:this.providerOptionsName,providerOptions:f,schema:ur})};i!=null&&p.push({type:`unsupported-setting`,setting:`topK`}),l?.length&&p.push({type:`unsupported-setting`,setting:`tools`}),u!=null&&p.push({type:`unsupported-setting`,setting:`toolChoice`}),c!=null&&c.type!==`text`&&p.push({type:`unsupported-setting`,setting:`responseFormat`,details:`JSON response format is not supported.`});let{prompt:h,stopSequences:g}=sr({prompt:e}),_=[...g??[],...s??[]];return{args:{model:this.modelId,echo:m.echo,logit_bias:m.logitBias,logprobs:m?.logprobs===!0?0:m?.logprobs===!1?void 0:m?.logprobs,suffix:m.suffix,user:m.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:o,seed:d,prompt:h,stop:_.length>0?_:void 0},warnings:p}}async doGenerate(e){var t,n,r;let{args:i,warnings:a}=await this.getArgs(e),{responseHeaders:o,value:s,rawValue:c}=await U({url:this.config.url({path:`/completions`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:i,failedResponseHandler:zn,successfulResponseHandler:K(pr),abortSignal:e.abortSignal,fetch:this.config.fetch}),l=s.choices[0],u={openai:{}};return l.logprobs!=null&&(u.openai.logprobs=l.logprobs),{content:[{type:`text`,text:l.text}],usage:{inputTokens:(t=s.usage)?.prompt_tokens,outputTokens:(n=s.usage)?.completion_tokens,totalTokens:(r=s.usage)?.total_tokens},finishReason:lr(l.finish_reason),request:{body:i},response:{...cr(s),headers:o,body:c},providerMetadata:u,warnings:a}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await U({url:this.config.url({path:`/completions`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:r,failedResponseHandler:zn,successfulResponseHandler:St(mr),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=`unknown`,s={openai:{}},c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l=!0;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){o=`error`,n.enqueue({type:`error`,error:t.error});return}let r=t.value;if(`error`in r){o=`error`,n.enqueue({type:`error`,error:r.error});return}l&&(l=!1,n.enqueue({type:`response-metadata`,...cr(r)}),n.enqueue({type:`text-start`,id:`0`})),r.usage!=null&&(c.inputTokens=r.usage.prompt_tokens,c.outputTokens=r.usage.completion_tokens,c.totalTokens=r.usage.total_tokens);let i=r.choices[0];i?.finish_reason!=null&&(o=lr(i.finish_reason)),i?.logprobs!=null&&(s.openai.logprobs=i.logprobs),i?.text!=null&&i.text.length>0&&n.enqueue({type:`text-delta`,id:`0`,delta:i.text})},flush(e){l||e.enqueue({type:`text-end`,id:`0`}),e.enqueue({type:`finish`,finishReason:o,providerMetadata:s,usage:c})}})),request:{body:r},response:{headers:i}}}},fr=n.z.object({prompt_tokens:n.z.number(),completion_tokens:n.z.number(),total_tokens:n.z.number()}),pr=n.z.object({id:n.z.string().nullish(),created:n.z.number().nullish(),model:n.z.string().nullish(),choices:n.z.array(n.z.object({text:n.z.string(),finish_reason:n.z.string(),logprobs:n.z.object({tokens:n.z.array(n.z.string()),token_logprobs:n.z.array(n.z.number()),top_logprobs:n.z.array(n.z.record(n.z.string(),n.z.number())).nullish()}).nullish()})),usage:fr.nullish()}),mr=n.z.union([n.z.object({id:n.z.string().nullish(),created:n.z.number().nullish(),model:n.z.string().nullish(),choices:n.z.array(n.z.object({text:n.z.string(),finish_reason:n.z.string().nullish(),index:n.z.number(),logprobs:n.z.object({tokens:n.z.array(n.z.string()),token_logprobs:n.z.array(n.z.number()),top_logprobs:n.z.array(n.z.record(n.z.string(),n.z.number())).nullish()}).nullish()})),usage:fr.nullish()}),Rn]),hr=n.z.object({dimensions:n.z.number().optional(),user:n.z.string().optional()}),gr=class{constructor(e,t){this.specificationVersion=`v2`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){var i;if(e.length>this.maxEmbeddingsPerCall)throw new Ce({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let a=(i=await H({provider:`openai`,providerOptions:r,schema:hr}))??{},{responseHeaders:o,value:s,rawValue:c}=await U({url:this.config.url({path:`/embeddings`,modelId:this.modelId}),headers:B(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:`float`,dimensions:a.dimensions,user:a.user},failedResponseHandler:zn,successfulResponseHandler:K(_r),abortSignal:n,fetch:this.config.fetch});return{embeddings:s.data.map(e=>e.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,response:{headers:o,body:c}}}},_r=n.z.object({data:n.z.array(n.z.object({embedding:n.z.array(n.z.number())})),usage:n.z.object({prompt_tokens:n.z.number()}).nullish()}),vr={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},yr=new Set([`gpt-image-1`]),br=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`}get maxImagesPerCall(){var e;return(e=vr[this.modelId])??1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:i,providerOptions:a,headers:o,abortSignal:s}){var c,l,u,d;let f=[];r!=null&&f.push({type:`unsupported-setting`,setting:`aspectRatio`,details:"This model does not support aspect ratio. Use `size` instead."}),i!=null&&f.push({type:`unsupported-setting`,setting:`seed`});let p=(u=(l=(c=this.config._internal)?.currentDate)?.call(c))??new Date,{value:m,responseHeaders:h}=await U({url:this.config.url({path:`/images/generations`,modelId:this.modelId}),headers:B(this.config.headers(),o),body:{model:this.modelId,prompt:e,n:t,size:n,...(d=a.openai)??{},...yr.has(this.modelId)?{}:{response_format:`b64_json`}},failedResponseHandler:zn,successfulResponseHandler:K(xr),abortSignal:s,fetch:this.config.fetch});return{images:m.data.map(e=>e.b64_json),warnings:f,response:{timestamp:p,modelId:this.modelId,headers:h},providerMetadata:{openai:{images:m.data.map(e=>e.revised_prompt?{revisedPrompt:e.revised_prompt}:null)}}}}},xr=n.z.object({data:n.z.array(n.z.object({b64_json:n.z.string(),revised_prompt:n.z.string().optional()}))}),Sr=n.z.object({container:n.z.union([n.z.string(),n.z.object({fileIds:n.z.array(n.z.string()).optional()})]).optional()}),Cr=W({id:`openai.code_interpreter`,name:`code_interpreter`,inputSchema:n.z.object({})}),wr=(e={})=>Cr(e),Tr=n.z.object({filters:n.z.object({allowedDomains:n.z.array(n.z.string()).optional()}).optional(),searchContextSize:n.z.enum([`low`,`medium`,`high`]).optional(),userLocation:n.z.object({type:n.z.literal(`approximate`),country:n.z.string().optional(),city:n.z.string().optional(),region:n.z.string().optional(),timezone:n.z.string().optional()}).optional()}),Er=W({id:`openai.web_search`,name:`web_search`,inputSchema:n.z.object({action:n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`search`),query:n.z.string().nullish()}),n.z.object({type:n.z.literal(`open_page`),url:n.z.string()}),n.z.object({type:n.z.literal(`find`),url:n.z.string(),pattern:n.z.string()})]).nullish()})}),Dr=(e={})=>Er(e),Or={codeInterpreter:wr,fileSearch:Jn,webSearchPreview:Xn,webSearch:Dr};function kr(e,t){return t?t.some(t=>e.startsWith(t)):!1}async function Ar({prompt:e,systemMessageMode:t,fileIdPrefixes:n}){var r,i,a,o,s,c;let l=[],u=[];for(let{role:d,content:f}of e)switch(d){case`system`:switch(t){case`system`:l.push({role:`system`,content:f});break;case`developer`:l.push({role:`developer`,content:f});break;case`remove`:u.push({type:`other`,message:`system messages are removed for this model`});break;default:{let e=t;throw Error(`Unsupported system message mode: ${e}`)}}break;case`user`:l.push({role:`user`,content:f.map((e,t)=>{var r,i,a;switch(e.type){case`text`:return{type:`input_text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`input_image`,...e.data instanceof URL?{image_url:e.data.toString()}:typeof e.data==`string`&&kr(e.data,n)?{file_id:e.data}:{image_url:`data:${t};base64,${Pn(e.data)}`},detail:(i=(r=e.providerOptions)?.openai)?.imageDetail}}else if(e.mediaType===`application/pdf`)return e.data instanceof URL?{type:`input_file`,file_url:e.data.toString()}:{type:`input_file`,...typeof e.data==`string`&&kr(e.data,n)?{file_id:e.data}:{filename:(a=e.filename)??`part-${t}.pdf`,file_data:`data:application/pdf;base64,${Pn(e.data)}`}};else throw new z({functionality:`file part media type ${e.mediaType}`})}})});break;case`assistant`:{let e={};for(let t of f)switch(t.type){case`text`:l.push({role:`assistant`,content:[{type:`output_text`,text:t.text}],id:(a=(i=(r=t.providerOptions)?.openai)?.itemId)??void 0});break;case`tool-call`:if(t.providerExecuted)break;l.push({type:`function_call`,call_id:t.toolCallId,name:t.toolName,arguments:JSON.stringify(t.input),id:(c=(s=(o=t.providerOptions)?.openai)?.itemId)??void 0});break;case`tool-result`:u.push({type:`other`,message:`tool result parts in assistant messages are not supported for OpenAI responses`});break;case`reasoning`:{let n=await H({provider:`openai`,providerOptions:t.providerOptions,schema:jr}),r=n?.itemId;if(r!=null){let i=e[r],a=[];t.text.length>0?a.push({type:`summary_text`,text:t.text}):i!==void 0&&u.push({type:`other`,message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(t)}.`}),i===void 0?(e[r]={type:`reasoning`,id:r,encrypted_content:n?.reasoningEncryptedContent,summary:a},l.push(e[r])):i.summary.push(...a)}else u.push({type:`other`,message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(t)}.`});break}}break}case`tool`:for(let e of f){let t=e.output,n;switch(t.type){case`text`:case`error-text`:n=t.value;break;case`content`:case`json`:case`error-json`:n=JSON.stringify(t.value);break}l.push({type:`function_call_output`,call_id:e.toolCallId,output:n})}break;default:{let e=d;throw Error(`Unsupported role: ${e}`)}}return{messages:l,warnings:u}}var jr=n.z.object({itemId:n.z.string().nullish(),reasoningEncryptedContent:n.z.string().nullish()});function Mr({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?`tool-calls`:`stop`;case`max_output_tokens`:return`length`;case`content_filter`:return`content-filter`;default:return t?`tool-calls`:`unknown`}}function Nr({tools:e,toolChoice:t,strictJsonSchema:n}){e=e?.length?e:void 0;let r=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:r};let i=[];for(let t of e)switch(t.type){case`function`:i.push({type:`function`,name:t.name,description:t.description,parameters:t.inputSchema,strict:n});break;case`provider-defined`:switch(t.id){case`openai.file_search`:{let e=qn.parse(t.args);i.push({type:`file_search`,vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker}:void 0,filters:e.filters});break}case`openai.web_search_preview`:{let e=Yn.parse(t.args);i.push({type:`web_search_preview`,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case`openai.web_search`:{let e=Tr.parse(t.args);i.push({type:`web_search`,filters:e.filters==null?void 0:{allowed_domains:e.filters.allowedDomains},search_context_size:e.searchContextSize,user_location:e.userLocation});break}case`openai.code_interpreter`:{let e=Sr.parse(t.args);i.push({type:`code_interpreter`,container:e.container==null?{type:`auto`,file_ids:void 0}:typeof e.container==`string`?e.container:{type:`auto`,file_ids:e.container.fileIds}});break}default:r.push({type:`unsupported-tool`,tool:t});break}break;default:r.push({type:`unsupported-tool`,tool:t});break}if(t==null)return{tools:i,toolChoice:void 0,toolWarnings:r};let a=t.type;switch(a){case`auto`:case`none`:case`required`:return{tools:i,toolChoice:a,toolWarnings:r};case`tool`:return{tools:i,toolChoice:t.toolName===`code_interpreter`||t.toolName===`file_search`||t.toolName===`web_search_preview`||t.toolName===`web_search`?{type:t.toolName}:{type:`function`,name:t.toolName},toolWarnings:r};default:{let e=a;throw new z({functionality:`tool choice type: ${e}`})}}}var Pr=n.z.object({type:n.z.literal(`web_search_call`),id:n.z.string(),status:n.z.string(),action:n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`search`),query:n.z.string().nullish()}),n.z.object({type:n.z.literal(`open_page`),url:n.z.string()}),n.z.object({type:n.z.literal(`find`),url:n.z.string(),pattern:n.z.string()})]).nullish()}),Fr=20,Ir=n.z.array(n.z.object({token:n.z.string(),logprob:n.z.number(),top_logprobs:n.z.array(n.z.object({token:n.z.string(),logprob:n.z.number()}))})),Lr=class{constructor(e,t){this.specificationVersion=`v2`,this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:n,topP:r,topK:i,presencePenalty:a,frequencyPenalty:o,seed:s,prompt:c,providerOptions:l,tools:u,toolChoice:d,responseFormat:f}){var p,m,h;let g=[],_=ci(this.modelId);i!=null&&g.push({type:`unsupported-setting`,setting:`topK`}),s!=null&&g.push({type:`unsupported-setting`,setting:`seed`}),a!=null&&g.push({type:`unsupported-setting`,setting:`presencePenalty`}),o!=null&&g.push({type:`unsupported-setting`,setting:`frequencyPenalty`}),n!=null&&g.push({type:`unsupported-setting`,setting:`stopSequences`});let{messages:v,warnings:y}=await Ar({prompt:c,systemMessageMode:_.systemMessageMode,fileIdPrefixes:this.config.fileIdPrefixes});g.push(...y);let b=await H({provider:`openai`,providerOptions:l,schema:li}),x=(p=b?.strictJsonSchema)??!1,S=b?.include,C=typeof b?.logprobs==`number`?b?.logprobs:b?.logprobs===!0?Fr:void 0;S=C?Array.isArray(S)?[...S,`message.output_text.logprobs`]:[`message.output_text.logprobs`]:S;let w=(m=u?.find(e=>e.type===`provider-defined`&&(e.id===`openai.web_search`||e.id===`openai.web_search_preview`)))?.name;S=w?Array.isArray(S)?[...S,`web_search_call.action.sources`]:[`web_search_call.action.sources`]:S;let T={model:this.modelId,input:v,temperature:t,top_p:r,max_output_tokens:e,...(f?.type===`json`||b?.textVerbosity)&&{text:{...f?.type===`json`&&{format:f.schema==null?{type:`json_object`}:{type:`json_schema`,strict:x,name:(h=f.name)??`response`,description:f.description,schema:f.schema}},...b?.textVerbosity&&{verbosity:b.textVerbosity}}},metadata:b?.metadata,parallel_tool_calls:b?.parallelToolCalls,previous_response_id:b?.previousResponseId,store:b?.store,user:b?.user,instructions:b?.instructions,service_tier:b?.serviceTier,include:S,prompt_cache_key:b?.promptCacheKey,safety_identifier:b?.safetyIdentifier,top_logprobs:C,..._.isReasoningModel&&(b?.reasoningEffort!=null||b?.reasoningSummary!=null)&&{reasoning:{...b?.reasoningEffort!=null&&{effort:b.reasoningEffort},...b?.reasoningSummary!=null&&{summary:b.reasoningSummary}}},..._.requiredAutoTruncation&&{truncation:`auto`}};_.isReasoningModel?(T.temperature!=null&&(T.temperature=void 0,g.push({type:`unsupported-setting`,setting:`temperature`,details:`temperature is not supported for reasoning models`})),T.top_p!=null&&(T.top_p=void 0,g.push({type:`unsupported-setting`,setting:`topP`,details:`topP is not supported for reasoning models`}))):(b?.reasoningEffort!=null&&g.push({type:`unsupported-setting`,setting:`reasoningEffort`,details:`reasoningEffort is not supported for non-reasoning models`}),b?.reasoningSummary!=null&&g.push({type:`unsupported-setting`,setting:`reasoningSummary`,details:`reasoningSummary is not supported for non-reasoning models`})),b?.serviceTier===`flex`&&!_.supportsFlexProcessing&&(g.push({type:`unsupported-setting`,setting:`serviceTier`,details:`flex processing is only available for o3, o4-mini, and gpt-5 models`}),delete T.service_tier),b?.serviceTier===`priority`&&!_.supportsPriorityProcessing&&(g.push({type:`unsupported-setting`,setting:`serviceTier`,details:`priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported`}),delete T.service_tier);let{tools:E,toolChoice:D,toolWarnings:O}=Nr({tools:u,toolChoice:d,strictJsonSchema:x});return{webSearchToolName:w,args:{...T,tools:E,tool_choice:D},warnings:[...g,...O]}}async doGenerate(e){var t,r,i,a,o,s,c,l,u,d,f,m,h,g,_,v,y;let{args:b,warnings:x,webSearchToolName:S}=await this.getArgs(e),C=this.config.url({path:`/responses`,modelId:this.modelId}),{responseHeaders:w,value:T,rawValue:E}=await U({url:C,headers:B(this.config.headers(),e.headers),body:b,failedResponseHandler:zn,successfulResponseHandler:K(n.z.object({id:n.z.string(),created_at:n.z.number(),error:n.z.object({code:n.z.string(),message:n.z.string()}).nullish(),model:n.z.string(),output:n.z.array(n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`message`),role:n.z.literal(`assistant`),id:n.z.string(),content:n.z.array(n.z.object({type:n.z.literal(`output_text`),text:n.z.string(),logprobs:Ir.nullish(),annotations:n.z.array(n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`url_citation`),start_index:n.z.number(),end_index:n.z.number(),url:n.z.string(),title:n.z.string()}),n.z.object({type:n.z.literal(`file_citation`),file_id:n.z.string(),filename:n.z.string().nullish(),index:n.z.number().nullish(),start_index:n.z.number().nullish(),end_index:n.z.number().nullish(),quote:n.z.string().nullish()}),n.z.object({type:n.z.literal(`container_file_citation`)})]))}))}),n.z.object({type:n.z.literal(`code_interpreter_call`)}),n.z.object({type:n.z.literal(`function_call`),call_id:n.z.string(),name:n.z.string(),arguments:n.z.string(),id:n.z.string()}),Pr,n.z.object({type:n.z.literal(`computer_call`),id:n.z.string(),status:n.z.string().optional()}),n.z.object({type:n.z.literal(`file_search_call`),id:n.z.string(),status:n.z.string().optional(),queries:n.z.array(n.z.string()).nullish(),results:n.z.array(n.z.object({attributes:n.z.object({file_id:n.z.string(),filename:n.z.string(),score:n.z.number(),text:n.z.string()})})).nullish()}),n.z.object({type:n.z.literal(`reasoning`),id:n.z.string(),encrypted_content:n.z.string().nullish(),summary:n.z.array(n.z.object({type:n.z.literal(`summary_text`),text:n.z.string()}))})])),service_tier:n.z.string().nullish(),incomplete_details:n.z.object({reason:n.z.string()}).nullable(),usage:Rr})),abortSignal:e.abortSignal,fetch:this.config.fetch});if(T.error)throw new p({message:T.error.message,url:C,requestBodyValues:b,statusCode:400,responseHeaders:w,responseBody:E,isRetryable:!1});let D=[],O=[],k=!1;for(let n of T.output)switch(n.type){case`reasoning`:n.summary.length===0&&n.summary.push({type:`summary_text`,text:``});for(let e of n.summary)D.push({type:`reasoning`,text:e.text,providerMetadata:{openai:{itemId:n.id,reasoningEncryptedContent:(t=n.encrypted_content)??null}}});break;case`message`:for(let t of n.content){(i=(r=e.providerOptions)?.openai)?.logprobs&&t.logprobs&&O.push(t.logprobs),D.push({type:`text`,text:t.text,providerMetadata:{openai:{itemId:n.id}}});for(let e of t.annotations)e.type===`url_citation`?D.push({type:`source`,sourceType:`url`,id:(s=(o=(a=this.config).generateId)?.call(a))??V(),url:e.url,title:e.title}):e.type===`file_citation`&&D.push({type:`source`,sourceType:`document`,id:(u=(l=(c=this.config).generateId)?.call(c))??V(),mediaType:`text/plain`,title:(f=(d=e.quote)??e.filename)??`Document`,filename:(m=e.filename)??e.file_id})}break;case`function_call`:k=!0,D.push({type:`tool-call`,toolCallId:n.call_id,toolName:n.name,input:n.arguments,providerMetadata:{openai:{itemId:n.id}}});break;case`web_search_call`:D.push({type:`tool-call`,toolCallId:n.id,toolName:S??`web_search`,input:JSON.stringify({action:n.action}),providerExecuted:!0}),D.push({type:`tool-result`,toolCallId:n.id,toolName:S??`web_search`,result:{status:n.status},providerExecuted:!0});break;case`computer_call`:D.push({type:`tool-call`,toolCallId:n.id,toolName:`computer_use`,input:``,providerExecuted:!0}),D.push({type:`tool-result`,toolCallId:n.id,toolName:`computer_use`,result:{type:`computer_use_tool_result`,status:n.status||`completed`},providerExecuted:!0});break;case`file_search_call`:D.push({type:`tool-call`,toolCallId:n.id,toolName:`file_search`,input:``,providerExecuted:!0}),D.push({type:`tool-result`,toolCallId:n.id,toolName:`file_search`,result:{type:`file_search_tool_result`,status:n.status||`completed`,...n.queries&&{queries:n.queries},...n.results&&{results:n.results}},providerExecuted:!0});break}let A={openai:{responseId:T.id}};return O.length>0&&(A.openai.logprobs=O),typeof T.service_tier==`string`&&(A.openai.serviceTier=T.service_tier),{content:D,finishReason:Mr({finishReason:(h=T.incomplete_details)?.reason,hasFunctionCall:k}),usage:{inputTokens:T.usage.input_tokens,outputTokens:T.usage.output_tokens,totalTokens:T.usage.input_tokens+T.usage.output_tokens,reasoningTokens:(_=(g=T.usage.output_tokens_details)?.reasoning_tokens)??void 0,cachedInputTokens:(y=(v=T.usage.input_tokens_details)?.cached_tokens)??void 0},request:{body:b},response:{id:T.id,timestamp:new Date(T.created_at*1e3),modelId:T.model,headers:w,body:E},providerMetadata:A,warnings:x}}async doStream(e){let{args:t,warnings:n,webSearchToolName:r}=await this.getArgs(e),{responseHeaders:i,value:a}=await U({url:this.config.url({path:`/responses`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:zn,successfulResponseHandler:St(Yr),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=this,s=`unknown`,c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l=[],u=null,d={},f=!1,p={},m;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){var i,a,h,g,_,v,y,b,x,S,C,w,T,E,D,O,k,A,ee,te,j;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){s=`error`,n.enqueue({type:`error`,error:t.error});return}let M=t.value;if(ni(M))M.item.type===`function_call`?(d[M.output_index]={toolName:M.item.name,toolCallId:M.item.call_id},n.enqueue({type:`tool-input-start`,id:M.item.call_id,toolName:M.item.name})):M.item.type===`web_search_call`?(d[M.output_index]={toolName:r??`web_search`,toolCallId:M.item.id},n.enqueue({type:`tool-input-start`,id:M.item.id,toolName:r??`web_search`})):M.item.type===`computer_call`?(d[M.output_index]={toolName:`computer_use`,toolCallId:M.item.id},n.enqueue({type:`tool-input-start`,id:M.item.id,toolName:`computer_use`})):M.item.type===`file_search_call`?(d[M.output_index]={toolName:`file_search`,toolCallId:M.item.id},n.enqueue({type:`tool-input-start`,id:M.item.id,toolName:`file_search`})):M.item.type===`message`?n.enqueue({type:`text-start`,id:M.item.id,providerMetadata:{openai:{itemId:M.item.id}}}):ri(M)&&(p[M.item.id]={encryptedContent:M.item.encrypted_content,summaryParts:[0]},n.enqueue({type:`reasoning-start`,id:`${M.item.id}:0`,providerMetadata:{openai:{itemId:M.item.id,reasoningEncryptedContent:(i=M.item.encrypted_content)??null}}}));else if(Zr(M)){if(M.item.type===`function_call`)d[M.output_index]=void 0,f=!0,n.enqueue({type:`tool-input-end`,id:M.item.call_id}),n.enqueue({type:`tool-call`,toolCallId:M.item.call_id,toolName:M.item.name,input:M.item.arguments,providerMetadata:{openai:{itemId:M.item.id}}});else if(M.item.type===`web_search_call`)d[M.output_index]=void 0,n.enqueue({type:`tool-input-end`,id:M.item.id}),n.enqueue({type:`tool-call`,toolCallId:M.item.id,toolName:`web_search`,input:JSON.stringify({action:M.item.action}),providerExecuted:!0}),n.enqueue({type:`tool-result`,toolCallId:M.item.id,toolName:`web_search`,result:{status:M.item.status},providerExecuted:!0});else if(M.item.type===`computer_call`)d[M.output_index]=void 0,n.enqueue({type:`tool-input-end`,id:M.item.id}),n.enqueue({type:`tool-call`,toolCallId:M.item.id,toolName:`computer_use`,input:``,providerExecuted:!0}),n.enqueue({type:`tool-result`,toolCallId:M.item.id,toolName:`computer_use`,result:{type:`computer_use_tool_result`,status:M.item.status||`completed`},providerExecuted:!0});else if(M.item.type===`file_search_call`)d[M.output_index]=void 0,n.enqueue({type:`tool-input-end`,id:M.item.id}),n.enqueue({type:`tool-call`,toolCallId:M.item.id,toolName:`file_search`,input:``,providerExecuted:!0}),n.enqueue({type:`tool-result`,toolCallId:M.item.id,toolName:`file_search`,result:{type:`file_search_tool_result`,status:M.item.status||`completed`,...M.item.queries&&{queries:M.item.queries},...M.item.results&&{results:M.item.results}},providerExecuted:!0});else if(M.item.type===`message`)n.enqueue({type:`text-end`,id:M.item.id});else if(Qr(M)){let e=p[M.item.id];for(let t of e.summaryParts)n.enqueue({type:`reasoning-end`,id:`${M.item.id}:${t}`,providerMetadata:{openai:{itemId:M.item.id,reasoningEncryptedContent:(a=M.item.encrypted_content)??null}}});delete p[M.item.id]}}else if(ti(M)){let e=d[M.output_index];e!=null&&n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:M.delta})}else ei(M)?(u=M.response.id,n.enqueue({type:`response-metadata`,id:M.response.id,timestamp:new Date(M.response.created_at*1e3),modelId:M.response.model})):Xr(M)?(n.enqueue({type:`text-delta`,id:M.item_id,delta:M.delta}),(g=(h=e.providerOptions)?.openai)?.logprobs&&M.logprobs&&l.push(M.logprobs)):ai(M)?M.summary_index>0&&((_=p[M.item_id])==null||_.summaryParts.push(M.summary_index),n.enqueue({type:`reasoning-start`,id:`${M.item_id}:${M.summary_index}`,providerMetadata:{openai:{itemId:M.item_id,reasoningEncryptedContent:(y=(v=p[M.item_id])?.encryptedContent)??null}}})):oi(M)?n.enqueue({type:`reasoning-delta`,id:`${M.item_id}:${M.summary_index}`,delta:M.delta,providerMetadata:{openai:{itemId:M.item_id}}}):$r(M)?(s=Mr({finishReason:(b=M.response.incomplete_details)?.reason,hasFunctionCall:f}),c.inputTokens=M.response.usage.input_tokens,c.outputTokens=M.response.usage.output_tokens,c.totalTokens=M.response.usage.input_tokens+M.response.usage.output_tokens,c.reasoningTokens=(S=(x=M.response.usage.output_tokens_details)?.reasoning_tokens)??void 0,c.cachedInputTokens=(w=(C=M.response.usage.input_tokens_details)?.cached_tokens)??void 0,typeof M.response.service_tier==`string`&&(m=M.response.service_tier)):ii(M)?M.annotation.type===`url_citation`?n.enqueue({type:`source`,sourceType:`url`,id:(D=(E=(T=o.config).generateId)?.call(T))??V(),url:M.annotation.url,title:M.annotation.title}):M.annotation.type===`file_citation`&&n.enqueue({type:`source`,sourceType:`document`,id:(A=(k=(O=o.config).generateId)?.call(O))??V(),mediaType:`text/plain`,title:(te=(ee=M.annotation.quote)??M.annotation.filename)??`Document`,filename:(j=M.annotation.filename)??M.annotation.file_id}):si(M)&&n.enqueue({type:`error`,error:M})},flush(e){let t={openai:{responseId:u}};l.length>0&&(t.openai.logprobs=l),m!==void 0&&(t.openai.serviceTier=m),e.enqueue({type:`finish`,finishReason:s,usage:c,providerMetadata:t})}})),request:{body:t},response:{headers:i}}}},Rr=n.z.object({input_tokens:n.z.number(),input_tokens_details:n.z.object({cached_tokens:n.z.number().nullish()}).nullish(),output_tokens:n.z.number(),output_tokens_details:n.z.object({reasoning_tokens:n.z.number().nullish()}).nullish()}),zr=n.z.object({type:n.z.literal(`response.output_text.delta`),item_id:n.z.string(),delta:n.z.string(),logprobs:Ir.nullish()}),Br=n.z.object({type:n.z.literal(`error`),code:n.z.string(),message:n.z.string(),param:n.z.string().nullish(),sequence_number:n.z.number()}),Vr=n.z.object({type:n.z.enum([`response.completed`,`response.incomplete`]),response:n.z.object({incomplete_details:n.z.object({reason:n.z.string()}).nullish(),usage:Rr,service_tier:n.z.string().nullish()})}),Hr=n.z.object({type:n.z.literal(`response.created`),response:n.z.object({id:n.z.string(),created_at:n.z.number(),model:n.z.string(),service_tier:n.z.string().nullish()})}),Ur=n.z.object({type:n.z.literal(`response.output_item.added`),output_index:n.z.number(),item:n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`message`),id:n.z.string()}),n.z.object({type:n.z.literal(`reasoning`),id:n.z.string(),encrypted_content:n.z.string().nullish()}),n.z.object({type:n.z.literal(`function_call`),id:n.z.string(),call_id:n.z.string(),name:n.z.string(),arguments:n.z.string()}),n.z.object({type:n.z.literal(`web_search_call`),id:n.z.string(),status:n.z.string(),action:n.z.object({type:n.z.literal(`search`),query:n.z.string().optional()}).nullish()}),n.z.object({type:n.z.literal(`computer_call`),id:n.z.string(),status:n.z.string()}),n.z.object({type:n.z.literal(`file_search_call`),id:n.z.string(),status:n.z.string(),queries:n.z.array(n.z.string()).nullish(),results:n.z.array(n.z.object({attributes:n.z.object({file_id:n.z.string(),filename:n.z.string(),score:n.z.number(),text:n.z.string()})})).optional()})])}),Wr=n.z.object({type:n.z.literal(`response.output_item.done`),output_index:n.z.number(),item:n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`message`),id:n.z.string()}),n.z.object({type:n.z.literal(`reasoning`),id:n.z.string(),encrypted_content:n.z.string().nullish()}),n.z.object({type:n.z.literal(`function_call`),id:n.z.string(),call_id:n.z.string(),name:n.z.string(),arguments:n.z.string(),status:n.z.literal(`completed`)}),Pr,n.z.object({type:n.z.literal(`computer_call`),id:n.z.string(),status:n.z.literal(`completed`)}),n.z.object({type:n.z.literal(`file_search_call`),id:n.z.string(),status:n.z.literal(`completed`),queries:n.z.array(n.z.string()).nullish(),results:n.z.array(n.z.object({attributes:n.z.object({file_id:n.z.string(),filename:n.z.string(),score:n.z.number(),text:n.z.string()})})).nullish()})])}),Gr=n.z.object({type:n.z.literal(`response.function_call_arguments.delta`),item_id:n.z.string(),output_index:n.z.number(),delta:n.z.string()}),Kr=n.z.object({type:n.z.literal(`response.output_text.annotation.added`),annotation:n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`url_citation`),url:n.z.string(),title:n.z.string()}),n.z.object({type:n.z.literal(`file_citation`),file_id:n.z.string(),filename:n.z.string().nullish(),index:n.z.number().nullish(),start_index:n.z.number().nullish(),end_index:n.z.number().nullish(),quote:n.z.string().nullish()})])}),qr=n.z.object({type:n.z.literal(`response.reasoning_summary_part.added`),item_id:n.z.string(),summary_index:n.z.number()}),Jr=n.z.object({type:n.z.literal(`response.reasoning_summary_text.delta`),item_id:n.z.string(),summary_index:n.z.number(),delta:n.z.string()}),Yr=n.z.union([zr,Vr,Hr,Ur,Wr,Gr,Kr,qr,Jr,Br,n.z.object({type:n.z.string()}).loose()]);function Xr(e){return e.type===`response.output_text.delta`}function Zr(e){return e.type===`response.output_item.done`}function Qr(e){return Zr(e)&&e.item.type===`reasoning`}function $r(e){return e.type===`response.completed`||e.type===`response.incomplete`}function ei(e){return e.type===`response.created`}function ti(e){return e.type===`response.function_call_arguments.delta`}function ni(e){return e.type===`response.output_item.added`}function ri(e){return ni(e)&&e.item.type===`reasoning`}function ii(e){return e.type===`response.output_text.annotation.added`}function ai(e){return e.type===`response.reasoning_summary_part.added`}function oi(e){return e.type===`response.reasoning_summary_text.delta`}function si(e){return e.type===`error`}function ci(e){let t=e.startsWith(`o3`)||e.startsWith(`o4-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-chat`),n=e.startsWith(`gpt-4`)||e.startsWith(`gpt-5-mini`)||e.startsWith(`gpt-5`)&&!e.startsWith(`gpt-5-nano`)&&!e.startsWith(`gpt-5-chat`)||e.startsWith(`o3`)||e.startsWith(`o4-mini`),r={requiredAutoTruncation:!1,systemMessageMode:`system`,supportsFlexProcessing:t,supportsPriorityProcessing:n};return e.startsWith(`gpt-5-chat`)?{...r,isReasoningModel:!1}:e.startsWith(`o`)||e.startsWith(`gpt-5`)||e.startsWith(`codex-`)||e.startsWith(`computer-use`)?e.startsWith(`o1-mini`)||e.startsWith(`o1-preview`)?{...r,isReasoningModel:!0,systemMessageMode:`remove`}:{...r,isReasoningModel:!0,systemMessageMode:`developer`}:{...r,isReasoningModel:!1}}var li=n.z.object({metadata:n.z.any().nullish(),parallelToolCalls:n.z.boolean().nullish(),previousResponseId:n.z.string().nullish(),store:n.z.boolean().nullish(),user:n.z.string().nullish(),reasoningEffort:n.z.string().nullish(),strictJsonSchema:n.z.boolean().nullish(),instructions:n.z.string().nullish(),reasoningSummary:n.z.string().nullish(),serviceTier:n.z.enum([`auto`,`flex`,`priority`]).nullish(),include:n.z.array(n.z.enum([`reasoning.encrypted_content`,`file_search_call.results`,`message.output_text.logprobs`])).nullish(),textVerbosity:n.z.enum([`low`,`medium`,`high`]).nullish(),promptCacheKey:n.z.string().nullish(),safetyIdentifier:n.z.string().nullish(),logprobs:n.z.union([n.z.boolean(),n.z.number().min(1).max(Fr)]).optional()}),ui=n.z.object({instructions:n.z.string().nullish(),speed:n.z.number().min(.25).max(4).default(1).nullish()}),di=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`}get provider(){return this.config.provider}async getArgs({text:e,voice:t=`alloy`,outputFormat:n=`mp3`,speed:r,instructions:i,language:a,providerOptions:o}){let s=[],c=await H({provider:`openai`,providerOptions:o,schema:ui}),l={model:this.modelId,input:e,voice:t,response_format:`mp3`,speed:r,instructions:i};if(n&&([`mp3`,`opus`,`aac`,`flac`,`wav`,`pcm`].includes(n)?l.response_format=n:s.push({type:`unsupported-setting`,setting:`outputFormat`,details:`Unsupported output format: ${n}. Using mp3 instead.`})),c){let e={};for(let t in e){let n=e[t];n!==void 0&&(l[t]=n)}}return a&&s.push({type:`unsupported-setting`,setting:`language`,details:`OpenAI speech models do not support language selection. Language parameter "${a}" was ignored.`}),{requestBody:l,warnings:s}}async doGenerate(e){var t,n,r;let i=(r=(n=(t=this.config._internal)?.currentDate)?.call(t))??new Date,{requestBody:a,warnings:o}=await this.getArgs(e),{value:s,responseHeaders:c,rawValue:l}=await U({url:this.config.url({path:`/audio/speech`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),body:a,failedResponseHandler:zn,successfulResponseHandler:Ct(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:s,warnings:o,request:{body:JSON.stringify(a)},response:{timestamp:i,modelId:this.modelId,headers:c,body:l}}}},fi=n.z.object({include:n.z.array(n.z.string()).optional(),language:n.z.string().optional(),prompt:n.z.string().optional(),temperature:n.z.number().min(0).max(1).default(0).optional(),timestampGranularities:n.z.array(n.z.enum([`word`,`segment`])).default([`segment`]).optional()}),pi={afrikaans:`af`,arabic:`ar`,armenian:`hy`,azerbaijani:`az`,belarusian:`be`,bosnian:`bs`,bulgarian:`bg`,catalan:`ca`,chinese:`zh`,croatian:`hr`,czech:`cs`,danish:`da`,dutch:`nl`,english:`en`,estonian:`et`,finnish:`fi`,french:`fr`,galician:`gl`,german:`de`,greek:`el`,hebrew:`he`,hindi:`hi`,hungarian:`hu`,icelandic:`is`,indonesian:`id`,italian:`it`,japanese:`ja`,kannada:`kn`,kazakh:`kk`,korean:`ko`,latvian:`lv`,lithuanian:`lt`,macedonian:`mk`,malay:`ms`,marathi:`mr`,maori:`mi`,nepali:`ne`,norwegian:`no`,persian:`fa`,polish:`pl`,portuguese:`pt`,romanian:`ro`,russian:`ru`,serbian:`sr`,slovak:`sk`,slovenian:`sl`,spanish:`es`,swahili:`sw`,swedish:`sv`,tagalog:`tl`,tamil:`ta`,thai:`th`,turkish:`tr`,ukrainian:`uk`,urdu:`ur`,vietnamese:`vi`,welsh:`cy`},mi=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:n}){let r=[],i=await H({provider:`openai`,providerOptions:n,schema:fi}),a=new FormData,o=e instanceof Uint8Array?new Blob([e]):new Blob([Mn(e)]);a.append(`model`,this.modelId);let s=$e(t);if(a.append(`file`,new File([o],`audio`,{type:t}),`audio.${s}`),i){let e={include:i.include,language:i.language,prompt:i.prompt,response_format:[`gpt-4o-transcribe`,`gpt-4o-mini-transcribe`].includes(this.modelId)?`json`:`verbose_json`,temperature:i.temperature,timestamp_granularities:i.timestampGranularities};for(let[t,n]of Object.entries(e))if(n!=null)if(Array.isArray(n))for(let e of n)a.append(`${t}[]`,String(e));else a.append(t,String(n))}return{formData:a,warnings:r}}async doGenerate(e){var t,n,r,i,a,o,s,c;let l=(r=(n=(t=this.config._internal)?.currentDate)?.call(t))??new Date,{formData:u,warnings:d}=await this.getArgs(e),{value:f,responseHeaders:p,rawValue:m}=await _t({url:this.config.url({path:`/audio/transcriptions`,modelId:this.modelId}),headers:B(this.config.headers(),e.headers),formData:u,failedResponseHandler:zn,successfulResponseHandler:K(hi),abortSignal:e.abortSignal,fetch:this.config.fetch}),h=f.language!=null&&f.language in pi?pi[f.language]:void 0;return{text:f.text,segments:(s=(o=(i=f.segments)?.map(e=>({text:e.text,startSecond:e.start,endSecond:e.end})))??(a=f.words)?.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))??[],language:h,durationInSeconds:(c=f.duration)??void 0,warnings:d,response:{timestamp:l,modelId:this.modelId,headers:p,body:m}}}},hi=n.z.object({text:n.z.string(),language:n.z.string().nullish(),duration:n.z.number().nullish(),words:n.z.array(n.z.object({word:n.z.string(),start:n.z.number(),end:n.z.number()})).nullish(),segments:n.z.array(n.z.object({id:n.z.number(),seek:n.z.number(),start:n.z.number(),end:n.z.number(),text:n.z.string(),tokens:n.z.array(n.z.number()),temperature:n.z.number(),avg_logprob:n.z.number(),compression_ratio:n.z.number(),no_speech_prob:n.z.number()})).nullish()});function gi(e={}){var t,n;let r=(t=Fn(e.baseURL))??`https://api.openai.com/v1`,i=(n=e.name)??`openai`,a=()=>({Authorization:`Bearer ${Ze({apiKey:e.apiKey,environmentVariableName:`OPENAI_API_KEY`,description:`OpenAI`})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),o=t=>new Qn(t,{provider:`${i}.chat`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),s=t=>new dr(t,{provider:`${i}.completion`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),c=t=>new gr(t,{provider:`${i}.embedding`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),l=t=>new br(t,{provider:`${i}.image`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),u=t=>new mi(t,{provider:`${i}.transcription`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),d=t=>new di(t,{provider:`${i}.speech`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),f=e=>{if(new.target)throw Error(`The OpenAI model function cannot be called with the new keyword.`);return p(e)},p=t=>new Lr(t,{provider:`${i}.responses`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch,fileIdPrefixes:[`file-`]}),m=function(e){return f(e)};return m.languageModel=f,m.chat=o,m.completion=s,m.responses=p,m.embedding=c,m.textEmbedding=c,m.textEmbeddingModel=c,m.image=l,m.imageModel=l,m.transcription=u,m.transcriptionModel=u,m.speech=d,m.speechModel=d,m.tools=Or,m}var _i=gi(),vi=`vercel.ai.gateway.error`,yi=Symbol.for(vi),bi,xi,Z=class e extends (xi=Error,bi=yi,xi){constructor({message:e,statusCode:t=500,cause:n}){super(e),this[bi]=!0,this.statusCode=t,this.cause=n}static isInstance(t){return e.hasMarker(t)}static hasMarker(e){return typeof e==`object`&&!!e&&yi in e&&e[yi]===!0}},Si=`GatewayAuthenticationError`,Ci=`vercel.ai.gateway.error.${Si}`,wi=Symbol.for(Ci),Ti,Ei,Di=class e extends (Ei=Z,Ti=wi,Ei){constructor({message:e=`Authentication failed`,statusCode:t=401,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Ti]=!0,this.name=Si,this.type=`authentication_error`}static isInstance(e){return Z.hasMarker(e)&&wi in e}static createContextualError({apiKeyProvided:t,oidcTokenProvided:n,message:r=`Authentication failed`,statusCode:i=401,cause:a}){let o;return o=t?`AI Gateway authentication failed: Invalid API key provided.

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:n?`AI Gateway authentication failed: Invalid OIDC token provided.

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed

Alternative: Provide an API key via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:`AI Gateway authentication failed: No authentication provided.

Provide either an API key or OIDC token.

API key instructions:

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

OIDC token instructions:

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed`,new e({message:o,statusCode:i,cause:a})}},Oi=`GatewayInvalidRequestError`,ki=`vercel.ai.gateway.error.${Oi}`,Ai=Symbol.for(ki),ji,Mi,Ni=class extends (Mi=Z,ji=Ai,Mi){constructor({message:e=`Invalid request`,statusCode:t=400,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[ji]=!0,this.name=Oi,this.type=`invalid_request_error`}static isInstance(e){return Z.hasMarker(e)&&Ai in e}},Pi=`GatewayRateLimitError`,Fi=`vercel.ai.gateway.error.${Pi}`,Ii=Symbol.for(Fi),Li,Ri,zi=class extends (Ri=Z,Li=Ii,Ri){constructor({message:e=`Rate limit exceeded`,statusCode:t=429,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Li]=!0,this.name=Pi,this.type=`rate_limit_exceeded`}static isInstance(e){return Z.hasMarker(e)&&Ii in e}},Bi=`GatewayModelNotFoundError`,Vi=`vercel.ai.gateway.error.${Bi}`,Hi=Symbol.for(Vi),Ui=n.z.object({modelId:n.z.string()}),Wi,Gi,Ki=class extends (Gi=Z,Wi=Hi,Gi){constructor({message:e=`Model not found`,statusCode:t=404,modelId:n,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[Wi]=!0,this.name=Bi,this.type=`model_not_found`,this.modelId=n}static isInstance(e){return Z.hasMarker(e)&&Hi in e}},qi=`GatewayInternalServerError`,Ji=`vercel.ai.gateway.error.${qi}`,Yi=Symbol.for(Ji),Xi,Zi,Qi=class extends (Zi=Z,Xi=Yi,Zi){constructor({message:e=`Internal server error`,statusCode:t=500,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Xi]=!0,this.name=qi,this.type=`internal_server_error`}static isInstance(e){return Z.hasMarker(e)&&Yi in e}},$i=`GatewayResponseError`,ea=`vercel.ai.gateway.error.${$i}`,ta=Symbol.for(ea),na,ra,ia=class extends (ra=Z,na=ta,ra){constructor({message:e=`Invalid response from Gateway`,statusCode:t=502,response:n,validationError:r,cause:i}={}){super({message:e,statusCode:t,cause:i}),this[na]=!0,this.name=$i,this.type=`response_error`,this.response=n,this.validationError=r}static isInstance(e){return Z.hasMarker(e)&&ta in e}};function aa({response:e,statusCode:t,defaultMessage:n=`Gateway request failed`,cause:r,authMethod:i}){let a=oa.safeParse(e);if(!a.success)return new ia({message:`Invalid error response format: ${n}`,statusCode:t,response:e,validationError:a.error,cause:r});let o=a.data,s=o.error.type,c=o.error.message;switch(s){case`authentication_error`:return Di.createContextualError({apiKeyProvided:i===`api-key`,oidcTokenProvided:i===`oidc`,statusCode:t,cause:r});case`invalid_request_error`:return new Ni({message:c,statusCode:t,cause:r});case`rate_limit_exceeded`:return new zi({message:c,statusCode:t,cause:r});case`model_not_found`:{let e=Ui.safeParse(o.error.param);return new Ki({message:c,statusCode:t,modelId:e.success?e.data.modelId:void 0,cause:r})}case`internal_server_error`:return new Qi({message:c,statusCode:t,cause:r});default:return new Qi({message:c,statusCode:t,cause:r})}}var oa=n.z.object({error:n.z.object({message:n.z.string(),type:n.z.string().nullish(),param:n.z.unknown().nullish(),code:n.z.union([n.z.string(),n.z.number()]).nullish()})});function sa(e,t){var n;return Z.isInstance(e)?e:p.isInstance(e)?aa({response:ca(e),statusCode:(n=e.statusCode)??500,defaultMessage:`Gateway request failed`,cause:e,authMethod:t}):aa({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:`Unknown Gateway error`,cause:e,authMethod:t})}function ca(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}var la=`ai-gateway-auth-method`;function ua(e){let t=da.safeParse(e[la]);return t.success?t.data:void 0}var da=n.z.union([n.z.literal(`api-key`),n.z.literal(`oidc`)]),fa=class{constructor(e){this.config=e}async getAvailableModels(){try{let{value:e}=await Ye({url:`${this.config.baseURL}/config`,headers:await G(this.config.headers()),successfulResponseHandler:K(ga),failedResponseHandler:xt({errorSchema:n.z.any(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw sa(e)}}},pa=n.z.object({specificationVersion:n.z.literal(`v2`),provider:n.z.string(),modelId:n.z.string()}),ma=n.z.object({input:n.z.string(),output:n.z.string(),input_cache_read:n.z.string().nullish(),input_cache_write:n.z.string().nullish()}).transform(({input:e,output:t,input_cache_read:n,input_cache_write:r})=>({input:e,output:t,...n?{cachedInputTokens:n}:{},...r?{cacheCreationInputTokens:r}:{}})),ha=n.z.object({id:n.z.string(),name:n.z.string(),description:n.z.string().nullish(),pricing:ma.nullish(),specification:pa,modelType:n.z.enum([`language`,`embedding`,`image`]).nullish()}),ga=n.z.object({models:n.z.array(ha)}),_a=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`,this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){let{abortSignal:t,...n}=e;return{args:this.maybeEncodeFileParts(n),warnings:[]}}async doGenerate(e){let{args:t,warnings:r}=await this.getArgs(e),{abortSignal:i}=e,a=await G(this.config.headers());try{let{responseHeaders:o,value:s,rawValue:c}=await U({url:this.getUrl(),headers:B(a,e.headers,this.getModelConfigHeaders(this.modelId,!1),await G(this.config.o11yHeaders)),body:t,successfulResponseHandler:K(n.z.any()),failedResponseHandler:xt({errorSchema:n.z.any(),errorToMessage:e=>e}),...i&&{abortSignal:i},fetch:this.config.fetch});return{...s,request:{body:t},response:{headers:o,body:c},warnings:r}}catch(e){throw sa(e,ua(a))}}async doStream(e){let{args:t,warnings:r}=await this.getArgs(e),{abortSignal:i}=e,a=await G(this.config.headers());try{let{value:o,responseHeaders:s}=await U({url:this.getUrl(),headers:B(a,e.headers,this.getModelConfigHeaders(this.modelId,!0),await G(this.config.o11yHeaders)),body:t,successfulResponseHandler:St(n.z.any()),failedResponseHandler:xt({errorSchema:n.z.any(),errorToMessage:e=>e}),...i&&{abortSignal:i},fetch:this.config.fetch});return{stream:o.pipeThrough(new TransformStream({start(e){r.length>0&&e.enqueue({type:`stream-start`,warnings:r})},transform(t,n){if(t.success){let r=t.value;if(r.type===`raw`&&!e.includeRawChunks)return;r.type===`response-metadata`&&r.timestamp&&typeof r.timestamp==`string`&&(r.timestamp=new Date(r.timestamp)),n.enqueue(r)}else n.error(t.error)}})),request:{body:t},response:{headers:s}}}catch(e){throw sa(e,ua(a))}}isFilePart(e){return e&&typeof e==`object`&&`type`in e&&e.type===`file`}maybeEncodeFileParts(e){for(let t of e.prompt)for(let e of t.content)if(this.isFilePart(e)){let t=e;if(t.data instanceof Uint8Array){let e=Uint8Array.from(t.data),n=Buffer.from(e).toString(`base64`);t.data=new URL(`data:${t.mediaType||`application/octet-stream`};base64,${n}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":`2`,"ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},va=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:r,providerOptions:i}){var a;let o=await G(this.config.headers());try{let{responseHeaders:s,value:c,rawValue:l}=await U({url:this.getUrl(),headers:B(o,t??{},this.getModelConfigHeaders(),await G(this.config.o11yHeaders)),body:{input:e.length===1?e[0]:e,...i?{providerOptions:i}:{}},successfulResponseHandler:K(ya),failedResponseHandler:xt({errorSchema:n.z.any(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{embeddings:c.embeddings,usage:(a=c.usage)??void 0,providerMetadata:c.providerMetadata,response:{headers:s,body:l}}}catch(e){throw sa(e,ua(o))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":`2`,"ai-model-id":this.modelId}}},ya=n.z.object({embeddings:n.z.array(n.z.array(n.z.number())),usage:n.z.object({tokens:n.z.number()}).nullish(),providerMetadata:n.z.record(n.z.string(),n.z.record(n.z.string(),n.z.unknown())).optional()});async function ba(){var e,t;let n=(t=(e=Ca().headers)?.[`x-vercel-oidc-token`])??process.env.VERCEL_OIDC_TOKEN;if(!n)throw new Di({message:`OIDC token not available`,statusCode:401});return n}async function xa(){var e;return(e=Ca().headers)?.[`x-vercel-id`]}var Sa=Symbol.for(`@vercel/request-context`);function Ca(){var e,t,n;let r=globalThis;return(n=(t=(e=r[Sa])?.get)?.call(e))??{}}var wa=`0.0.1`;function Ta(e={}){var t,n;let r=null,i=null,a=(t=e.metadataCacheRefreshMillis)??1e3*60*5,o=0,s=(n=Fn(e.baseURL))??`https://ai-gateway.vercel.sh/v1/ai`,c=async()=>{let t=await Da(e);if(t)return{Authorization:`Bearer ${t.token}`,"ai-gateway-protocol-version":wa,[la]:t.authMethod,...e.headers};throw Di.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},l=()=>{let e=Qe({settingValue:void 0,environmentVariableName:`VERCEL_DEPLOYMENT_ID`}),t=Qe({settingValue:void 0,environmentVariableName:`VERCEL_ENV`}),n=Qe({settingValue:void 0,environmentVariableName:`VERCEL_REGION`});return async()=>{let r=await xa();return{...e&&{"ai-o11y-deployment-id":e},...t&&{"ai-o11y-environment":t},...n&&{"ai-o11y-region":n},...r&&{"ai-o11y-request-id":r}}}},u=t=>new _a(t,{provider:`gateway`,baseURL:s,headers:c,fetch:e.fetch,o11yHeaders:l()}),d=async()=>{var t,n,l;let u=(l=(n=(t=e._internal)?.currentDate)?.call(t).getTime())??Date.now();return(!r||u-o>a)&&(o=u,r=new fa({baseURL:s,headers:c,fetch:e.fetch}).getAvailableModels().then(e=>(i=e,e)).catch(async e=>{throw sa(e,ua(await c()))})),i?Promise.resolve(i):r},f=function(e){if(new.target)throw Error(`The Gateway Provider model function cannot be called with the new keyword.`);return u(e)};return f.getAvailableModels=d,f.imageModel=e=>{throw new ye({modelId:e,modelType:`imageModel`})},f.languageModel=u,f.textEmbeddingModel=t=>new va(t,{provider:`gateway`,baseURL:s,headers:c,fetch:e.fetch,o11yHeaders:l()}),f}var Ea=Ta();async function Da(e){let t=Qe({settingValue:e.apiKey,environmentVariableName:`AI_GATEWAY_API_KEY`});if(t)return{token:t,authMethod:`api-key`};try{let e=await ba();return{token:e,authMethod:`oidc`}}catch{return null}}var Oa=typeof globalThis==`object`?globalThis:global,ka=`1.9.0`,Aa=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function ja(e){var t=new Set([e]),n=new Set,r=e.match(Aa);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(t){return t===e};function a(e){return n.add(e),!1}function o(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(Aa);if(!r)return a(e);var s={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};return s.prerelease!=null||i.major!==s.major?a(e):i.major===0?i.minor===s.minor&&i.patch<=s.patch?o(e):a(e):i.minor<=s.minor?o(e):a(e)}}var Ma=ja(ka),Na=ka.split(`.`)[0],Pa=Symbol.for(`opentelemetry.js.api.`+Na),Fa=Oa;function Ia(e,t,n,r){var i;r===void 0&&(r=!1);var a=Fa[Pa]=(i=Fa[Pa])??{version:ka};if(!r&&a[e]){var o=Error(`@opentelemetry/api: Attempted duplicate registration of API: `+e);return n.error(o.stack||o.message),!1}if(a.version!==ka){var o=Error(`@opentelemetry/api: Registration of version v`+a.version+` for `+e+` does not match previously registered API v`+ka);return n.error(o.stack||o.message),!1}return a[e]=t,n.debug(`@opentelemetry/api: Registered a global for `+e+` v`+ka+`.`),!0}function La(e){var t,n,r=(t=Fa[Pa])?.version;if(!(!r||!Ma(r)))return(n=Fa[Pa])?.[e]}function Ra(e,t){t.debug(`@opentelemetry/api: Unregistering a global for `+e+` v`+ka+`.`);var n=Fa[Pa];n&&delete n[e]}var za=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},Ba=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},Va=function(){function e(e){this._namespace=e.namespace||`DiagComponentLogger`}return e.prototype.debug=function(){var e=[...arguments];return Ha(`debug`,this._namespace,e)},e.prototype.error=function(){var e=[...arguments];return Ha(`error`,this._namespace,e)},e.prototype.info=function(){var e=[...arguments];return Ha(`info`,this._namespace,e)},e.prototype.warn=function(){var e=[...arguments];return Ha(`warn`,this._namespace,e)},e.prototype.verbose=function(){var e=[...arguments];return Ha(`verbose`,this._namespace,e)},e}();function Ha(e,t,n){var r=La(`diag`);if(r)return n.unshift(t),r[e].apply(r,Ba([],za(n),!1))}var Q;(function(e){e[e.NONE=0]=`NONE`,e[e.ERROR=30]=`ERROR`,e[e.WARN=50]=`WARN`,e[e.INFO=60]=`INFO`,e[e.DEBUG=70]=`DEBUG`,e[e.VERBOSE=80]=`VERBOSE`,e[e.ALL=9999]=`ALL`})(Q||={});function Ua(e,t){e<Q.NONE?e=Q.NONE:e>Q.ALL&&(e=Q.ALL),t||={};function n(n,r){var i=t[n];return typeof i==`function`&&e>=r?i.bind(t):function(){}}return{error:n(`error`,Q.ERROR),warn:n(`warn`,Q.WARN),info:n(`info`,Q.INFO),debug:n(`debug`,Q.DEBUG),verbose:n(`verbose`,Q.VERBOSE)}}var Wa=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},Ga=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},Ka=`diag`,qa=function(){function e(){function e(e){return function(){var t=[...arguments],n=La(`diag`);if(n)return n[e].apply(n,Ga([],Wa(t),!1))}}var t=this,n=function(e,n){var r,i,a;if(n===void 0&&(n={logLevel:Q.INFO}),e===t){var o=Error(`Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation`);return t.error((r=o.stack)??o.message),!1}typeof n==`number`&&(n={logLevel:n});var s=La(`diag`),c=Ua((i=n.logLevel)??Q.INFO,e);if(s&&!n.suppressOverrideMessage){var l=(a=Error().stack)??`<failed to generate stacktrace>`;s.warn(`Current logger will be overwritten from `+l),c.warn(`Current logger will overwrite one already registered from `+l)}return Ia(`diag`,c,t,!0)};t.setLogger=n,t.disable=function(){Ra(Ka,t)},t.createComponentLogger=function(e){return new Va(e)},t.verbose=e(`verbose`),t.debug=e(`debug`),t.info=e(`info`),t.warn=e(`warn`),t.error=e(`error`)}return e.instance=function(){return this._instance||=new e,this._instance},e}();function Ja(e){return Symbol.for(e)}var Ya=function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var i=new e(n._currentContext);return i._currentContext.set(t,r),i},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}}return e}(),Xa=new Ya,Za=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},Qa=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},$a=function(){function e(){}return e.prototype.active=function(){return Xa},e.prototype.with=function(e,t,n){var r=[...arguments].slice(3);return t.call.apply(t,Qa([n],Za(r),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),eo=function(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},to=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},no=`context`,ro=new $a,io=function(){function e(){}return e.getInstance=function(){return this._instance||=new e,this._instance},e.prototype.setGlobalContextManager=function(e){return Ia(no,e,qa.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,i=[],a=3;a<arguments.length;a++)i[a-3]=arguments[a];return(r=this._getContextManager()).with.apply(r,to([e,t,n],eo(i),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return La(no)||ro},e.prototype.disable=function(){this._getContextManager().disable(),Ra(no,qa.instance())},e}(),ao;(function(e){e[e.NONE=0]=`NONE`,e[e.SAMPLED=1]=`SAMPLED`})(ao||={});var oo=`0000000000000000`,so=`00000000000000000000000000000000`,co={traceId:so,spanId:oo,traceFlags:ao.NONE},lo=function(){function e(e){e===void 0&&(e=co),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),uo=Ja(`OpenTelemetry Context Key SPAN`);function fo(e){return e.getValue(uo)||void 0}function po(){return fo(io.getInstance().active())}function mo(e,t){return e.setValue(uo,t)}function ho(e){return e.deleteValue(uo)}function go(e,t){return mo(e,new lo(t))}function _o(e){var t;return(t=fo(e))?.spanContext()}var vo=/^([0-9a-f]{32})$/i,yo=/^[0-9a-f]{16}$/i;function bo(e){return vo.test(e)&&e!==so}function xo(e){return yo.test(e)&&e!==oo}function So(e){return bo(e.traceId)&&xo(e.spanId)}function Co(e){return new lo(e)}var wo=io.getInstance(),To=function(){function e(){}return e.prototype.startSpan=function(e,t,n){n===void 0&&(n=wo.active());var r=!!t?.root;if(r)return new lo;var i=n&&_o(n);return Eo(i)&&So(i)?new lo(i):new lo},e.prototype.startActiveSpan=function(e,t,n,r){var i,a,o;if(!(arguments.length<2)){arguments.length===2?o=t:arguments.length===3?(i=t,o=n):(i=t,a=n,o=r);var s=a??wo.active(),c=this.startSpan(e,i,s),l=mo(s,c);return wo.with(l,o,void 0,c)}},e}();function Eo(e){return typeof e==`object`&&typeof e.spanId==`string`&&typeof e.traceId==`string`&&typeof e.traceFlags==`number`}var Do=new To,Oo=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Do},e}(),ko=function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new To},e}(),Ao=new ko,jo=function(){function e(){}return e.prototype.getTracer=function(e,t,n){var r;return(r=this.getDelegateTracer(e,t,n))??new Oo(this,e,t,n)},e.prototype.getDelegate=function(){var e;return(e=this._delegate)??Ao},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){var r;return(r=this._delegate)?.getTracer(e,t,n)},e}(),Mo;(function(e){e[e.UNSET=0]=`UNSET`,e[e.OK=1]=`OK`,e[e.ERROR=2]=`ERROR`})(Mo||={});var No=`trace`,Po=function(){function e(){this._proxyTracerProvider=new jo,this.wrapSpanContext=Co,this.isSpanContextValid=So,this.deleteSpan=ho,this.getSpan=fo,this.getActiveSpan=po,this.getSpanContext=_o,this.setSpan=mo,this.setSpanContext=go}return e.getInstance=function(){return this._instance||=new e,this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=Ia(No,this._proxyTracerProvider,qa.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return La(No)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){Ra(No,qa.instance()),this._proxyTracerProvider=new jo},e}(),Fo=Po.getInstance(),Io=Object.defineProperty,Lo=(e,t)=>{for(var n in t)Io(e,n,{get:t[n],enumerable:!0})},Ro=`AI_NoOutputSpecifiedError`,zo=`vercel.ai.error.${Ro}`,Bo=Symbol.for(zo),Vo,Ho=class extends c{constructor({message:e=`No output specified.`}={}){super({name:Ro,message:e}),this[Vo]=!0}static isInstance(e){return c.hasMarker(e,zo)}};Vo=Bo;function Uo(e){let t=`AI SDK Warning:`;switch(e.type){case`unsupported-setting`:{let n=`${t} The "${e.setting}" setting is not supported by this model`;return e.details&&(n+=` - ${e.details}`),n}case`unsupported-tool`:{let n=`name`in e.tool?e.tool.name:`unknown tool`,r=`${t} The tool "${n}" is not supported by this model`;return e.details&&(r+=` - ${e.details}`),r}case`other`:return`${t} ${e.message}`;default:return`${t} ${JSON.stringify(e,null,2)}`}}var Wo=`AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.`,Go=!1,Ko=e=>{if(e.length===0)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(t!==!1){if(typeof t==`function`){t(e);return}Go||(Go=!0,console.info(Wo));for(let t of e)console.warn(Uo(t))}},qo=`AI_InvalidArgumentError`,Jo=`vercel.ai.error.${qo}`,Yo=Symbol.for(Jo),Xo,Zo=class extends c{constructor({parameter:e,value:t,message:n}){super({name:qo,message:`Invalid argument for parameter ${e}: ${n}`}),this[Xo]=!0,this.parameter=e,this.value=t}static isInstance(e){return c.hasMarker(e,Jo)}};Xo=Yo;var Qo=`AI_InvalidStreamPartError`,$o=`vercel.ai.error.${Qo}`,es=Symbol.for($o),ts;ts=es;var ns=`AI_InvalidToolInputError`,rs=`vercel.ai.error.${ns}`,os=Symbol.for(rs),ss,cs=class extends c{constructor({toolInput:e,toolName:t,cause:n,message:r=`Invalid input for tool ${t}: ${y(n)}`}){super({name:ns,message:r,cause:n}),this[ss]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return c.hasMarker(e,rs)}};ss=os;var ls=`AI_MCPClientError`,us=`vercel.ai.error.${ls}`,ds=Symbol.for(us),fs;fs=ds;var ps=`AI_NoImageGeneratedError`,ms=`vercel.ai.error.${ps}`,hs=Symbol.for(ms),gs;gs=hs;var _s=`AI_NoObjectGeneratedError`,vs=`vercel.ai.error.${_s}`,ys=Symbol.for(vs),bs,xs=class extends c{constructor({message:e=`No object generated.`,cause:t,text:n,response:r,usage:i,finishReason:a}){super({name:_s,message:e,cause:t}),this[bs]=!0,this.text=n,this.response=r,this.usage=i,this.finishReason=a}static isInstance(e){return c.hasMarker(e,vs)}};bs=ys;var Ss=`AI_NoOutputGeneratedError`,Cs=`vercel.ai.error.${Ss}`,ws=Symbol.for(Cs),Ts,Es=class extends c{constructor({message:e=`No output generated.`,cause:t}={}){super({name:Ss,message:e,cause:t}),this[Ts]=!0}static isInstance(e){return c.hasMarker(e,Cs)}};Ts=ws;var Ds=`AI_NoSuchToolError`,Os=`vercel.ai.error.${Ds}`,ks=Symbol.for(Os),As,js=class extends c{constructor({toolName:e,availableTools:t=void 0,message:n=`Model tried to call unavailable tool '${e}'. ${t===void 0?`No tools are available.`:`Available tools: ${t.join(`, `)}.`}`}){super({name:Ds,message:n}),this[As]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return c.hasMarker(e,Os)}};As=ks;var Ms=`AI_ToolCallRepairError`,Ns=`vercel.ai.error.${Ms}`,Ps=Symbol.for(Ns),Fs,Is=class extends c{constructor({cause:e,originalError:t,message:n=`Error repairing tool call: ${y(e)}`}){super({name:Ms,message:n,cause:e}),this[Fs]=!0,this.originalError=t}static isInstance(e){return c.hasMarker(e,Ns)}};Fs=Ps;var Ls=class extends c{constructor(e){super({name:`AI_UnsupportedModelVersionError`,message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},Rs=`AI_InvalidDataContentError`,zs=`vercel.ai.error.${Rs}`,Bs=Symbol.for(zs),Vs;Vs=Bs;var Hs=`AI_InvalidMessageRoleError`,Us=`vercel.ai.error.${Hs}`,Ws=Symbol.for(Us),Gs,Ks=class extends c{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Hs,message:t}),this[Gs]=!0,this.role=e}static isInstance(e){return c.hasMarker(e,Us)}};Gs=Ws;var qs=`AI_MessageConversionError`,Js=`vercel.ai.error.${qs}`,Ys=Symbol.for(Js),Xs;Xs=Ys;var Zs=`AI_DownloadError`,Qs=`vercel.ai.error.${Zs}`,$s=Symbol.for(Qs),ec,tc=class extends c{constructor({url:e,statusCode:t,statusText:n,cause:r,message:i=r==null?`Failed to download ${e}: ${t} ${n}`:`Failed to download ${e}: ${r}`}){super({name:Zs,message:i,cause:r}),this[ec]=!0,this.url=e,this.statusCode=t,this.statusText=n}static isInstance(e){return c.hasMarker(e,Qs)}};ec=$s;var nc=`AI_RetryError`,rc=`vercel.ai.error.${nc}`,ic=Symbol.for(rc),ac,oc=class extends c{constructor({message:e,reason:t,errors:n}){super({name:nc,message:e}),this[ac]=!0,this.reason=t,this.errors=n,this.lastError=n[n.length-1]}static isInstance(e){return c.hasMarker(e,rc)}};ac=ic;function sc(e){if(typeof e!=`string`){if(e.specificationVersion!==`v2`)throw new Ls({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return cc().languageModel(e)}function cc(){var e;return(e=globalThis.AI_SDK_DEFAULT_PROVIDER)??Ea}var lc=[{mediaType:`image/gif`,bytesPrefix:[71,73,70],base64Prefix:`R0lG`},{mediaType:`image/png`,bytesPrefix:[137,80,78,71],base64Prefix:`iVBORw`},{mediaType:`image/jpeg`,bytesPrefix:[255,216],base64Prefix:`/9j/`},{mediaType:`image/webp`,bytesPrefix:[82,73,70,70],base64Prefix:`UklGRg`},{mediaType:`image/bmp`,bytesPrefix:[66,77],base64Prefix:`Qk`},{mediaType:`image/tiff`,bytesPrefix:[73,73,42,0],base64Prefix:`SUkqAA`},{mediaType:`image/tiff`,bytesPrefix:[77,77,0,42],base64Prefix:`TU0AKg`},{mediaType:`image/avif`,bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:`AAAAIGZ0eXBhdmlm`},{mediaType:`image/heic`,bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:`AAAAIGZ0eXBoZWlj`}],uc=e=>{let t=typeof e==`string`?Mn(e):e,n=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(n+10)};function dc(e){let t=typeof e==`string`&&e.startsWith(`SUQz`)||typeof e!=`string`&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51;return t?uc(e):e}function fc({data:e,signatures:t}){let n=dc(e);for(let e of t)if(typeof n==`string`?n.startsWith(e.base64Prefix):n.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>n[t]===e))return e.mediaType}var pc=async({url:e})=>{var t;let n=e.toString();try{let e=await fetch(n);if(!e.ok)throw new tc({url:n,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:(t=e.headers.get(`content-type`))??void 0}}catch(e){throw tc.isInstance(e)?e:new tc({url:n,cause:e})}},mc=(e=pc)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t)));function hc(e){try{let[t,n]=e.split(`,`);return{mediaType:t.split(`;`)[0].split(`:`)[1],base64Content:n}}catch{return{mediaType:void 0,base64Content:void 0}}}var gc=n.z.union([n.z.string(),n.z.instanceof(Uint8Array),n.z.instanceof(ArrayBuffer),n.z.custom(e=>{var t,n;return(n=(t=globalThis.Buffer)?.isBuffer(e))??!1},{message:`Must be a Buffer`})]);function _c(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if(typeof e==`string`)try{e=new URL(e)}catch{}if(e instanceof URL&&e.protocol===`data:`){let{mediaType:t,base64Content:n}=hc(e.toString());if(t==null||n==null)throw new c({name:`InvalidDataContentError`,message:`Invalid data URL format in content ${e.toString()}`});return{data:n,mediaType:t}}return{data:e,mediaType:void 0}}function vc(e){return typeof e==`string`?e:e instanceof ArrayBuffer?Nn(new Uint8Array(e)):Nn(e)}async function yc({prompt:e,supportedUrls:t,download:n=mc()}){let r=await xc(e.messages,n,t);return[...e.system==null?[]:[{role:`system`,content:e.system}],...e.messages.map(e=>bc({message:e,downloadedAssets:r}))]}function bc({message:e,downloadedAssets:t}){let n=e.role;switch(n){case`system`:return{role:`system`,content:e.content,providerOptions:e.providerOptions};case`user`:return typeof e.content==`string`?{role:`user`,content:[{type:`text`,text:e.content}],providerOptions:e.providerOptions}:{role:`user`,content:e.content.map(e=>Sc(e,t)).filter(e=>e.type!==`text`||e.text!==``),providerOptions:e.providerOptions};case`assistant`:return typeof e.content==`string`?{role:`assistant`,content:[{type:`text`,text:e.content}],providerOptions:e.providerOptions}:{role:`assistant`,content:e.content.filter(e=>e.type!==`text`||e.text!==``).map(e=>{let t=e.providerOptions;switch(e.type){case`file`:{let{data:n,mediaType:r}=_c(e.data);return{type:`file`,data:n,filename:e.filename,mediaType:r??e.mediaType,providerOptions:t}}case`reasoning`:return{type:`reasoning`,text:e.text,providerOptions:t};case`text`:return{type:`text`,text:e.text,providerOptions:t};case`tool-call`:return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case`tool-result`:return{type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:t}}}),providerOptions:e.providerOptions};case`tool`:return{role:`tool`,content:e.content.map(e=>({type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:e.providerOptions})),providerOptions:e.providerOptions};default:{let e=n;throw new Ks({role:e})}}}async function xc(e,t,n){let r=e.filter(e=>e.role===`user`).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>e.type===`image`||e.type===`file`).map(e=>{var t;let n=(t=e.mediaType)??(e.type===`image`?`image/*`:void 0),r=e.type===`image`?e.image:e.data;if(typeof r==`string`)try{r=new URL(r)}catch{}return{mediaType:n,data:r}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:e.mediaType!=null&&Xe({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:n})})),i=await t(r);return Object.fromEntries(i.filter(e=>e?.data!=null).map(({data:e,mediaType:t},n)=>[r[n].url.toString(),{data:e,mediaType:t}]))}function Sc(e,t){var n;if(e.type===`text`)return{type:`text`,text:e.text,providerOptions:e.providerOptions};let r,i=e.type;switch(i){case`image`:r=e.image;break;case`file`:r=e.data;break;default:throw Error(`Unsupported part type: ${i}`)}let{data:a,mediaType:o}=_c(r),s=o??e.mediaType,c=a;if(c instanceof URL){let e=t[c.toString()];e&&(c=e.data,s??=e.mediaType)}switch(i){case`image`:return(c instanceof Uint8Array||typeof c==`string`)&&(s=(n=fc({data:c,signatures:lc}))??s),{type:`file`,mediaType:s??`image/*`,filename:void 0,data:c,providerOptions:e.providerOptions};case`file`:if(s==null)throw Error(`Media type is missing for file part`);return{type:`file`,mediaType:s,filename:e.filename,data:c,providerOptions:e.providerOptions}}}function Cc({maxOutputTokens:e,temperature:t,topP:n,topK:r,presencePenalty:i,frequencyPenalty:a,seed:o,stopSequences:s}){if(e!=null){if(!Number.isInteger(e))throw new Zo({parameter:`maxOutputTokens`,value:e,message:`maxOutputTokens must be an integer`});if(e<1)throw new Zo({parameter:`maxOutputTokens`,value:e,message:`maxOutputTokens must be >= 1`})}if(t!=null&&typeof t!=`number`)throw new Zo({parameter:`temperature`,value:t,message:`temperature must be a number`});if(n!=null&&typeof n!=`number`)throw new Zo({parameter:`topP`,value:n,message:`topP must be a number`});if(r!=null&&typeof r!=`number`)throw new Zo({parameter:`topK`,value:r,message:`topK must be a number`});if(i!=null&&typeof i!=`number`)throw new Zo({parameter:`presencePenalty`,value:i,message:`presencePenalty must be a number`});if(a!=null&&typeof a!=`number`)throw new Zo({parameter:`frequencyPenalty`,value:a,message:`frequencyPenalty must be a number`});if(o!=null&&!Number.isInteger(o))throw new Zo({parameter:`seed`,value:o,message:`seed must be an integer`});return{maxOutputTokens:e,temperature:t,topP:n,topK:r,presencePenalty:i,frequencyPenalty:a,stopSequences:s,seed:o}}function wc(e){return e!=null&&Object.keys(e).length>0}function Tc({tools:e,toolChoice:t,activeTools:n}){if(!wc(e))return{tools:void 0,toolChoice:void 0};let r=n==null?Object.entries(e):Object.entries(e).filter(([e])=>n.includes(e));return{tools:r.map(([e,t])=>{let n=t.type;switch(n){case void 0:case`dynamic`:case`function`:return{type:`function`,name:e,description:t.description,inputSchema:kn(t.inputSchema).jsonSchema,providerOptions:t.providerOptions};case`provider-defined`:return{type:`provider-defined`,name:e,id:t.id,args:t.args};default:{let e=n;throw Error(`Unsupported tool type: ${e}`)}}}),toolChoice:t==null?{type:`auto`}:typeof t==`string`?{type:t}:{type:`tool`,toolName:t.toolName}}}var Ec=n.z.lazy(()=>n.z.union([n.z.null(),n.z.string(),n.z.number(),n.z.boolean(),n.z.record(n.z.string(),Ec),n.z.array(Ec)])),$=n.z.record(n.z.string(),n.z.record(n.z.string(),Ec)),Dc=n.z.object({type:n.z.literal(`text`),text:n.z.string(),providerOptions:$.optional()}),Oc=n.z.object({type:n.z.literal(`image`),image:n.z.union([gc,n.z.instanceof(URL)]),mediaType:n.z.string().optional(),providerOptions:$.optional()}),kc=n.z.object({type:n.z.literal(`file`),data:n.z.union([gc,n.z.instanceof(URL)]),filename:n.z.string().optional(),mediaType:n.z.string(),providerOptions:$.optional()}),Ac=n.z.object({type:n.z.literal(`reasoning`),text:n.z.string(),providerOptions:$.optional()}),jc=n.z.object({type:n.z.literal(`tool-call`),toolCallId:n.z.string(),toolName:n.z.string(),input:n.z.unknown(),providerOptions:$.optional(),providerExecuted:n.z.boolean().optional()}),Mc=n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`text`),value:n.z.string()}),n.z.object({type:n.z.literal(`json`),value:Ec}),n.z.object({type:n.z.literal(`error-text`),value:n.z.string()}),n.z.object({type:n.z.literal(`error-json`),value:Ec}),n.z.object({type:n.z.literal(`content`),value:n.z.array(n.z.union([n.z.object({type:n.z.literal(`text`),text:n.z.string()}),n.z.object({type:n.z.literal(`media`),data:n.z.string(),mediaType:n.z.string()})]))})]),Nc=n.z.object({type:n.z.literal(`tool-result`),toolCallId:n.z.string(),toolName:n.z.string(),output:Mc,providerOptions:$.optional()}),Pc=n.z.object({role:n.z.literal(`system`),content:n.z.string(),providerOptions:$.optional()}),Fc=n.z.object({role:n.z.literal(`user`),content:n.z.union([n.z.string(),n.z.array(n.z.union([Dc,Oc,kc]))]),providerOptions:$.optional()}),Ic=n.z.object({role:n.z.literal(`assistant`),content:n.z.union([n.z.string(),n.z.array(n.z.union([Dc,kc,Ac,jc,Nc]))]),providerOptions:$.optional()}),Lc=n.z.object({role:n.z.literal(`tool`),content:n.z.array(Nc),providerOptions:$.optional()}),Rc=n.z.union([Pc,Fc,Ic,Lc]);async function zc(e){if(e.prompt==null&&e.messages==null)throw new k({prompt:e,message:`prompt or messages must be defined`});if(e.prompt!=null&&e.messages!=null)throw new k({prompt:e,message:`prompt and messages cannot be defined at the same time`});if(e.system!=null&&typeof e.system!=`string`)throw new k({prompt:e,message:`system must be a string`});let t;if(e.prompt!=null&&typeof e.prompt==`string`)t=[{role:`user`,content:e.prompt}];else if(e.prompt!=null&&Array.isArray(e.prompt))t=e.prompt;else if(e.messages!=null)t=e.messages;else throw new k({prompt:e,message:`prompt or messages must be defined`});if(t.length===0)throw new k({prompt:e,message:`messages must not be empty`});let r=await dt({value:t,schema:n.z.array(Rc)});if(!r.success)throw new k({prompt:e,message:`The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.`,cause:r.error});return{messages:t,system:e.system}}function Bc(e){return Di.isInstance(e)||Ki.isInstance(e)?new c({name:`GatewayError`,message:`Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.`,cause:e}):e}function Vc({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId==null?``:` ${t.functionId}`}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function Hc({model:e,settings:t,telemetry:n,headers:r}){var i;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,n])=>(e[`ai.settings.${t}`]=n,e),{}),...Object.entries((i=n?.metadata)??{}).reduce((e,[t,n])=>(e[`ai.telemetry.metadata.${t}`]=n,e),{}),...Object.entries(r??{}).reduce((e,[t,n])=>(n!==void 0&&(e[`ai.request.headers.${t}`]=n),e),{})}}var Uc={startSpan(){return Wc},startActiveSpan(e,t,n,r){if(typeof t==`function`)return t(Wc);if(typeof n==`function`)return n(Wc);if(typeof r==`function`)return r(Wc)}},Wc={spanContext(){return Gc},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Gc={traceId:``,spanId:``,traceFlags:0};function Kc({isEnabled:e=!1,tracer:t}={}){return e?t||Fo.getTracer(`ai`):Uc}function qc({name:e,tracer:t,attributes:n,fn:r,endWhenDone:i=!0}){return t.startActiveSpan(e,{attributes:n},async e=>{try{let t=await r(e);return i&&e.end(),t}catch(t){try{Jc(e,t)}finally{e.end()}throw t}})}function Jc(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:Mo.ERROR,message:t.message})):e.setStatus({code:Mo.ERROR})}function Yc({telemetry:e,attributes:t}){return e?.isEnabled===!0?Object.entries(t).reduce((t,[n,r])=>{if(r==null)return t;if(typeof r==`object`&&`input`in r&&typeof r.input==`function`){if(e?.recordInputs===!1)return t;let i=r.input();return i==null?t:{...t,[n]:i}}if(typeof r==`object`&&`output`in r&&typeof r.output==`function`){if(e?.recordOutputs===!1)return t;let i=r.output();return i==null?t:{...t,[n]:i}}return{...t,[n]:r}},{}):{}}function Xc(e){return JSON.stringify(e.map(e=>({...e,content:typeof e.content==`string`?e.content:e.content.map(e=>e.type===`file`?{...e,data:e.data instanceof Uint8Array?vc(e.data):e.data}:e)})))}function Zc(e,t){return{inputTokens:Qc(e.inputTokens,t.inputTokens),outputTokens:Qc(e.outputTokens,t.outputTokens),totalTokens:Qc(e.totalTokens,t.totalTokens),reasoningTokens:Qc(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:Qc(e.cachedInputTokens,t.cachedInputTokens)}}function Qc(e,t){return e==null&&t==null?void 0:(e??0)+(t??0)}function $c(e){return e===void 0?[]:Array.isArray(e)?e:[e]}function el({error:e,exponentialBackoffDelay:t}){let n=e.responseHeaders;if(!n)return t;let r,i=n[`retry-after-ms`];if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n[`retry-after`];if(a&&r===void 0){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():e*1e3}return r!=null&&!Number.isNaN(r)&&0<=r&&(r<60*1e3||r<t)?r:t}var tl=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:n=2,abortSignal:r}={})=>async i=>nl(i,{maxRetries:e,delayInMs:t,backoffFactor:n,abortSignal:r});async function nl(e,{maxRetries:t,delayInMs:n,backoffFactor:r,abortSignal:i},a=[]){try{return await e()}catch(o){if(We(o)||t===0)throw o;let s=Ue(o),c=[...a,o],l=c.length;if(l>t)throw new oc({message:`Failed after ${l} attempts. Last error: ${s}`,reason:`maxRetriesExceeded`,errors:c});if(o instanceof Error&&p.isInstance(o)&&o.isRetryable===!0&&l<=t)return await ze(el({error:o,exponentialBackoffDelay:n}),{abortSignal:i}),nl(e,{maxRetries:t,delayInMs:r*n,backoffFactor:r,abortSignal:i},c);throw l===1?o:new oc({message:`Failed after ${l} attempts with non-retryable error: '${s}'`,reason:`errorNotRetryable`,errors:c})}}function rl({maxRetries:e,abortSignal:t}){if(e!=null){if(!Number.isInteger(e))throw new Zo({parameter:`maxRetries`,value:e,message:`maxRetries must be an integer`});if(e<0)throw new Zo({parameter:`maxRetries`,value:e,message:`maxRetries must be >= 0`})}let n=e??2;return{maxRetries:n,retry:tl({maxRetries:n,abortSignal:t})}}var il=class{constructor({data:e,mediaType:t}){let n=e instanceof Uint8Array;this.base64Data=n?void 0:e,this.uint8ArrayData=n?e:void 0,this.mediaType=t}get base64(){return this.base64Data??=Nn(this.uint8ArrayData),this.base64Data}get uint8Array(){return this.uint8ArrayData??=Mn(this.base64Data),this.uint8ArrayData}},al=class extends il{constructor(e){super(e),this.type=`file`}};async function ol({toolCall:e,tools:t,repairToolCall:n,system:r,messages:i}){try{if(t==null)throw new js({toolName:e.toolName});try{return await sl({toolCall:e,tools:t})}catch(a){if(n==null||!(js.isInstance(a)||cs.isInstance(a)))throw a;let o=null;try{o=await n({toolCall:e,tools:t,inputSchema:({toolName:e})=>{let{inputSchema:n}=t[e];return kn(n).jsonSchema},system:r,messages:i,error:a})}catch(e){throw new Is({cause:e,originalError:a})}if(o==null)throw a;return await sl({toolCall:o,tools:t})}}catch(t){let n=await pt({text:e.input}),r=n.success?n.value:e.input;return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:r,dynamic:!0,invalid:!0,error:t}}}async function sl({toolCall:e,tools:t}){let n=e.toolName,r=t[n];if(r==null)throw new js({toolName:e.toolName,availableTools:Object.keys(t)});let i=kn(r.inputSchema),a=e.input.trim()===``?await dt({value:{},schema:i}):await pt({text:e.input,schema:i});if(a.success===!1)throw new cs({toolName:n,toolInput:e.input,cause:a.error});return r.type===`dynamic`?{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:a.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:`tool-call`,toolCallId:e.toolCallId,toolName:n,input:a.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var cl=class{constructor({content:e,finishReason:t,usage:n,warnings:r,request:i,response:a,providerMetadata:o}){this.content=e,this.finishReason=t,this.usage=n,this.warnings=r,this.request=i,this.response=a,this.providerMetadata=o}get text(){return this.content.filter(e=>e.type===`text`).map(e=>e.text).join(``)}get reasoning(){return this.content.filter(e=>e.type===`reasoning`)}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(e=>e.text).join(``)}get files(){return this.content.filter(e=>e.type===`file`).map(e=>e.file)}get sources(){return this.content.filter(e=>e.type===`source`)}get toolCalls(){return this.content.filter(e=>e.type===`tool-call`)}get staticToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!1)}get dynamicToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!0)}get toolResults(){return this.content.filter(e=>e.type===`tool-result`)}get staticToolResults(){return this.toolResults.filter(e=>e.dynamic===!1)}get dynamicToolResults(){return this.toolResults.filter(e=>e.dynamic===!0)}};function ll(e){return({steps:t})=>t.length===e}async function ul({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}function dl({output:e,tool:t,errorMode:n}){return n===`text`?{type:`error-text`,value:y(e)}:n===`json`?{type:`error-json`,value:fl(e)}:t?.toModelOutput?t.toModelOutput(e):typeof e==`string`?{type:`text`,value:e}:{type:`json`,value:fl(e)}}function fl(e){return e===void 0?null:e}function pl({content:e,tools:t}){let n=[],r=e.filter(e=>e.type!==`source`).filter(e=>(e.type!==`tool-result`||e.providerExecuted)&&(e.type!==`tool-error`||e.providerExecuted)).filter(e=>e.type!==`text`||e.text.length>0).map(e=>{switch(e.type){case`text`:return{type:`text`,text:e.text,providerOptions:e.providerMetadata};case`reasoning`:return{type:`reasoning`,text:e.text,providerOptions:e.providerMetadata};case`file`:return{type:`file`,data:e.file.base64,mediaType:e.file.mediaType,providerOptions:e.providerMetadata};case`tool-call`:return{type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:e.providerMetadata};case`tool-result`:return{type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:dl({tool:t?.[e.toolName],output:e.output,errorMode:`none`}),providerExecuted:!0,providerOptions:e.providerMetadata};case`tool-error`:return{type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:dl({tool:t?.[e.toolName],output:e.error,errorMode:`json`}),providerOptions:e.providerMetadata}}});r.length>0&&n.push({role:`assistant`,content:r});let i=e.filter(e=>e.type===`tool-result`||e.type===`tool-error`).filter(e=>!e.providerExecuted).map(e=>({type:`tool-result`,toolCallId:e.toolCallId,toolName:e.toolName,output:dl({tool:t?.[e.toolName],output:e.type===`tool-result`?e.output:e.error,errorMode:e.type===`tool-error`?`text`:`none`})}));return i.length>0&&n.push({role:`tool`,content:i}),n}var ml=He({prefix:`aitxt`,size:24});function hl(e,t){let n=new Headers(e??{});for(let[e,r]of Object.entries(t))n.has(e)||n.set(e,r);return n}function gl({status:e,statusText:t,headers:n,textStream:r}){return new Response(r.pipeThrough(new TextEncoderStream),{status:e??200,statusText:t,headers:hl(n,{"content-type":`text/plain; charset=utf-8`})})}function _l({response:e,status:t,statusText:n,headers:r,stream:i}){e.writeHead(t??200,n,r);let a=i.getReader(),o=async()=>{try{for(;;){let{done:t,value:n}=await a.read();if(t)break;e.write(n)}}catch(e){throw e}finally{e.end()}};o()}function vl({response:e,status:t,statusText:n,headers:r,textStream:i}){_l({response:e,status:t,statusText:n,headers:Object.fromEntries(hl(r,{"content-type":`text/plain; charset=utf-8`}).entries()),stream:i.pipeThrough(new TextEncoderStream)})}var yl=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}},bl={"content-type":`text/event-stream`,"cache-control":`no-cache`,connection:`keep-alive`,"x-vercel-ai-ui-message-stream":`v1`,"x-accel-buffering":`no`};function xl({status:e,statusText:t,headers:n,stream:r,consumeSseStream:i}){let a=r.pipeThrough(new yl);if(i){let[e,t]=a.tee();a=e,i({stream:t})}return new Response(a.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:hl(n,bl)})}function Sl({originalMessages:e,responseMessageId:t}){if(e==null)return;let n=e[e.length-1];return n?.role===`assistant`?n.id:typeof t==`function`?t():t}var Cl=n.z.union([n.z.strictObject({type:n.z.literal(`text-start`),id:n.z.string(),providerMetadata:$.optional()}),n.z.strictObject({type:n.z.literal(`text-delta`),id:n.z.string(),delta:n.z.string(),providerMetadata:$.optional()}),n.z.strictObject({type:n.z.literal(`text-end`),id:n.z.string(),providerMetadata:$.optional()}),n.z.strictObject({type:n.z.literal(`error`),errorText:n.z.string()}),n.z.strictObject({type:n.z.literal(`tool-input-start`),toolCallId:n.z.string(),toolName:n.z.string(),providerExecuted:n.z.boolean().optional(),dynamic:n.z.boolean().optional()}),n.z.strictObject({type:n.z.literal(`tool-input-delta`),toolCallId:n.z.string(),inputTextDelta:n.z.string()}),n.z.strictObject({type:n.z.literal(`tool-input-available`),toolCallId:n.z.string(),toolName:n.z.string(),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),providerMetadata:$.optional(),dynamic:n.z.boolean().optional()}),n.z.strictObject({type:n.z.literal(`tool-input-error`),toolCallId:n.z.string(),toolName:n.z.string(),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),providerMetadata:$.optional(),dynamic:n.z.boolean().optional(),errorText:n.z.string()}),n.z.strictObject({type:n.z.literal(`tool-output-available`),toolCallId:n.z.string(),output:n.z.unknown(),providerExecuted:n.z.boolean().optional(),dynamic:n.z.boolean().optional(),preliminary:n.z.boolean().optional()}),n.z.strictObject({type:n.z.literal(`tool-output-error`),toolCallId:n.z.string(),errorText:n.z.string(),providerExecuted:n.z.boolean().optional(),dynamic:n.z.boolean().optional()}),n.z.strictObject({type:n.z.literal(`reasoning`),text:n.z.string(),providerMetadata:$.optional()}),n.z.strictObject({type:n.z.literal(`reasoning-start`),id:n.z.string(),providerMetadata:$.optional()}),n.z.strictObject({type:n.z.literal(`reasoning-delta`),id:n.z.string(),delta:n.z.string(),providerMetadata:$.optional()}),n.z.strictObject({type:n.z.literal(`reasoning-end`),id:n.z.string(),providerMetadata:$.optional()}),n.z.strictObject({type:n.z.literal(`reasoning-part-finish`)}),n.z.strictObject({type:n.z.literal(`source-url`),sourceId:n.z.string(),url:n.z.string(),title:n.z.string().optional(),providerMetadata:$.optional()}),n.z.strictObject({type:n.z.literal(`source-document`),sourceId:n.z.string(),mediaType:n.z.string(),title:n.z.string(),filename:n.z.string().optional(),providerMetadata:$.optional()}),n.z.strictObject({type:n.z.literal(`file`),url:n.z.string(),mediaType:n.z.string(),providerMetadata:$.optional()}),n.z.strictObject({type:n.z.string().startsWith(`data-`),id:n.z.string().optional(),data:n.z.unknown(),transient:n.z.boolean().optional()}),n.z.strictObject({type:n.z.literal(`start-step`)}),n.z.strictObject({type:n.z.literal(`finish-step`)}),n.z.strictObject({type:n.z.literal(`start`),messageId:n.z.string().optional(),messageMetadata:n.z.unknown().optional()}),n.z.strictObject({type:n.z.literal(`finish`),messageMetadata:n.z.unknown().optional()}),n.z.strictObject({type:n.z.literal(`abort`)}),n.z.strictObject({type:n.z.literal(`message-metadata`),messageMetadata:n.z.unknown()})]);function wl(e){return e.type.startsWith(`data-`)}function Tl(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;let n={...e};for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let i=t[r];if(i===void 0)continue;let a=r in e?e[r]:void 0,o=typeof i==`object`&&!!i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp),s=typeof a==`object`&&!!a&&!Array.isArray(a)&&!(a instanceof Date)&&!(a instanceof RegExp);o&&s?n[r]=Tl(a,i):n[r]=i}return n}function El(e){let t=[`ROOT`],n=-1,r=null;function i(e,i,a){switch(e){case`"`:n=i,t.pop(),t.push(a),t.push(`INSIDE_STRING`);break;case`f`:case`t`:case`n`:n=i,r=i,t.pop(),t.push(a),t.push(`INSIDE_LITERAL`);break;case`-`:t.pop(),t.push(a),t.push(`INSIDE_NUMBER`);break;case`0`:case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:n=i,t.pop(),t.push(a),t.push(`INSIDE_NUMBER`);break;case`{`:n=i,t.pop(),t.push(a),t.push(`INSIDE_OBJECT_START`);break;case`[`:n=i,t.pop(),t.push(a),t.push(`INSIDE_ARRAY_START`);break}}function a(e,r){switch(e){case`,`:t.pop(),t.push(`INSIDE_OBJECT_AFTER_COMMA`);break;case`}`:n=r,t.pop();break}}function o(e,r){switch(e){case`,`:t.pop(),t.push(`INSIDE_ARRAY_AFTER_COMMA`);break;case`]`:n=r,t.pop();break}}for(let s=0;s<e.length;s++){let c=e[s],l=t[t.length-1];switch(l){case`ROOT`:i(c,s,`FINISH`);break;case`INSIDE_OBJECT_START`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_KEY`);break;case`}`:n=s,t.pop();break}break;case`INSIDE_OBJECT_AFTER_COMMA`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_KEY`);break}break;case`INSIDE_OBJECT_KEY`:switch(c){case`"`:t.pop(),t.push(`INSIDE_OBJECT_AFTER_KEY`);break}break;case`INSIDE_OBJECT_AFTER_KEY`:switch(c){case`:`:t.pop(),t.push(`INSIDE_OBJECT_BEFORE_VALUE`);break}break;case`INSIDE_OBJECT_BEFORE_VALUE`:i(c,s,`INSIDE_OBJECT_AFTER_VALUE`);break;case`INSIDE_OBJECT_AFTER_VALUE`:a(c,s);break;case`INSIDE_STRING`:switch(c){case`"`:t.pop(),n=s;break;case`\\`:t.push(`INSIDE_STRING_ESCAPE`);break;default:n=s}break;case`INSIDE_ARRAY_START`:switch(c){case`]`:n=s,t.pop();break;default:n=s,i(c,s,`INSIDE_ARRAY_AFTER_VALUE`);break}break;case`INSIDE_ARRAY_AFTER_VALUE`:switch(c){case`,`:t.pop(),t.push(`INSIDE_ARRAY_AFTER_COMMA`);break;case`]`:n=s,t.pop();break;default:n=s;break}break;case`INSIDE_ARRAY_AFTER_COMMA`:i(c,s,`INSIDE_ARRAY_AFTER_VALUE`);break;case`INSIDE_STRING_ESCAPE`:t.pop(),n=s;break;case`INSIDE_NUMBER`:switch(c){case`0`:case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:n=s;break;case`e`:case`E`:case`-`:case`.`:break;case`,`:t.pop(),t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`&&a(c,s);break;case`}`:t.pop(),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`&&a(c,s);break;case`]`:t.pop(),t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s);break;default:t.pop();break}break;case`INSIDE_LITERAL`:{let i=e.substring(r,s+1);!`false`.startsWith(i)&&!`true`.startsWith(i)&&!`null`.startsWith(i)?(t.pop(),t[t.length-1]===`INSIDE_OBJECT_AFTER_VALUE`?a(c,s):t[t.length-1]===`INSIDE_ARRAY_AFTER_VALUE`&&o(c,s)):n=s;break}}}let s=e.slice(0,n+1);for(let n=t.length-1;n>=0;n--){let i=t[n];switch(i){case`INSIDE_STRING`:s+=`"`;break;case`INSIDE_OBJECT_KEY`:case`INSIDE_OBJECT_AFTER_KEY`:case`INSIDE_OBJECT_AFTER_COMMA`:case`INSIDE_OBJECT_START`:case`INSIDE_OBJECT_BEFORE_VALUE`:case`INSIDE_OBJECT_AFTER_VALUE`:s+=`}`;break;case`INSIDE_ARRAY_START`:case`INSIDE_ARRAY_AFTER_COMMA`:case`INSIDE_ARRAY_AFTER_VALUE`:s+=`]`;break;case`INSIDE_LITERAL`:{let t=e.substring(r,e.length);`true`.startsWith(t)?s+=`true`.slice(t.length):`false`.startsWith(t)?s+=`false`.slice(t.length):`null`.startsWith(t)&&(s+=`null`.slice(t.length))}}}return s}async function Dl(e){if(e===void 0)return{value:void 0,state:`undefined-input`};let t=await pt({text:e});return t.success?{value:t.value,state:`successful-parse`}:(t=await pt({text:El(e)}),t.success?{value:t.value,state:`repaired-parse`}:{value:void 0,state:`failed-parse`})}function Ol(e){return e.type.startsWith(`tool-`)}function kl(e){return e.type.split(`-`).slice(1).join(`-`)}function Al({lastMessage:e,messageId:t}){return{message:e?.role===`assistant`?e:{id:t,metadata:void 0,role:`assistant`,parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function jl({stream:e,messageMetadataSchema:t,dataPartSchemas:n,runUpdateMessageJob:r,onError:i,onToolCall:a,onData:o}){return e.pipeThrough(new TransformStream({async transform(e,s){await r(async({state:r,write:c})=>{var l,u,d,f;function p(e){let t=r.message.parts.filter(Ol),n=t.find(t=>t.toolCallId===e);if(n==null)throw Error(`tool-output-error must be preceded by a tool-input-available`);return n}function m(e){let t=r.message.parts.filter(e=>e.type===`dynamic-tool`),n=t.find(t=>t.toolCallId===e);if(n==null)throw Error(`tool-output-error must be preceded by a tool-input-available`);return n}function h(e){var t;let n=r.message.parts.find(t=>Ol(t)&&t.toolCallId===e.toolCallId),i=e,a=n;n==null?r.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,input:i.input,output:i.output,rawInput:i.rawInput,errorText:i.errorText,providerExecuted:i.providerExecuted,preliminary:i.preliminary,...i.providerMetadata==null?{}:{callProviderMetadata:i.providerMetadata}}):(n.state=e.state,a.input=i.input,a.output=i.output,a.errorText=i.errorText,a.rawInput=i.rawInput,a.preliminary=i.preliminary,a.providerExecuted=(t=i.providerExecuted)??n.providerExecuted,i.providerMetadata!=null&&n.state===`input-available`&&(n.callProviderMetadata=i.providerMetadata))}function g(e){var t;let n=r.message.parts.find(t=>t.type===`dynamic-tool`&&t.toolCallId===e.toolCallId),i=e,a=n;n==null?r.message.parts.push({type:`dynamic-tool`,toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:i.input,output:i.output,errorText:i.errorText,preliminary:i.preliminary,...i.providerMetadata==null?{}:{callProviderMetadata:i.providerMetadata}}):(n.state=e.state,a.toolName=e.toolName,a.input=i.input,a.output=i.output,a.errorText=i.errorText,a.rawInput=(t=i.rawInput)??a.rawInput,a.preliminary=i.preliminary,i.providerMetadata!=null&&n.state===`input-available`&&(n.callProviderMetadata=i.providerMetadata))}async function _(e){if(e!=null){let n=r.message.metadata==null?e:Tl(r.message.metadata,e);t!=null&&await ut({value:n,schema:t}),r.message.metadata=n}}switch(e.type){case`text-start`:{let t={type:`text`,text:``,providerMetadata:e.providerMetadata,state:`streaming`};r.activeTextParts[e.id]=t,r.message.parts.push(t),c();break}case`text-delta`:{let t=r.activeTextParts[e.id];t.text+=e.delta,t.providerMetadata=(l=e.providerMetadata)??t.providerMetadata,c();break}case`text-end`:{let t=r.activeTextParts[e.id];t.state=`done`,t.providerMetadata=(u=e.providerMetadata)??t.providerMetadata,delete r.activeTextParts[e.id],c();break}case`reasoning-start`:{let t={type:`reasoning`,text:``,providerMetadata:e.providerMetadata,state:`streaming`};r.activeReasoningParts[e.id]=t,r.message.parts.push(t),c();break}case`reasoning-delta`:{let t=r.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=(d=e.providerMetadata)??t.providerMetadata,c();break}case`reasoning-end`:{let t=r.activeReasoningParts[e.id];t.providerMetadata=(f=e.providerMetadata)??t.providerMetadata,t.state=`done`,delete r.activeReasoningParts[e.id],c();break}case`file`:r.message.parts.push({type:`file`,mediaType:e.mediaType,url:e.url}),c();break;case`source-url`:r.message.parts.push({type:`source-url`,sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),c();break;case`source-document`:r.message.parts.push({type:`source-document`,sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),c();break;case`tool-input-start`:{let t=r.message.parts.filter(Ol);r.partialToolCalls[e.toolCallId]={text:``,toolName:e.toolName,index:t.length,dynamic:e.dynamic},e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-streaming`,input:void 0}):h({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-streaming`,input:void 0,providerExecuted:e.providerExecuted}),c();break}case`tool-input-delta`:{let t=r.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:n}=await Dl(t.text);t.dynamic?g({toolCallId:e.toolCallId,toolName:t.toolName,state:`input-streaming`,input:n}):h({toolCallId:e.toolCallId,toolName:t.toolName,state:`input-streaming`,input:n}),c();break}case`tool-input-available`:e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-available`,input:e.input,providerMetadata:e.providerMetadata}):h({toolCallId:e.toolCallId,toolName:e.toolName,state:`input-available`,input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),c(),a&&!e.providerExecuted&&await a({toolCall:e});break;case`tool-input-error`:e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:`output-error`,input:e.input,errorText:e.errorText,providerMetadata:e.providerMetadata}):h({toolCallId:e.toolCallId,toolName:e.toolName,state:`output-error`,input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),c();break;case`tool-output-available`:if(e.dynamic){let t=m(e.toolCallId);g({toolCallId:e.toolCallId,toolName:t.toolName,state:`output-available`,input:t.input,output:e.output,preliminary:e.preliminary})}else{let t=p(e.toolCallId);h({toolCallId:e.toolCallId,toolName:kl(t),state:`output-available`,input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary})}c();break;case`tool-output-error`:if(e.dynamic){let t=m(e.toolCallId);g({toolCallId:e.toolCallId,toolName:t.toolName,state:`output-error`,input:t.input,errorText:e.errorText})}else{let t=p(e.toolCallId);h({toolCallId:e.toolCallId,toolName:kl(t),state:`output-error`,input:t.input,rawInput:t.rawInput,errorText:e.errorText})}c();break;case`start-step`:r.message.parts.push({type:`step-start`});break;case`finish-step`:r.activeTextParts={},r.activeReasoningParts={};break;case`start`:e.messageId!=null&&(r.message.id=e.messageId),await _(e.messageMetadata),(e.messageId!=null||e.messageMetadata!=null)&&c();break;case`finish`:await _(e.messageMetadata),e.messageMetadata!=null&&c();break;case`message-metadata`:await _(e.messageMetadata),e.messageMetadata!=null&&c();break;case`error`:i?.(Error(e.errorText));break;default:if(wl(e)){n?.[e.type]!=null&&await ut({value:e.data,schema:n[e.type]});let t=e;if(t.transient){o?.(t);break}let i=t.id==null?void 0:r.message.parts.find(e=>t.type===e.type&&t.id===e.id);i==null?r.message.parts.push(t):i.data=t.data,o?.(t),c()}}s.enqueue(e)})}}))}function Ml({messageId:e,originalMessages:t=[],onFinish:n,onError:r,stream:i}){let a=t?.[t.length-1];a?.role===`assistant`?e=a.id:a=void 0;let o=!1,s=i.pipeThrough(new TransformStream({transform(t,n){if(t.type===`start`){let n=t;n.messageId==null&&e!=null&&(n.messageId=e)}t.type===`abort`&&(o=!0),n.enqueue(t)}}));if(n==null)return s;let c=Al({lastMessage:a?structuredClone(a):void 0,messageId:e??``}),l=async e=>{await e({state:c,write:()=>{}})},u=!1,d=async()=>{if(u||!n)return;u=!0;let e=c.message.id===a?.id;await n({isAborted:o,isContinuation:e,responseMessage:c.message,messages:[...e?t.slice(0,-1):t,c.message]})};return jl({stream:s,runUpdateMessageJob:l,onError:r}).pipeThrough(new TransformStream({transform(e,t){t.enqueue(e)},async cancel(){await d()},async flush(){await d()}}))}function Nl({response:e,status:t,statusText:n,headers:r,stream:i,consumeSseStream:a}){let o=i.pipeThrough(new yl);if(a){let[e,t]=o.tee();o=e,a({stream:t})}_l({response:e,status:t,statusText:n,headers:Object.fromEntries(hl(r,bl).entries()),stream:o.pipeThrough(new TextEncoderStream)})}function Pl(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){let e=this.getReader(),t=!1;async function n(n){var r;t=!0;try{n&&await(r=e.cancel)?.call(e)}finally{try{e.releaseLock()}catch{}}}return{async next(){if(t)return{done:!0,value:void 0};let{done:r,value:i}=await e.read();return r?(await n(!0),{done:!0,value:void 0}):{done:!1,value:i}},async return(){return await n(!0),{done:!0,value:void 0}},async throw(e){throw await n(!0),e}}},t}async function Fl({stream:e,onError:t}){let n=e.getReader();try{for(;;){let{done:e}=await n.read();if(e)break}}catch(e){t?.(e)}finally{n.releaseLock()}}function Il(){let e,t,n=new Promise((n,r)=>{e=n,t=r});return{promise:n,resolve:e,reject:t}}function Ll(){let e=[],t=null,n=!1,r=Il(),i=()=>{n=!0,r.resolve(),e.forEach(e=>e.cancel()),e=[],t?.close()},a=async()=>{if(n&&e.length===0){t?.close();return}if(e.length===0)return r=Il(),await r.promise,a();try{let{value:r,done:i}=await e[0].read();i?(e.shift(),e.length>0?await a():n&&t?.close()):t?.enqueue(r)}catch(n){t?.error(n),e.shift(),i()}};return{stream:new ReadableStream({start(e){t=e},pull:a,async cancel(){for(let t of e)await t.cancel();e=[],n=!0}}),addStream:t=>{if(n)throw Error(`Cannot add inner stream: outer stream is closed`);e.push(t.getReader()),r.resolve()},close:()=>{n=!0,r.resolve(),e.length===0&&t?.close()},terminate:i}}var Rl=class{constructor(){this.status={type:`pending`},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||=new Promise((e,t)=>{this.status.type===`resolved`?e(this.status.value):this.status.type===`rejected`&&t(this.status.error),this._resolve=e,this._reject=t}),this._promise}resolve(e){var t;this.status={type:`resolved`,value:e},this._promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:`rejected`,error:e},this._promise&&((t=this._reject)==null||t.call(this,e))}};function zl(){var e,t;return(t=(e=globalThis==null?void 0:globalThis.performance)?.now())??Date.now()}function Bl({tools:e,generatorStream:t,tracer:n,telemetry:r,system:i,messages:a,abortSignal:o,repairToolCall:s,experimental_context:c}){let l=null,u=new ReadableStream({start(e){l=e}}),d=new Set,f=new Map,p=!1,m;function h(){p&&d.size===0&&(m!=null&&l.enqueue(m),l.close())}let g=new TransformStream({async transform(t,u){let p=t.type;switch(p){case`stream-start`:case`text-start`:case`text-delta`:case`text-end`:case`reasoning-start`:case`reasoning-delta`:case`reasoning-end`:case`tool-input-start`:case`tool-input-delta`:case`tool-input-end`:case`source`:case`response-metadata`:case`error`:case`raw`:u.enqueue(t);break;case`file`:u.enqueue({type:`file`,file:new al({data:t.data,mediaType:t.mediaType})});break;case`finish`:m={type:`finish`,finishReason:t.finishReason,usage:t.usage,providerMetadata:t.providerMetadata};break;case`tool-call`:try{let p=await ol({toolCall:t,tools:e,repairToolCall:s,system:i,messages:a});if(u.enqueue(p),p.invalid){l.enqueue({type:`tool-error`,toolCallId:p.toolCallId,toolName:p.toolName,input:p.input,error:Ue(p.error),dynamic:!0});break}let m=e[p.toolName];if(f.set(p.toolCallId,p.input),m.onInputAvailable!=null&&await m.onInputAvailable({input:p.input,toolCallId:p.toolCallId,messages:a,abortSignal:o,experimental_context:c}),m.execute!=null&&p.providerExecuted!==!0){let e=V();d.add(e),qc({name:`ai.toolCall`,attributes:Yc({telemetry:r,attributes:{...Vc({operationId:`ai.toolCall`,telemetry:r}),"ai.toolCall.name":p.toolName,"ai.toolCall.id":p.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(p.input)}}}),tracer:n,fn:async t=>{let n;try{let e=Ln({execute:m.execute.bind(m),input:p.input,options:{toolCallId:p.toolCallId,messages:a,abortSignal:o,experimental_context:c}});for await(let t of e)l.enqueue({...p,type:`tool-result`,output:t.output,...t.type===`preliminary`&&{preliminary:!0}}),t.type===`final`&&(n=t.output)}catch(n){Jc(t,n),l.enqueue({...p,type:`tool-error`,error:n}),d.delete(e),h();return}d.delete(e),h();try{t.setAttributes(Yc({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(n)}}}))}catch{}}})}}catch(e){l.enqueue({type:`error`,error:e})}break;case`tool-result`:{let e=t.toolName;t.isError?l.enqueue({type:`tool-error`,toolCallId:t.toolCallId,toolName:e,input:f.get(t.toolCallId),providerExecuted:t.providerExecuted,error:t.result}):u.enqueue({type:`tool-result`,toolCallId:t.toolCallId,toolName:e,input:f.get(t.toolCallId),output:t.result,providerExecuted:t.providerExecuted});break}default:{let e=p;throw Error(`Unhandled chunk type: ${e}`)}}},flush(){p=!0,h()}});return new ReadableStream({async start(e){return Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),u.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])}})}var Vl=He({prefix:`aitxt`,size:24});function Hl({model:e,tools:t,toolChoice:n,system:r,prompt:i,messages:a,maxRetries:o,abortSignal:s,headers:c,stopWhen:l=ll(1),experimental_output:u,experimental_telemetry:d,prepareStep:f,providerOptions:p,experimental_activeTools:m,activeTools:h=m,experimental_repairToolCall:g,experimental_transform:_,experimental_download:v,includeRawChunks:y=!1,onChunk:b,onError:x=({error:e})=>{console.error(e)},onFinish:S,onAbort:C,onStepFinish:w,experimental_context:T,_internal:{now:E=zl,generateId:D=Vl,currentDate:O=()=>new Date}={},...k}){return new Wl({model:sc(e),telemetry:d,headers:c,settings:k,maxRetries:o,abortSignal:s,system:r,prompt:i,messages:a,tools:t,toolChoice:n,transforms:$c(_),activeTools:h,repairToolCall:g,stopConditions:$c(l),output:u,providerOptions:p,prepareStep:f,includeRawChunks:y,onChunk:b,onError:x,onFinish:S,onAbort:C,onStepFinish:w,now:E,currentDate:O,generateId:D,experimental_context:T,download:v})}function Ul(e){if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let t,n=``,r=``,i=``;function a({controller:e,partialOutput:n=void 0}){e.enqueue({part:{type:`text-delta`,id:t,text:r},partialOutput:n}),r=``}return new TransformStream({async transform(o,s){if(o.type===`finish-step`&&r.length>0&&a({controller:s}),o.type!==`text-delta`&&o.type!==`text-start`&&o.type!==`text-end`){s.enqueue({part:o,partialOutput:void 0});return}if(t==null)t=o.id;else if(o.id!==t){s.enqueue({part:o,partialOutput:void 0});return}if(o.type===`text-start`){s.enqueue({part:o,partialOutput:void 0});return}if(o.type===`text-end`){r.length>0&&a({controller:s}),s.enqueue({part:o,partialOutput:void 0});return}n+=o.text,r+=o.text;let c=await e.parsePartial({text:n});if(c!=null){let e=JSON.stringify(c.partial);e!==i&&(a({controller:s,partialOutput:c.partial}),i=e)}}})}var Wl=class{constructor({model:e,telemetry:t,headers:n,settings:r,maxRetries:i,abortSignal:a,system:o,prompt:s,messages:c,tools:l,toolChoice:u,transforms:d,activeTools:f,repairToolCall:p,stopConditions:m,output:h,providerOptions:g,prepareStep:_,includeRawChunks:v,now:y,currentDate:b,generateId:x,onChunk:S,onError:C,onFinish:w,onAbort:T,onStepFinish:E,experimental_context:D,download:O}){this._totalUsage=new Rl,this._finishReason=new Rl,this._steps=new Rl,this.output=h,this.includeRawChunks=v,this.tools=l;let k,A=[],ee=[],te,j,M={},N=[],P=[],ne,re={},F={},ie=new TransformStream({async transform(e,t){var n,r,i;t.enqueue(e);let{part:a}=e;if((a.type===`text-delta`||a.type===`reasoning-delta`||a.type===`source`||a.type===`tool-call`||a.type===`tool-result`||a.type===`tool-input-start`||a.type===`tool-input-delta`||a.type===`raw`)&&await S?.({chunk:a}),a.type===`error`&&await C({error:Bc(a.error)}),a.type===`text-start`&&(re[a.id]={type:`text`,text:``,providerMetadata:a.providerMetadata},A.push(re[a.id])),a.type===`text-delta`){let e=re[a.id];if(e==null){t.enqueue({part:{type:`error`,error:`text part ${a.id} not found`},partialOutput:void 0});return}e.text+=a.text,e.providerMetadata=(n=a.providerMetadata)??e.providerMetadata}if(a.type===`text-end`&&delete re[a.id],a.type===`reasoning-start`&&(F[a.id]={type:`reasoning`,text:``,providerMetadata:a.providerMetadata},A.push(F[a.id])),a.type===`reasoning-delta`){let e=F[a.id];if(e==null){t.enqueue({part:{type:`error`,error:`reasoning part ${a.id} not found`},partialOutput:void 0});return}e.text+=a.text,e.providerMetadata=(r=a.providerMetadata)??e.providerMetadata}if(a.type===`reasoning-end`){let e=F[a.id];if(e==null){t.enqueue({part:{type:`error`,error:`reasoning part ${a.id} not found`},partialOutput:void 0});return}e.providerMetadata=(i=a.providerMetadata)??e.providerMetadata,delete F[a.id]}if(a.type===`file`&&A.push({type:`file`,file:a.file}),a.type===`source`&&A.push(a),a.type===`tool-call`&&A.push(a),a.type===`tool-result`&&!a.preliminary&&A.push(a),a.type===`tool-error`&&A.push(a),a.type===`start-step`&&(M=a.request,N=a.warnings),a.type===`finish-step`){let e=pl({content:A,tools:l}),t=new cl({content:A,finishReason:a.finishReason,usage:a.usage,warnings:N,request:M,response:{...a.response,messages:[...ee,...e]},providerMetadata:a.providerMetadata});await E?.(t),Ko(N),P.push(t),A=[],F={},re={},ee.push(...e),k.resolve()}a.type===`finish`&&(j=a.totalUsage,te=a.finishReason)},async flush(e){try{if(P.length===0){let e=new Es({message:`No output generated. Check the stream for errors.`});I._finishReason.reject(e),I._totalUsage.reject(e),I._steps.reject(e);return}let e=te??`unknown`,n=j??{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};I._finishReason.resolve(e),I._totalUsage.resolve(n),I._steps.resolve(P);let r=P[P.length-1];await w?.({finishReason:e,totalUsage:n,usage:r.usage,content:r.content,text:r.text,reasoningText:r.reasoningText,reasoning:r.reasoning,files:r.files,sources:r.sources,toolCalls:r.toolCalls,staticToolCalls:r.staticToolCalls,dynamicToolCalls:r.dynamicToolCalls,toolResults:r.toolResults,staticToolResults:r.staticToolResults,dynamicToolResults:r.dynamicToolResults,request:r.request,response:r.response,warnings:r.warnings,providerMetadata:r.providerMetadata,steps:P}),ne.setAttributes(Yc({telemetry:t,attributes:{"ai.response.finishReason":e,"ai.response.text":{output:()=>r.text},"ai.response.toolCalls":{output:()=>{var e;return(e=r.toolCalls)?.length?JSON.stringify(r.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(r.providerMetadata),"ai.usage.inputTokens":n.inputTokens,"ai.usage.outputTokens":n.outputTokens,"ai.usage.totalTokens":n.totalTokens,"ai.usage.reasoningTokens":n.reasoningTokens,"ai.usage.cachedInputTokens":n.cachedInputTokens}}))}catch(t){e.error(t)}finally{ne.end()}}}),ae=Ll();this.addStream=ae.addStream,this.closeStream=ae.close;let oe=ae.stream.getReader(),se=new ReadableStream({async start(e){e.enqueue({type:`start`})},async pull(e){function t(){T?.({steps:P}),e.enqueue({type:`abort`}),e.close()}try{let{done:n,value:r}=await oe.read();if(n){e.close();return}if(a?.aborted){t();return}e.enqueue(r)}catch(n){We(n)&&a?.aborted?t():e.error(n)}},cancel(e){return ae.stream.cancel(e)}});for(let e of d)se=se.pipeThrough(e({tools:l,stopStream(){ae.terminate()}}));this.baseStream=se.pipeThrough(Ul(h)).pipeThrough(ie);let{maxRetries:ce,retry:le}=rl({maxRetries:i,abortSignal:a}),ue=Kc(t),de=Cc(r),fe=Hc({model:e,telemetry:t,headers:n,settings:{...de,maxRetries:ce}}),I=this;qc({name:`ai.streamText`,attributes:Yc({telemetry:t,attributes:{...Vc({operationId:`ai.streamText`,telemetry:t}),...fe,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:s,messages:c})}}}),tracer:ue,endWhenDone:!1,fn:async r=>{ne=r;async function i({currentStep:r,responseMessages:d,usage:v}){var S,C,w,T,E;let A=I.includeRawChunks;k=new Rl;let ee=await zc({system:o,prompt:s,messages:c}),te=[...ee.messages,...d],j=await _?.({model:e,steps:P,stepNumber:P.length,messages:te}),M=await yc({prompt:{system:(S=j?.system)??ee.system,messages:(C=j?.messages)??te},supportedUrls:await e.supportedUrls,download:O}),N=sc((w=j?.model)??e),{toolChoice:ne,tools:re}=Tc({tools:l,toolChoice:(T=j?.toolChoice)??u,activeTools:(E=j?.activeTools)??f}),{result:{stream:F,response:ie,request:ae},doStreamSpan:oe,startTimestampMs:se}=await le(()=>qc({name:`ai.streamText.doStream`,attributes:Yc({telemetry:t,attributes:{...Vc({operationId:`ai.streamText.doStream`,telemetry:t}),...fe,"ai.model.provider":N.provider,"ai.model.id":N.modelId,"ai.prompt.messages":{input:()=>Xc(M)},"ai.prompt.tools":{input:()=>re?.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>ne==null?void 0:JSON.stringify(ne)},"gen_ai.system":N.provider,"gen_ai.request.model":N.modelId,"gen_ai.request.frequency_penalty":de.frequencyPenalty,"gen_ai.request.max_tokens":de.maxOutputTokens,"gen_ai.request.presence_penalty":de.presencePenalty,"gen_ai.request.stop_sequences":de.stopSequences,"gen_ai.request.temperature":de.temperature,"gen_ai.request.top_k":de.topK,"gen_ai.request.top_p":de.topP}}),tracer:ue,endWhenDone:!1,fn:async e=>({startTimestampMs:y(),doStreamSpan:e,result:await N.doStream({...de,tools:re,toolChoice:ne,responseFormat:h?.responseFormat,prompt:M,providerOptions:g,abortSignal:a,headers:n,includeRawChunks:A})})})),ce=Bl({tools:l,generatorStream:F,tracer:ue,telemetry:t,system:o,messages:te,repairToolCall:p,abortSignal:a,experimental_context:D}),pe=ae??{},me=[],he=[],ge,_e={},ve=`unknown`,L={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},ye,be=!0,R={id:x(),timestamp:b(),modelId:e.modelId},xe=``;I.addStream(ce.pipeThrough(new TransformStream({async transform(e,t){var n,r,i,o;if(e.type===`stream-start`){ge=e.warnings;return}if(be){let e=y()-se;be=!1,oe.addEvent(`ai.stream.firstChunk`,{"ai.response.msToFirstChunk":e}),oe.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:`start-step`,request:pe,warnings:ge??[]})}let s=e.type;switch(s){case`text-start`:case`text-end`:t.enqueue(e);break;case`text-delta`:e.delta.length>0&&(t.enqueue({type:`text-delta`,id:e.id,text:e.delta,providerMetadata:e.providerMetadata}),xe+=e.delta);break;case`reasoning-start`:case`reasoning-end`:t.enqueue(e);break;case`reasoning-delta`:t.enqueue({type:`reasoning-delta`,id:e.id,text:e.delta,providerMetadata:e.providerMetadata});break;case`tool-call`:t.enqueue(e),me.push(e);break;case`tool-result`:t.enqueue(e),e.preliminary||he.push(e);break;case`tool-error`:t.enqueue(e),he.push(e);break;case`response-metadata`:R={id:(n=e.id)??R.id,timestamp:(r=e.timestamp)??R.timestamp,modelId:(i=e.modelId)??R.modelId};break;case`finish`:{L=e.usage,ve=e.finishReason,ye=e.providerMetadata;let t=y()-se;oe.addEvent(`ai.stream.finish`),oe.setAttributes({"ai.response.msToFinish":t,"ai.response.avgOutputTokensPerSecond":1e3*((o=L.outputTokens)??0)/t});break}case`file`:t.enqueue(e);break;case`source`:t.enqueue(e);break;case`tool-input-start`:{_e[e.id]=e.toolName;let n=l?.[e.toolName];n?.onInputStart!=null&&await n.onInputStart({toolCallId:e.id,messages:te,abortSignal:a,experimental_context:D}),t.enqueue({...e,dynamic:n?.type===`dynamic`});break}case`tool-input-end`:delete _e[e.id],t.enqueue(e);break;case`tool-input-delta`:{let n=_e[e.id],r=l?.[n];r?.onInputDelta!=null&&await r.onInputDelta({inputTextDelta:e.delta,toolCallId:e.id,messages:te,abortSignal:a,experimental_context:D}),t.enqueue(e);break}case`error`:t.enqueue(e),ve=`error`;break;case`raw`:A&&t.enqueue(e);break;default:{let e=s;throw Error(`Unknown chunk type: ${e}`)}}},async flush(e){let n=me.length>0?JSON.stringify(me):void 0;try{oe.setAttributes(Yc({telemetry:t,attributes:{"ai.response.finishReason":ve,"ai.response.text":{output:()=>xe},"ai.response.toolCalls":{output:()=>n},"ai.response.id":R.id,"ai.response.model":R.modelId,"ai.response.timestamp":R.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(ye),"ai.usage.inputTokens":L.inputTokens,"ai.usage.outputTokens":L.outputTokens,"ai.usage.totalTokens":L.totalTokens,"ai.usage.reasoningTokens":L.reasoningTokens,"ai.usage.cachedInputTokens":L.cachedInputTokens,"gen_ai.response.finish_reasons":[ve],"gen_ai.response.id":R.id,"gen_ai.response.model":R.modelId,"gen_ai.usage.input_tokens":L.inputTokens,"gen_ai.usage.output_tokens":L.outputTokens}}))}catch{}finally{oe.end()}e.enqueue({type:`finish-step`,finishReason:ve,usage:L,providerMetadata:ye,response:{...R,headers:ie?.headers}});let a=Zc(v,L);await k.promise;let o=me.filter(e=>e.providerExecuted!==!0),s=he.filter(e=>e.providerExecuted!==!0);if(o.length>0&&s.length===o.length&&!await ul({stopConditions:m,steps:P})){d.push(...pl({content:P[P.length-1].content,tools:l}));try{await i({currentStep:r+1,responseMessages:d,usage:a})}catch(t){e.enqueue({type:`error`,error:t}),I.closeStream()}}else e.enqueue({type:`finish`,finishReason:ve,totalUsage:a}),I.closeStream()}})))}await i({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(e=>{I.addStream(new ReadableStream({start(t){t.enqueue({type:`error`,error:e}),t.close()}})),I.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return Pl(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type===`text-delta`&&t.enqueue(e.text)}})))}get fullStream(){return Pl(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await Fl({stream:this.fullStream,onError:e?.onError})}catch(n){(t=e?.onError)==null||t.call(e,n)}}get experimental_partialOutputStream(){if(this.output==null)throw new Ho;return Pl(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i=!0,sendSources:a=!1,sendStart:o=!0,sendFinish:s=!0,onError:c=y}={}){let l=t==null?void 0:Sl({originalMessages:e,responseMessageId:t}),u={},d=e=>{var t,n;let r=u[e],i=(n=(t=this.tools)?.[r])?.type===`dynamic`;return i?!0:void 0},f=this.fullStream.pipeThrough(new TransformStream({transform:async(e,t)=>{let n=r?.({part:e}),f=e.type;switch(f){case`text-start`:t.enqueue({type:`text-start`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`text-delta`:t.enqueue({type:`text-delta`,id:e.id,delta:e.text,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`text-end`:t.enqueue({type:`text-end`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-start`:t.enqueue({type:`reasoning-start`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-delta`:i&&t.enqueue({type:`reasoning-delta`,id:e.id,delta:e.text,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`reasoning-end`:t.enqueue({type:`reasoning-end`,id:e.id,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`file`:t.enqueue({type:`file`,mediaType:e.file.mediaType,url:`data:${e.file.mediaType};base64,${e.file.base64}`});break;case`source`:a&&e.sourceType===`url`&&t.enqueue({type:`source-url`,sourceId:e.id,url:e.url,title:e.title,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}}),a&&e.sourceType===`document`&&t.enqueue({type:`source-document`,sourceId:e.id,mediaType:e.mediaType,title:e.title,filename:e.filename,...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata}});break;case`tool-input-start`:{u[e.id]=e.toolName;let n=d(e.id);t.enqueue({type:`tool-input-start`,toolCallId:e.id,toolName:e.toolName,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...n==null?{}:{dynamic:n}});break}case`tool-input-delta`:t.enqueue({type:`tool-input-delta`,toolCallId:e.id,inputTextDelta:e.delta});break;case`tool-call`:{u[e.toolCallId]=e.toolName;let n=d(e.toolCallId);e.invalid?t.enqueue({type:`tool-input-error`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata},...n==null?{}:{dynamic:n},errorText:c(e.error)}):t.enqueue({type:`tool-input-available`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.providerMetadata==null?{}:{providerMetadata:e.providerMetadata},...n==null?{}:{dynamic:n}});break}case`tool-result`:{let n=d(e.toolCallId);t.enqueue({type:`tool-output-available`,toolCallId:e.toolCallId,output:e.output,...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...e.preliminary==null?{}:{preliminary:e.preliminary},...n==null?{}:{dynamic:n}});break}case`tool-error`:{let n=d(e.toolCallId);t.enqueue({type:`tool-output-error`,toolCallId:e.toolCallId,errorText:c(e.error),...e.providerExecuted==null?{}:{providerExecuted:e.providerExecuted},...n==null?{}:{dynamic:n}});break}case`error`:t.enqueue({type:`error`,errorText:c(e.error)});break;case`start-step`:t.enqueue({type:`start-step`});break;case`finish-step`:t.enqueue({type:`finish-step`});break;case`start`:o&&t.enqueue({type:`start`,...n==null?{}:{messageMetadata:n},...l==null?{}:{messageId:l}});break;case`finish`:s&&t.enqueue({type:`finish`,...n==null?{}:{messageMetadata:n}});break;case`abort`:t.enqueue(e);break;case`tool-input-end`:break;case`raw`:break;default:{let e=f;throw Error(`Unknown chunk type: ${e}`)}}n!=null&&f!==`start`&&f!==`finish`&&t.enqueue({type:`message-metadata`,messageMetadata:n})}}));return Pl(Ml({stream:f,messageId:l??t?.(),originalMessages:e,onFinish:n,onError:c}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:n,onFinish:r,messageMetadata:i,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:c,onError:l,...u}={}){Nl({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:n,onFinish:r,messageMetadata:i,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:c,onError:l}),...u})}pipeTextStreamToResponse(e,t){vl({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i,sendSources:a,sendFinish:o,sendStart:s,onError:c,...l}={}){return xl({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:n,messageMetadata:r,sendReasoning:i,sendSources:a,sendFinish:o,sendStart:s,onError:c}),...l})}toTextStreamResponse(e){return gl({textStream:this.textStream,...e})}},Gl=He({prefix:`aiobj`,size:24}),Kl=He({prefix:`aiobj`,size:24}),ql={};Lo(ql,{object:()=>Yl,text:()=>Jl});var Jl=()=>({type:`text`,responseFormat:{type:`text`},async parsePartial({text:e}){return{partial:e}},async parseOutput({text:e}){return e}}),Yl=({schema:e})=>{let t=kn(e);return{type:`object`,responseFormat:{type:`json`,schema:t.jsonSchema},async parsePartial({text:e}){let t=await Dl(e);switch(t.state){case`failed-parse`:case`undefined-input`:return;case`repaired-parse`:case`successful-parse`:return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},n){let r=await pt({text:e});if(!r.success)throw new xs({message:`No object generated: could not parse the response.`,cause:r.error,text:e,response:n.response,usage:n.usage,finishReason:n.finishReason});let i=await dt({value:r.value,schema:t});if(!i.success)throw new xs({message:`No object generated: response did not match schema.`,cause:i.error,text:e,response:n.response,usage:n.usage,finishReason:n.finishReason});return i.value}}},Xl=`AI_NoSuchProviderError`,Zl=`vercel.ai.error.${Xl}`,Ql=Symbol.for(Zl),$l;$l=Ql;var eu=n.z.looseObject({name:n.z.string(),version:n.z.string()}),tu=n.z.looseObject({_meta:n.z.optional(n.z.object({}).loose())}),nu=tu,ru=n.z.object({method:n.z.string(),params:n.z.optional(tu)}),iu=n.z.looseObject({experimental:n.z.optional(n.z.object({}).loose()),logging:n.z.optional(n.z.object({}).loose()),prompts:n.z.optional(n.z.looseObject({listChanged:n.z.optional(n.z.boolean())})),resources:n.z.optional(n.z.looseObject({subscribe:n.z.optional(n.z.boolean()),listChanged:n.z.optional(n.z.boolean())})),tools:n.z.optional(n.z.looseObject({listChanged:n.z.optional(n.z.boolean())}))}),au=nu.extend({protocolVersion:n.z.string(),capabilities:iu,serverInfo:eu,instructions:n.z.optional(n.z.string())}),ou=nu.extend({nextCursor:n.z.optional(n.z.string())}),su=n.z.object({name:n.z.string(),description:n.z.optional(n.z.string()),inputSchema:n.z.object({type:n.z.literal(`object`),properties:n.z.optional(n.z.object({}).loose())}).loose()}).loose(),cu=ou.extend({tools:n.z.array(su)}),lu=n.z.object({type:n.z.literal(`text`),text:n.z.string()}).loose(),uu=n.z.object({type:n.z.literal(`image`),data:n.z.base64(),mimeType:n.z.string()}).loose(),du=n.z.object({uri:n.z.string(),mimeType:n.z.optional(n.z.string())}).loose(),fu=du.extend({text:n.z.string()}),pu=du.extend({blob:n.z.base64()}),mu=n.z.object({type:n.z.literal(`resource`),resource:n.z.union([fu,pu])}).loose(),hu=nu.extend({content:n.z.array(n.z.union([lu,uu,mu])),isError:n.z.boolean().default(!1).optional()}).or(nu.extend({toolResult:n.z.unknown()})),gu=`2.0`,_u=n.z.object({jsonrpc:n.z.literal(gu),id:n.z.union([n.z.string(),n.z.number().int()])}).merge(ru).strict(),vu=n.z.object({jsonrpc:n.z.literal(gu),id:n.z.union([n.z.string(),n.z.number().int()]),result:nu}).strict(),yu=n.z.object({jsonrpc:n.z.literal(gu),id:n.z.union([n.z.string(),n.z.number().int()]),error:n.z.object({code:n.z.number().int(),message:n.z.string(),data:n.z.optional(n.z.unknown())})}).strict(),bu=n.z.object({jsonrpc:n.z.literal(gu)}).merge(n.z.object({method:n.z.string(),params:n.z.optional(tu)})).strict(),xu=n.z.union([_u,bu,vu,yu]),Su=n.z.object({type:n.z.literal(`text`),text:n.z.string(),state:n.z.enum([`streaming`,`done`]).optional(),providerMetadata:$.optional()}),Cu=n.z.object({type:n.z.literal(`reasoning`),text:n.z.string(),state:n.z.enum([`streaming`,`done`]).optional(),providerMetadata:$.optional()}),wu=n.z.object({type:n.z.literal(`source-url`),sourceId:n.z.string(),url:n.z.string(),title:n.z.string().optional(),providerMetadata:$.optional()}),Tu=n.z.object({type:n.z.literal(`source-document`),sourceId:n.z.string(),mediaType:n.z.string(),title:n.z.string(),filename:n.z.string().optional(),providerMetadata:$.optional()}),Eu=n.z.object({type:n.z.literal(`file`),mediaType:n.z.string(),filename:n.z.string().optional(),url:n.z.string(),providerMetadata:$.optional()}),Du=n.z.object({type:n.z.literal(`step-start`)}),Ou=n.z.object({type:n.z.string().startsWith(`data-`),id:n.z.string().optional(),data:n.z.unknown()}),ku=[n.z.object({type:n.z.literal(`dynamic-tool`),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal(`input-streaming`),input:n.z.unknown().optional(),output:n.z.never().optional(),errorText:n.z.never().optional()}),n.z.object({type:n.z.literal(`dynamic-tool`),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal(`input-available`),input:n.z.unknown(),output:n.z.never().optional(),errorText:n.z.never().optional(),callProviderMetadata:$.optional()}),n.z.object({type:n.z.literal(`dynamic-tool`),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal(`output-available`),input:n.z.unknown(),output:n.z.unknown(),errorText:n.z.never().optional(),callProviderMetadata:$.optional(),preliminary:n.z.boolean().optional()}),n.z.object({type:n.z.literal(`dynamic-tool`),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal(`output-error`),input:n.z.unknown(),output:n.z.never().optional(),errorText:n.z.string(),callProviderMetadata:$.optional()})],Au=[n.z.object({type:n.z.string().startsWith(`tool-`),toolCallId:n.z.string(),state:n.z.literal(`input-streaming`),input:n.z.unknown().optional(),output:n.z.never().optional(),errorText:n.z.never().optional()}),n.z.object({type:n.z.string().startsWith(`tool-`),toolCallId:n.z.string(),state:n.z.literal(`input-available`),input:n.z.unknown(),output:n.z.never().optional(),errorText:n.z.never().optional(),callProviderMetadata:$.optional()}),n.z.object({type:n.z.string().startsWith(`tool-`),toolCallId:n.z.string(),state:n.z.literal(`output-available`),input:n.z.unknown(),output:n.z.unknown(),errorText:n.z.never().optional(),callProviderMetadata:$.optional(),preliminary:n.z.boolean().optional()}),n.z.object({type:n.z.string().startsWith(`tool-`),toolCallId:n.z.string(),state:n.z.literal(`output-error`),input:n.z.unknown(),output:n.z.never().optional(),errorText:n.z.string(),callProviderMetadata:$.optional()})],ju=n.z.object({id:n.z.string(),role:n.z.enum([`system`,`user`,`assistant`]),metadata:n.z.unknown().optional(),parts:n.z.array(n.z.union([Su,Cu,wu,Tu,Eu,Du,Ou,...ku,...Au]))}),Mu=n.z.object({type:n.z.literal(`error`),error:n.z.object({type:n.z.string(),message:n.z.string()})}),Nu=xt({errorSchema:Mu,errorToMessage:e=>e.error.message}),Pu=n.z.object({citations:n.z.object({enabled:n.z.boolean()}).optional(),title:n.z.string().optional(),context:n.z.string().optional()}),Fu=n.z.object({sendReasoning:n.z.boolean().optional(),thinking:n.z.object({type:n.z.union([n.z.literal(`enabled`),n.z.literal(`disabled`)]),budgetTokens:n.z.number().optional()}).optional(),disableParallelToolUse:n.z.boolean().optional()});function Iu(e){var t;let n=e?.anthropic,r=(t=n?.cacheControl)??n?.cache_control;return r}var Lu=n.z.object({maxUses:n.z.number().optional(),allowedDomains:n.z.array(n.z.string()).optional(),blockedDomains:n.z.array(n.z.string()).optional(),userLocation:n.z.object({type:n.z.literal(`approximate`),city:n.z.string().optional(),region:n.z.string().optional(),country:n.z.string().optional(),timezone:n.z.string().optional()}).optional()}),Ru=n.z.array(n.z.object({url:n.z.string(),title:n.z.string(),pageAge:n.z.string().nullable(),encryptedContent:n.z.string(),type:n.z.string()})),zu=bt({id:`anthropic.web_search_20250305`,name:`web_search`,inputSchema:n.z.object({query:n.z.string()}),outputSchema:Ru}),Bu=(e={})=>zu(e);function Vu(e){return typeof e==`object`&&!!e&&`type`in e&&e.type===`web_search_20250305`}function Hu({tools:e,toolChoice:t,disableParallelToolUse:n}){e=e?.length?e:void 0;let r=[],i=new Set;if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:r,betas:i};let a=[];for(let t of e){if(Vu(t)){a.push(t);continue}switch(t.type){case`function`:let e=Iu(t.providerOptions);a.push({name:t.name,description:t.description,input_schema:t.inputSchema,cache_control:e});break;case`provider-defined`:switch(t.id){case`anthropic.computer_20250124`:i.add(`computer-use-2025-01-24`),a.push({name:`computer`,type:`computer_20250124`,display_width_px:t.args.displayWidthPx,display_height_px:t.args.displayHeightPx,display_number:t.args.displayNumber});break;case`anthropic.computer_20241022`:i.add(`computer-use-2024-10-22`),a.push({name:`computer`,type:`computer_20241022`,display_width_px:t.args.displayWidthPx,display_height_px:t.args.displayHeightPx,display_number:t.args.displayNumber});break;case`anthropic.text_editor_20250124`:i.add(`computer-use-2025-01-24`),a.push({name:`str_replace_editor`,type:`text_editor_20250124`});break;case`anthropic.text_editor_20241022`:i.add(`computer-use-2024-10-22`),a.push({name:`str_replace_editor`,type:`text_editor_20241022`});break;case`anthropic.text_editor_20250429`:i.add(`computer-use-2025-01-24`),a.push({name:`str_replace_based_edit_tool`,type:`text_editor_20250429`});break;case`anthropic.bash_20250124`:i.add(`computer-use-2025-01-24`),a.push({name:`bash`,type:`bash_20250124`});break;case`anthropic.bash_20241022`:i.add(`computer-use-2024-10-22`),a.push({name:`bash`,type:`bash_20241022`});break;case`anthropic.web_search_20250305`:{let e=Lu.parse(t.args);a.push({type:`web_search_20250305`,name:`web_search`,max_uses:e.maxUses,allowed_domains:e.allowedDomains,blocked_domains:e.blockedDomains,user_location:e.userLocation});break}case`anthropic.code_execution_20250522`:i.add(`code-execution-2025-05-22`),a.push({type:`code_execution_20250522`,name:`code_execution`});break;default:r.push({type:`unsupported-tool`,tool:t});break}break;default:r.push({type:`unsupported-tool`,tool:t});break}}if(t==null)return{tools:a,toolChoice:n?{type:`auto`,disable_parallel_tool_use:n}:void 0,toolWarnings:r,betas:i};let o=t.type;switch(o){case`auto`:return{tools:a,toolChoice:{type:`auto`,disable_parallel_tool_use:n},toolWarnings:r,betas:i};case`required`:return{tools:a,toolChoice:{type:`any`,disable_parallel_tool_use:n},toolWarnings:r,betas:i};case`none`:return{tools:void 0,toolChoice:void 0,toolWarnings:r,betas:i};case`tool`:return{tools:a,toolChoice:{type:`tool`,name:t.toolName,disable_parallel_tool_use:n},toolWarnings:r,betas:i};default:{let e=o;throw new z({functionality:`tool choice type: ${e}`})}}}var Uu=n.z.object({type:n.z.literal(`code_execution_result`),stdout:n.z.string(),stderr:n.z.string(),return_code:n.z.number()}),Wu=bt({id:`anthropic.code_execution_20250522`,name:`code_execution`,inputSchema:n.z.object({code:n.z.string()}),outputSchema:Uu}),Gu=(e={})=>Wu(e);function Ku(e){if(typeof e==`string`)return Buffer.from(e,`base64`).toString(`utf-8`);if(e instanceof Uint8Array)return new TextDecoder().decode(e);throw e instanceof URL?new z({functionality:`URL-based text documents are not supported for citations`}):new z({functionality:`unsupported data type for text documents: ${typeof e}`})}async function qu({prompt:e,sendReasoning:t,warnings:n}){var r,i,a,o,s;let c=new Set,l=Ju(e),u,d=[];async function f(e){var t,n;let r=await H({provider:`anthropic`,providerOptions:e,schema:Pu});return(n=(t=r?.citations)?.enabled)??!1}async function p(e){let t=await H({provider:`anthropic`,providerOptions:e,schema:Pu});return{title:t?.title,context:t?.context}}for(let e=0;e<l.length;e++){let m=l[e],h=e===l.length-1,g=m.type;switch(g){case`system`:if(u!=null)throw new z({functionality:`Multiple system messages that are separated by user/assistant messages`});u=m.messages.map(({content:e,providerOptions:t})=>({type:`text`,text:e,cache_control:Iu(t)}));break;case`user`:{let e=[];for(let t of m.messages){let{role:n,content:s}=t;switch(n){case`user`:for(let n=0;n<s.length;n++){let o=s[n],l=n===s.length-1,u=(r=Iu(o.providerOptions))??(l?Iu(t.providerOptions):void 0);switch(o.type){case`text`:e.push({type:`text`,text:o.text,cache_control:u});break;case`file`:if(o.mediaType.startsWith(`image/`))e.push({type:`image`,source:o.data instanceof URL?{type:`url`,url:o.data.toString()}:{type:`base64`,media_type:o.mediaType===`image/*`?`image/jpeg`:o.mediaType,data:Pn(o.data)},cache_control:u});else if(o.mediaType===`application/pdf`){c.add(`pdfs-2024-09-25`);let t=await f(o.providerOptions),n=await p(o.providerOptions);e.push({type:`document`,source:o.data instanceof URL?{type:`url`,url:o.data.toString()}:{type:`base64`,media_type:`application/pdf`,data:Pn(o.data)},title:(i=n.title)??o.filename,...n.context&&{context:n.context},...t&&{citations:{enabled:!0}},cache_control:u})}else if(o.mediaType===`text/plain`){let t=await f(o.providerOptions),n=await p(o.providerOptions);e.push({type:`document`,source:o.data instanceof URL?{type:`url`,url:o.data.toString()}:{type:`text`,media_type:`text/plain`,data:Ku(o.data)},title:(a=n.title)??o.filename,...n.context&&{context:n.context},...t&&{citations:{enabled:!0}},cache_control:u})}else throw new z({functionality:`media type: ${o.mediaType}`});break}}break;case`tool`:for(let n=0;n<s.length;n++){let r=s[n],i=n===s.length-1,a=(o=Iu(r.providerOptions))??(i?Iu(t.providerOptions):void 0),c=r.output,l;switch(c.type){case`content`:l=c.value.map(e=>{switch(e.type){case`text`:return{type:`text`,text:e.text,cache_control:void 0};case`media`:if(e.mediaType.startsWith(`image/`))return{type:`image`,source:{type:`base64`,media_type:e.mediaType,data:e.data},cache_control:void 0};throw new z({functionality:`media type: ${e.mediaType}`})}});break;case`text`:case`error-text`:l=c.value;break;case`json`:case`error-json`:default:l=JSON.stringify(c.value);break}e.push({type:`tool_result`,tool_use_id:r.toolCallId,content:l,is_error:c.type===`error-text`||c.type===`error-json`?!0:void 0,cache_control:a})}break;default:{let e=n;throw Error(`Unsupported role: ${e}`)}}}d.push({role:`user`,content:e});break}case`assistant`:{let e=[];for(let r=0;r<m.messages.length;r++){let i=m.messages[r],a=r===m.messages.length-1,{content:o}=i;for(let r=0;r<o.length;r++){let c=o[r],l=r===o.length-1,u=(s=Iu(c.providerOptions))??(l?Iu(i.providerOptions):void 0);switch(c.type){case`text`:e.push({type:`text`,text:h&&a&&l?c.text.trim():c.text,cache_control:u});break;case`reasoning`:if(t){let t=await H({provider:`anthropic`,providerOptions:c.providerOptions,schema:rd});t==null?n.push({type:`other`,message:`unsupported reasoning metadata`}):t.signature==null?t.redactedData==null?n.push({type:`other`,message:`unsupported reasoning metadata`}):e.push({type:`redacted_thinking`,data:t.redactedData,cache_control:u}):e.push({type:`thinking`,thinking:c.text,signature:t.signature,cache_control:u})}else n.push({type:`other`,message:`sending reasoning content is disabled for this model`});break;case`tool-call`:if(c.providerExecuted){if(c.toolName===`web_search`){e.push({type:`server_tool_use`,id:c.toolCallId,name:`web_search`,input:c.input,cache_control:u});break}if(c.toolName===`code_execution`){e.push({type:`server_tool_use`,id:c.toolCallId,name:`code_execution`,input:c.input,cache_control:u});break}n.push({type:`other`,message:`provider executed tool call for tool ${c.toolName} is not supported`});break}e.push({type:`tool_use`,id:c.toolCallId,name:c.toolName,input:c.input,cache_control:u});break;case`tool-result`:if(c.toolName===`web_search`){let t=c.output;if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${c.toolName} is not supported`});break}let r=Ru.parse(t.value);e.push({type:`web_search_tool_result`,tool_use_id:c.toolCallId,content:r.map(e=>({url:e.url,title:e.title,page_age:e.pageAge,encrypted_content:e.encryptedContent,type:e.type})),cache_control:u});break}if(c.toolName===`code_execution`){let t=c.output;if(t.type!==`json`){n.push({type:`other`,message:`provider executed tool result output type ${t.type} for tool ${c.toolName} is not supported`});break}let r=Uu.parse(t.value);e.push({type:`code_execution_tool_result`,tool_use_id:c.toolCallId,content:{type:r.type,stdout:r.stdout,stderr:r.stderr,return_code:r.return_code},cache_control:u});break}n.push({type:`other`,message:`provider executed tool result for tool ${c.toolName} is not supported`});break}}}d.push({role:`assistant`,content:e});break}default:{let e=g;throw Error(`content type: ${e}`)}}}return{prompt:{system:u,messages:d},betas:c}}function Ju(e){let t=[],n;for(let r of e){let{role:e}=r;switch(e){case`system`:n?.type!==`system`&&(n={type:`system`,messages:[]},t.push(n)),n.messages.push(r);break;case`assistant`:n?.type!==`assistant`&&(n={type:`assistant`,messages:[]},t.push(n)),n.messages.push(r);break;case`user`:n?.type!==`user`&&(n={type:`user`,messages:[]},t.push(n)),n.messages.push(r);break;case`tool`:n?.type!==`user`&&(n={type:`user`,messages:[]},t.push(n)),n.messages.push(r);break;default:{let t=e;throw Error(`Unsupported role: ${t}`)}}}return t}function Yu({finishReason:e,isJsonResponseFromTool:t}){switch(e){case`pause_turn`:case`end_turn`:case`stop_sequence`:return`stop`;case`refusal`:return`content-filter`;case`tool_use`:return t?`stop`:`tool-calls`;case`max_tokens`:return`length`;default:return`unknown`}}var Xu={webSearchResult:n.z.object({type:n.z.literal(`web_search_result_location`),cited_text:n.z.string(),url:n.z.string(),title:n.z.string(),encrypted_index:n.z.string()}),pageLocation:n.z.object({type:n.z.literal(`page_location`),cited_text:n.z.string(),document_index:n.z.number(),document_title:n.z.string().nullable(),start_page_number:n.z.number(),end_page_number:n.z.number()}),charLocation:n.z.object({type:n.z.literal(`char_location`),cited_text:n.z.string(),document_index:n.z.number(),document_title:n.z.string().nullable(),start_char_index:n.z.number(),end_char_index:n.z.number()})},Zu=n.z.discriminatedUnion(`type`,[Xu.webSearchResult,Xu.pageLocation,Xu.charLocation]);n.z.discriminatedUnion(`type`,[Xu.pageLocation,Xu.charLocation]);function Qu(e,t,n,r){if(e.type===`page_location`||e.type===`char_location`){let i=$u(e,t,n);i&&r(i)}}function $u(e,t,n){var r;let i=t[e.document_index];if(!i)return null;let a=e.type===`page_location`?{citedText:e.cited_text,startPageNumber:e.start_page_number,endPageNumber:e.end_page_number}:{citedText:e.cited_text,startCharIndex:e.start_char_index,endCharIndex:e.end_char_index};return{type:`source`,sourceType:`document`,id:n(),mediaType:i.mediaType,title:(r=e.document_title)??i.title,filename:i.filename,providerMetadata:{anthropic:a}}}var ed=class{constructor(e,t){this.specificationVersion=`v2`;var n;this.modelId=e,this.config=t,this.generateId=(n=t.generateId)??V}supportsUrl(e){return e.protocol===`https:`}get provider(){return this.config.provider}get supportedUrls(){var e,t,n;return(n=(t=(e=this.config).supportedUrls)?.call(e))??{}}async getArgs({prompt:e,maxOutputTokens:t=4096,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,tools:u,toolChoice:d,providerOptions:f}){var p,m,h;let g=[];a!=null&&g.push({type:`unsupported-setting`,setting:`frequencyPenalty`}),o!=null&&g.push({type:`unsupported-setting`,setting:`presencePenalty`}),l!=null&&g.push({type:`unsupported-setting`,setting:`seed`}),c?.type===`json`&&(c.schema==null?g.push({type:`unsupported-setting`,setting:`responseFormat`,details:`JSON response format requires a schema. The response format is ignored.`}):u!=null&&g.push({type:`unsupported-setting`,setting:`tools`,details:`JSON response format does not support tools. The provided tools are ignored.`}));let _=c?.type===`json`&&c.schema!=null?{type:`function`,name:`json`,description:`Respond with a JSON object.`,inputSchema:c.schema}:void 0,v=await H({provider:`anthropic`,providerOptions:f,schema:Fu}),{prompt:y,betas:b}=await qu({prompt:e,sendReasoning:(p=v?.sendReasoning)??!0,warnings:g}),x=(m=v?.thinking)?.type===`enabled`,S=(h=v?.thinking)?.budgetTokens,C={model:this.modelId,max_tokens:t,temperature:n,top_k:i,top_p:r,stop_sequences:s,...x&&{thinking:{type:`enabled`,budget_tokens:S}},system:y.system,messages:y.messages};if(x){if(S==null)throw new z({functionality:`thinking requires a budget`});C.temperature!=null&&(C.temperature=void 0,g.push({type:`unsupported-setting`,setting:`temperature`,details:`temperature is not supported when thinking is enabled`})),i!=null&&(C.top_k=void 0,g.push({type:`unsupported-setting`,setting:`topK`,details:`topK is not supported when thinking is enabled`})),r!=null&&(C.top_p=void 0,g.push({type:`unsupported-setting`,setting:`topP`,details:`topP is not supported when thinking is enabled`})),C.max_tokens=t+S}let{tools:w,toolChoice:T,toolWarnings:E,betas:D}=Hu(_==null?{tools:u??[],toolChoice:d,disableParallelToolUse:v?.disableParallelToolUse}:{tools:[_],toolChoice:{type:`tool`,toolName:_.name},disableParallelToolUse:!0});return{args:{...C,tools:w,tool_choice:T},warnings:[...g,...E],betas:new Set([...b,...D]),usesJsonResponseTool:_!=null}}async getHeaders({betas:e,headers:t}){return B(await G(this.config.headers),e.size>0?{"anthropic-beta":Array.from(e).join(`,`)}:{},t)}buildRequestUrl(e){var t,n,r;return(r=(n=(t=this.config).buildRequestUrl)?.call(t,this.config.baseURL,e))??`${this.config.baseURL}/messages`}transformRequestBody(e){var t,n,r;return(r=(n=(t=this.config).transformRequestBody)?.call(t,e))??e}extractCitationDocuments(e){let t=e=>{var t,n;if(e.type!==`file`||e.mediaType!==`application/pdf`&&e.mediaType!==`text/plain`)return!1;let r=(t=e.providerOptions)?.anthropic,i=r?.citations;return(n=i?.enabled)??!1};return e.filter(e=>e.role===`user`).flatMap(e=>e.content).filter(t).map(e=>{var t;let n=e;return{title:(t=n.filename)??`Untitled Document`,filename:n.filename,mediaType:n.mediaType}})}async doGenerate(e){var t,n,r,i,a;let{args:o,warnings:s,betas:c,usesJsonResponseTool:l}=await this.getArgs(e),u=this.extractCitationDocuments(e.prompt),{responseHeaders:d,value:f,rawValue:p}=await U({url:this.buildRequestUrl(!1),headers:await this.getHeaders({betas:c,headers:e.headers}),body:this.transformRequestBody(o),failedResponseHandler:Nu,successfulResponseHandler:K(td),abortSignal:e.abortSignal,fetch:this.config.fetch}),m=[];for(let e of f.content)switch(e.type){case`text`:if(!l&&(m.push({type:`text`,text:e.text}),e.citations))for(let t of e.citations)Qu(t,u,this.generateId,e=>m.push(e));break;case`thinking`:m.push({type:`reasoning`,text:e.thinking,providerMetadata:{anthropic:{signature:e.signature}}});break;case`redacted_thinking`:m.push({type:`reasoning`,text:``,providerMetadata:{anthropic:{redactedData:e.data}}});break;case`tool_use`:m.push(l?{type:`text`,text:JSON.stringify(e.input)}:{type:`tool-call`,toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input)});break;case`server_tool_use`:(e.name===`web_search`||e.name===`code_execution`)&&m.push({type:`tool-call`,toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input),providerExecuted:!0});break;case`web_search_tool_result`:if(Array.isArray(e.content)){m.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`web_search`,result:e.content.map(e=>{var t;return{url:e.url,title:e.title,pageAge:(t=e.page_age)??null,encryptedContent:e.encrypted_content,type:e.type}}),providerExecuted:!0});for(let n of e.content)m.push({type:`source`,sourceType:`url`,id:this.generateId(),url:n.url,title:n.title,providerMetadata:{anthropic:{pageAge:(t=n.page_age)??null}}})}else m.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`web_search`,isError:!0,result:{type:`web_search_tool_result_error`,errorCode:e.content.error_code},providerExecuted:!0});break;case`code_execution_tool_result`:e.content.type===`code_execution_result`?m.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`code_execution`,result:{type:e.content.type,stdout:e.content.stdout,stderr:e.content.stderr,return_code:e.content.return_code},providerExecuted:!0}):e.content.type===`code_execution_tool_result_error`&&m.push({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`code_execution`,isError:!0,result:{type:`code_execution_tool_result_error`,errorCode:e.content.error_code},providerExecuted:!0});break}return{content:m,finishReason:Yu({finishReason:f.stop_reason,isJsonResponseFromTool:l}),usage:{inputTokens:f.usage.input_tokens,outputTokens:f.usage.output_tokens,totalTokens:f.usage.input_tokens+f.usage.output_tokens,cachedInputTokens:(n=f.usage.cache_read_input_tokens)??void 0},request:{body:o},response:{id:(r=f.id)??void 0,modelId:(i=f.model)??void 0,headers:d,body:p},warnings:s,providerMetadata:{anthropic:{usage:f.usage,cacheCreationInputTokens:(a=f.usage.cache_creation_input_tokens)??null}}}}async doStream(e){let{args:t,warnings:n,betas:r,usesJsonResponseTool:i}=await this.getArgs(e),a=this.extractCitationDocuments(e.prompt),o={...t,stream:!0},{responseHeaders:s,value:c}=await U({url:this.buildRequestUrl(!0),headers:await this.getHeaders({betas:r,headers:e.headers}),body:this.transformRequestBody(o),failedResponseHandler:Nu,successfulResponseHandler:St(nd),abortSignal:e.abortSignal,fetch:this.config.fetch}),l=`unknown`,u={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},d={},f,p,m=this.generateId;return{stream:c.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){var r,o,s,c,h,g,_;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let v=t.value;switch(v.type){case`ping`:return;case`content_block_start`:{let e=v.content_block.type;switch(p=e,e){case`text`:d[v.index]={type:`text`},n.enqueue({type:`text-start`,id:String(v.index)});return;case`thinking`:d[v.index]={type:`reasoning`},n.enqueue({type:`reasoning-start`,id:String(v.index)});return;case`redacted_thinking`:d[v.index]={type:`reasoning`},n.enqueue({type:`reasoning-start`,id:String(v.index),providerMetadata:{anthropic:{redactedData:v.content_block.data}}});return;case`tool_use`:d[v.index]=i?{type:`text`}:{type:`tool-call`,toolCallId:v.content_block.id,toolName:v.content_block.name,input:``},n.enqueue(i?{type:`text-start`,id:String(v.index)}:{type:`tool-input-start`,id:v.content_block.id,toolName:v.content_block.name});return;case`server_tool_use`:(v.content_block.name===`web_search`||v.content_block.name===`code_execution`)&&(d[v.index]={type:`tool-call`,toolCallId:v.content_block.id,toolName:v.content_block.name,input:``,providerExecuted:!0},n.enqueue({type:`tool-input-start`,id:v.content_block.id,toolName:v.content_block.name,providerExecuted:!0}));return;case`web_search_tool_result`:{let e=v.content_block;if(Array.isArray(e.content)){n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`web_search`,result:e.content.map(e=>{var t;return{url:e.url,title:e.title,pageAge:(t=e.page_age)??null,encryptedContent:e.encrypted_content,type:e.type}}),providerExecuted:!0});for(let t of e.content)n.enqueue({type:`source`,sourceType:`url`,id:m(),url:t.url,title:t.title,providerMetadata:{anthropic:{pageAge:(r=t.page_age)??null}}})}else n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`web_search`,isError:!0,result:{type:`web_search_tool_result_error`,errorCode:e.content.error_code},providerExecuted:!0});return}case`code_execution_tool_result`:{let e=v.content_block;e.content.type===`code_execution_result`?n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`code_execution`,result:{type:e.content.type,stdout:e.content.stdout,stderr:e.content.stderr,return_code:e.content.return_code},providerExecuted:!0}):e.content.type===`code_execution_tool_result_error`&&n.enqueue({type:`tool-result`,toolCallId:e.tool_use_id,toolName:`code_execution`,isError:!0,result:{type:`code_execution_tool_result_error`,errorCode:e.content.error_code},providerExecuted:!0});return}default:{let t=e;throw Error(`Unsupported content block type: ${t}`)}}}case`content_block_stop`:if(d[v.index]!=null){let e=d[v.index];switch(e.type){case`text`:n.enqueue({type:`text-end`,id:String(v.index)});break;case`reasoning`:n.enqueue({type:`reasoning-end`,id:String(v.index)});break;case`tool-call`:i||(n.enqueue({type:`tool-input-end`,id:e.toolCallId}),n.enqueue(e));break}delete d[v.index]}p=void 0;return;case`content_block_delta`:{let e=v.delta.type;switch(e){case`text_delta`:if(i)return;n.enqueue({type:`text-delta`,id:String(v.index),delta:v.delta.text});return;case`thinking_delta`:n.enqueue({type:`reasoning-delta`,id:String(v.index),delta:v.delta.thinking});return;case`signature_delta`:p===`thinking`&&n.enqueue({type:`reasoning-delta`,id:String(v.index),delta:``,providerMetadata:{anthropic:{signature:v.delta.signature}}});return;case`input_json_delta`:{let e=d[v.index],t=v.delta.partial_json;if(i){if(e?.type!==`text`)return;n.enqueue({type:`text-delta`,id:String(v.index),delta:t})}else{if(e?.type!==`tool-call`)return;n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:t}),e.input+=t}return}case`citations_delta`:{let e=v.delta.citation;Qu(e,a,m,e=>n.enqueue(e));return}default:{let t=e;throw Error(`Unsupported delta type: ${t}`)}}}case`message_start`:u.inputTokens=v.message.usage.input_tokens,u.cachedInputTokens=(o=v.message.usage.cache_read_input_tokens)??void 0,f={anthropic:{usage:v.message.usage,cacheCreationInputTokens:(s=v.message.usage.cache_creation_input_tokens)??null}},n.enqueue({type:`response-metadata`,id:(c=v.message.id)??void 0,modelId:(h=v.message.model)??void 0});return;case`message_delta`:u.outputTokens=v.usage.output_tokens,u.totalTokens=((g=u.inputTokens)??0)+((_=v.usage.output_tokens)??0),l=Yu({finishReason:v.delta.stop_reason,isJsonResponseFromTool:i});return;case`message_stop`:n.enqueue({type:`finish`,finishReason:l,usage:u,providerMetadata:f});return;case`error`:n.enqueue({type:`error`,error:v.error});return;default:{let e=v;throw Error(`Unsupported chunk type: ${e}`)}}}})),request:{body:o},response:{headers:s}}}},td=n.z.object({type:n.z.literal(`message`),id:n.z.string().nullish(),model:n.z.string().nullish(),content:n.z.array(n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`text`),text:n.z.string(),citations:n.z.array(Zu).optional()}),n.z.object({type:n.z.literal(`thinking`),thinking:n.z.string(),signature:n.z.string()}),n.z.object({type:n.z.literal(`redacted_thinking`),data:n.z.string()}),n.z.object({type:n.z.literal(`tool_use`),id:n.z.string(),name:n.z.string(),input:n.z.unknown()}),n.z.object({type:n.z.literal(`server_tool_use`),id:n.z.string(),name:n.z.string(),input:n.z.record(n.z.string(),n.z.unknown()).nullish()}),n.z.object({type:n.z.literal(`web_search_tool_result`),tool_use_id:n.z.string(),content:n.z.union([n.z.array(n.z.object({type:n.z.literal(`web_search_result`),url:n.z.string(),title:n.z.string(),encrypted_content:n.z.string(),page_age:n.z.string().nullish()})),n.z.object({type:n.z.literal(`web_search_tool_result_error`),error_code:n.z.string()})])}),n.z.object({type:n.z.literal(`code_execution_tool_result`),tool_use_id:n.z.string(),content:n.z.union([n.z.object({type:n.z.literal(`code_execution_result`),stdout:n.z.string(),stderr:n.z.string(),return_code:n.z.number()}),n.z.object({type:n.z.literal(`code_execution_tool_result_error`),error_code:n.z.string()})])})])),stop_reason:n.z.string().nullish(),usage:n.z.looseObject({input_tokens:n.z.number(),output_tokens:n.z.number(),cache_creation_input_tokens:n.z.number().nullish(),cache_read_input_tokens:n.z.number().nullish()})}),nd=n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`message_start`),message:n.z.object({id:n.z.string().nullish(),model:n.z.string().nullish(),usage:n.z.looseObject({input_tokens:n.z.number(),output_tokens:n.z.number(),cache_creation_input_tokens:n.z.number().nullish(),cache_read_input_tokens:n.z.number().nullish()})})}),n.z.object({type:n.z.literal(`content_block_start`),index:n.z.number(),content_block:n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`text`),text:n.z.string()}),n.z.object({type:n.z.literal(`thinking`),thinking:n.z.string()}),n.z.object({type:n.z.literal(`tool_use`),id:n.z.string(),name:n.z.string()}),n.z.object({type:n.z.literal(`redacted_thinking`),data:n.z.string()}),n.z.object({type:n.z.literal(`server_tool_use`),id:n.z.string(),name:n.z.string(),input:n.z.record(n.z.string(),n.z.unknown()).nullish()}),n.z.object({type:n.z.literal(`web_search_tool_result`),tool_use_id:n.z.string(),content:n.z.union([n.z.array(n.z.object({type:n.z.literal(`web_search_result`),url:n.z.string(),title:n.z.string(),encrypted_content:n.z.string(),page_age:n.z.string().nullish()})),n.z.object({type:n.z.literal(`web_search_tool_result_error`),error_code:n.z.string()})])}),n.z.object({type:n.z.literal(`code_execution_tool_result`),tool_use_id:n.z.string(),content:n.z.union([n.z.object({type:n.z.literal(`code_execution_result`),stdout:n.z.string(),stderr:n.z.string(),return_code:n.z.number()}),n.z.object({type:n.z.literal(`code_execution_tool_result_error`),error_code:n.z.string()})])})])}),n.z.object({type:n.z.literal(`content_block_delta`),index:n.z.number(),delta:n.z.discriminatedUnion(`type`,[n.z.object({type:n.z.literal(`input_json_delta`),partial_json:n.z.string()}),n.z.object({type:n.z.literal(`text_delta`),text:n.z.string()}),n.z.object({type:n.z.literal(`thinking_delta`),thinking:n.z.string()}),n.z.object({type:n.z.literal(`signature_delta`),signature:n.z.string()}),n.z.object({type:n.z.literal(`citations_delta`),citation:Zu})])}),n.z.object({type:n.z.literal(`content_block_stop`),index:n.z.number()}),n.z.object({type:n.z.literal(`error`),error:n.z.object({type:n.z.string(),message:n.z.string()})}),n.z.object({type:n.z.literal(`message_delta`),delta:n.z.object({stop_reason:n.z.string().nullish()}),usage:n.z.object({output_tokens:n.z.number()})}),n.z.object({type:n.z.literal(`message_stop`)}),n.z.object({type:n.z.literal(`ping`)})]),rd=n.z.object({signature:n.z.string().optional(),redactedData:n.z.string().optional()}),id=W({id:`anthropic.bash_20241022`,name:`bash`,inputSchema:n.default.object({command:n.default.string(),restart:n.default.boolean().optional()})}),ad=W({id:`anthropic.bash_20250124`,name:`bash`,inputSchema:n.default.object({command:n.default.string(),restart:n.default.boolean().optional()})}),od=W({id:`anthropic.computer_20241022`,name:`computer`,inputSchema:n.z.object({action:n.z.enum([`key`,`type`,`mouse_move`,`left_click`,`left_click_drag`,`right_click`,`middle_click`,`double_click`,`screenshot`,`cursor_position`]),coordinate:n.z.array(n.z.number().int()).optional(),text:n.z.string().optional()})}),sd=W({id:`anthropic.computer_20250124`,name:`computer`,inputSchema:n.z.object({action:n.z.enum([`key`,`hold_key`,`type`,`cursor_position`,`mouse_move`,`left_mouse_down`,`left_mouse_up`,`left_click`,`left_click_drag`,`right_click`,`middle_click`,`double_click`,`triple_click`,`scroll`,`wait`,`screenshot`]),coordinate:n.z.tuple([n.z.number().int(),n.z.number().int()]).optional(),duration:n.z.number().optional(),scroll_amount:n.z.number().optional(),scroll_direction:n.z.enum([`up`,`down`,`left`,`right`]).optional(),start_coordinate:n.z.tuple([n.z.number().int(),n.z.number().int()]).optional(),text:n.z.string().optional()})}),cd=W({id:`anthropic.text_editor_20241022`,name:`str_replace_editor`,inputSchema:n.z.object({command:n.z.enum([`view`,`create`,`str_replace`,`insert`,`undo_edit`]),path:n.z.string(),file_text:n.z.string().optional(),insert_line:n.z.number().int().optional(),new_str:n.z.string().optional(),old_str:n.z.string().optional(),view_range:n.z.array(n.z.number().int()).optional()})}),ld=W({id:`anthropic.text_editor_20250124`,name:`str_replace_editor`,inputSchema:n.z.object({command:n.z.enum([`view`,`create`,`str_replace`,`insert`,`undo_edit`]),path:n.z.string(),file_text:n.z.string().optional(),insert_line:n.z.number().int().optional(),new_str:n.z.string().optional(),old_str:n.z.string().optional(),view_range:n.z.array(n.z.number().int()).optional()})}),ud=W({id:`anthropic.text_editor_20250429`,name:`str_replace_based_edit_tool`,inputSchema:n.z.object({command:n.z.enum([`view`,`create`,`str_replace`,`insert`]),path:n.z.string(),file_text:n.z.string().optional(),insert_line:n.z.number().int().optional(),new_str:n.z.string().optional(),old_str:n.z.string().optional(),view_range:n.z.array(n.z.number().int()).optional()})}),dd={bash_20241022:id,bash_20250124:ad,codeExecution_20250522:Gu,computer_20241022:od,computer_20250124:sd,textEditor_20241022:cd,textEditor_20250124:ld,textEditor_20250429:ud,webSearch_20250305:Bu};function fd(e={}){var t;let n=(t=Fn(e.baseURL))??`https://api.anthropic.com/v1`,r=()=>({"anthropic-version":`2023-06-01`,"x-api-key":Ze({apiKey:e.apiKey,environmentVariableName:`ANTHROPIC_API_KEY`,description:`Anthropic`}),...e.headers}),i=t=>{var i;return new ed(t,{provider:`anthropic.messages`,baseURL:n,headers:r,fetch:e.fetch,generateId:(i=e.generateId)??V,supportedUrls:()=>({"image/*":[/^https?:\/\/.*$/]})})},a=function(e){if(new.target)throw Error(`The Anthropic model function cannot be called with the new keyword.`);return i(e)};return a.languageModel=i,a.chat=i,a.messages=i,a.textEmbeddingModel=e=>{throw new ye({modelId:e,modelType:`textEmbeddingModel`})},a.imageModel=e=>{throw new ye({modelId:e,modelType:`imageModel`})},a.tools=dd,a}var pd=fd(),md=n.z.object({error:n.z.object({code:n.z.number().nullable(),message:n.z.string(),status:n.z.string()})}),hd=xt({errorSchema:md,errorToMessage:e=>e.error.message}),gd=n.z.object({outputDimensionality:n.z.number().optional(),taskType:n.z.enum([`SEMANTIC_SIMILARITY`,`CLASSIFICATION`,`CLUSTERING`,`RETRIEVAL_DOCUMENT`,`RETRIEVAL_QUERY`,`QUESTION_ANSWERING`,`FACT_VERIFICATION`,`CODE_RETRIEVAL_QUERY`]).optional()}),_d=class{constructor(e,t){this.specificationVersion=`v2`,this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){let i=await H({provider:`google`,providerOptions:r,schema:gd});if(e.length>this.maxEmbeddingsPerCall)throw new Ce({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let a=B(await G(this.config.headers),t);if(e.length===1){let{responseHeaders:t,value:r,rawValue:o}=await U({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:a,body:{model:`models/${this.modelId}`,content:{parts:[{text:e[0]}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType},failedResponseHandler:hd,successfulResponseHandler:K(yd),abortSignal:n,fetch:this.config.fetch});return{embeddings:[r.embedding.values],usage:void 0,response:{headers:t,body:o}}}let{responseHeaders:o,value:s,rawValue:c}=await U({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:a,body:{requests:e.map(e=>({model:`models/${this.modelId}`,content:{role:`user`,parts:[{text:e}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType}))},failedResponseHandler:hd,successfulResponseHandler:K(vd),abortSignal:n,fetch:this.config.fetch});return{embeddings:s.embeddings.map(e=>e.values),usage:void 0,response:{headers:o,body:c}}}},vd=n.z.object({embeddings:n.z.array(n.z.object({values:n.z.array(n.z.number())}))}),yd=n.z.object({embedding:n.z.object({values:n.z.array(n.z.number())})});function bd(e){if(e==null||xd(e))return;if(typeof e==`boolean`)return{type:`boolean`,properties:{}};let{type:t,description:n,required:r,properties:i,items:a,allOf:o,anyOf:s,oneOf:c,format:l,const:u,minLength:d,enum:f}=e,p={};if(n&&(p.description=n),r&&(p.required=r),l&&(p.format=l),u!==void 0&&(p.enum=[u]),t&&(Array.isArray(t)?t.includes(`null`)?(p.type=t.filter(e=>e!==`null`)[0],p.nullable=!0):p.type=t:t===`null`?p.type=`null`:p.type=t),f!==void 0&&(p.enum=f),i!=null&&(p.properties=Object.entries(i).reduce((e,[t,n])=>(e[t]=bd(n),e),{})),a&&(p.items=Array.isArray(a)?a.map(bd):bd(a)),o&&(p.allOf=o.map(bd)),s)if(s.some(e=>typeof e==`object`&&e?.type===`null`)){let e=s.filter(e=>!(typeof e==`object`&&e?.type===`null`));if(e.length===1){let t=bd(e[0]);typeof t==`object`&&(p.nullable=!0,Object.assign(p,t))}else p.anyOf=e.map(bd),p.nullable=!0}else p.anyOf=s.map(bd);return c&&(p.oneOf=c.map(bd)),d!==void 0&&(p.minLength=d),p}function xd(e){return typeof e==`object`&&!!e&&e.type===`object`&&(e.properties==null||Object.keys(e.properties).length===0)&&!e.additionalProperties}function Sd(e,t){var n;let r=[],i=[],a=!0,o=(n=t?.isGemmaModel)??!1;for(let{role:t,content:n}of e)switch(t){case`system`:if(!a)throw new z({functionality:`system messages are only supported at the beginning of the conversation`});r.push({text:n});break;case`user`:{a=!1;let e=[];for(let t of n)switch(t.type){case`text`:e.push({text:t.text});break;case`file`:{let n=t.mediaType===`image/*`?`image/jpeg`:t.mediaType;e.push(t.data instanceof URL?{fileData:{mimeType:n,fileUri:t.data.toString()}}:{inlineData:{mimeType:n,data:Pn(t.data)}});break}}i.push({role:`user`,parts:e});break}case`assistant`:a=!1,i.push({role:`model`,parts:n.map(e=>{var t,n,r,i,a,o;switch(e.type){case`text`:return e.text.length===0?void 0:{text:e.text,thoughtSignature:(n=(t=e.providerOptions)?.google)?.thoughtSignature};case`reasoning`:return e.text.length===0?void 0:{text:e.text,thought:!0,thoughtSignature:(i=(r=e.providerOptions)?.google)?.thoughtSignature};case`file`:if(e.mediaType!==`image/png`)throw new z({functionality:`Only PNG images are supported in assistant messages`});if(e.data instanceof URL)throw new z({functionality:`File data URLs in assistant messages are not supported`});return{inlineData:{mimeType:e.mediaType,data:Pn(e.data)}};case`tool-call`:return{functionCall:{name:e.toolName,args:e.input},thoughtSignature:(o=(a=e.providerOptions)?.google)?.thoughtSignature}}}).filter(e=>e!==void 0)});break;case`tool`:{a=!1;let e=[];for(let t of n){let n=t.output;if(n.type===`content`)for(let r of n.value)switch(r.type){case`text`:e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:r.text}}});break;case`media`:e.push({inlineData:{mimeType:r.mediaType,data:r.data}},{text:`Tool executed successfully and returned this image as a response`});break;default:e.push({text:JSON.stringify(r)});break}else e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:n.value}}})}i.push({role:`user`,parts:e});break}}if(o&&r.length>0&&i.length>0&&i[0].role===`user`){let e=r.map(e=>e.text).join(`

`);i[0].parts.unshift({text:e+`

`})}return{systemInstruction:r.length>0&&!o?{parts:r}:void 0,contents:i}}function Cd(e){return e.includes(`/`)?e:`models/${e}`}var wd=n.z.object({responseModalities:n.z.array(n.z.enum([`TEXT`,`IMAGE`])).optional(),thinkingConfig:n.z.object({thinkingBudget:n.z.number().optional(),includeThoughts:n.z.boolean().optional()}).optional(),cachedContent:n.z.string().optional(),structuredOutputs:n.z.boolean().optional(),safetySettings:n.z.array(n.z.object({category:n.z.enum([`HARM_CATEGORY_UNSPECIFIED`,`HARM_CATEGORY_HATE_SPEECH`,`HARM_CATEGORY_DANGEROUS_CONTENT`,`HARM_CATEGORY_HARASSMENT`,`HARM_CATEGORY_SEXUALLY_EXPLICIT`,`HARM_CATEGORY_CIVIC_INTEGRITY`]),threshold:n.z.enum([`HARM_BLOCK_THRESHOLD_UNSPECIFIED`,`BLOCK_LOW_AND_ABOVE`,`BLOCK_MEDIUM_AND_ABOVE`,`BLOCK_ONLY_HIGH`,`BLOCK_NONE`,`OFF`])})).optional(),threshold:n.z.enum([`HARM_BLOCK_THRESHOLD_UNSPECIFIED`,`BLOCK_LOW_AND_ABOVE`,`BLOCK_MEDIUM_AND_ABOVE`,`BLOCK_ONLY_HIGH`,`BLOCK_NONE`,`OFF`]).optional(),audioTimestamp:n.z.boolean().optional(),labels:n.z.record(n.z.string(),n.z.string()).optional()});function Td({tools:e,toolChoice:t,modelId:n}){var r;e=e?.length?e:void 0;let i=[],a=n.includes(`gemini-2`),o=n.includes(`gemini-1.5-flash`)&&!n.includes(`-8b`);if(e==null)return{tools:void 0,toolConfig:void 0,toolWarnings:i};let s=e.some(e=>e.type===`function`),c=e.some(e=>e.type===`provider-defined`);if(s&&c&&i.push({type:`unsupported-tool`,tool:e.find(e=>e.type===`function`),details:`Cannot mix function tools with provider-defined tools in the same request. Please use either function tools or provider-defined tools, but not both.`}),c){let t={},n=e.filter(e=>e.type===`provider-defined`);return n.forEach(e=>{switch(e.id){case`google.google_search`:a?t.googleSearch={}:o?t.googleSearchRetrieval={dynamicRetrievalConfig:{mode:e.args.mode,dynamicThreshold:e.args.dynamicThreshold}}:t.googleSearchRetrieval={};break;case`google.url_context`:a?t.urlContext={}:i.push({type:`unsupported-tool`,tool:e,details:`The URL context tool is not supported with other Gemini models than Gemini 2.`});break;case`google.code_execution`:a?t.codeExecution={}:i.push({type:`unsupported-tool`,tool:e,details:`The code execution tools is not supported with other Gemini models than Gemini 2.`});break;default:i.push({type:`unsupported-tool`,tool:e});break}}),{tools:Object.keys(t).length>0?t:void 0,toolConfig:void 0,toolWarnings:i}}let l=[];for(let t of e)switch(t.type){case`function`:l.push({name:t.name,description:(r=t.description)??``,parameters:bd(t.inputSchema)});break;default:i.push({type:`unsupported-tool`,tool:t});break}if(t==null)return{tools:{functionDeclarations:l},toolConfig:void 0,toolWarnings:i};let u=t.type;switch(u){case`auto`:return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:`AUTO`}},toolWarnings:i};case`none`:return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:`NONE`}},toolWarnings:i};case`required`:return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:`ANY`}},toolWarnings:i};case`tool`:return{tools:{functionDeclarations:l},toolConfig:{functionCallingConfig:{mode:`ANY`,allowedFunctionNames:[t.toolName]}},toolWarnings:i};default:{let e=u;throw new z({functionality:`tool choice type: ${e}`})}}}function Ed({finishReason:e,hasToolCalls:t}){switch(e){case`STOP`:return t?`tool-calls`:`stop`;case`MAX_TOKENS`:return`length`;case`IMAGE_SAFETY`:case`RECITATION`:case`SAFETY`:case`BLOCKLIST`:case`PROHIBITED_CONTENT`:case`SPII`:return`content-filter`;case`FINISH_REASON_UNSPECIFIED`:case`OTHER`:return`other`;case`MALFORMED_FUNCTION_CALL`:return`error`;default:return`unknown`}}var Dd=n.z.object({web:n.z.object({uri:n.z.string(),title:n.z.string()}).nullish(),retrievedContext:n.z.object({uri:n.z.string(),title:n.z.string()}).nullish()}),Od=n.z.object({webSearchQueries:n.z.array(n.z.string()).nullish(),retrievalQueries:n.z.array(n.z.string()).nullish(),searchEntryPoint:n.z.object({renderedContent:n.z.string()}).nullish(),groundingChunks:n.z.array(Dd).nullish(),groundingSupports:n.z.array(n.z.object({segment:n.z.object({startIndex:n.z.number().nullish(),endIndex:n.z.number().nullish(),text:n.z.string().nullish()}),segment_text:n.z.string().nullish(),groundingChunkIndices:n.z.array(n.z.number()).nullish(),supportChunkIndices:n.z.array(n.z.number()).nullish(),confidenceScores:n.z.array(n.z.number()).nullish(),confidenceScore:n.z.array(n.z.number()).nullish()})).nullish(),retrievalMetadata:n.z.union([n.z.object({webDynamicRetrievalScore:n.z.number()}),n.z.object({})]).nullish()}),kd=W({id:`google.google_search`,name:`google_search`,inputSchema:n.z.object({mode:n.z.enum([`MODE_DYNAMIC`,`MODE_UNSPECIFIED`]).default(`MODE_UNSPECIFIED`),dynamicThreshold:n.z.number().default(1)})}),Ad=n.z.object({retrievedUrl:n.z.string(),urlRetrievalStatus:n.z.string()}),jd=n.z.object({urlMetadata:n.z.array(Ad)}),Md=W({id:`google.url_context`,name:`url_context`,inputSchema:n.z.object({})}),Nd=class{constructor(e,t){this.specificationVersion=`v2`;var n;this.modelId=e,this.config=t,this.generateId=(n=t.generateId)??V}get provider(){return this.config.provider}get supportedUrls(){var e,t,n;return(n=(t=(e=this.config).supportedUrls)?.call(e))??{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,responseFormat:c,seed:l,tools:u,toolChoice:d,providerOptions:f}){var p,m;let h=[],g=await H({provider:`google`,providerOptions:f,schema:wd});(p=g?.thinkingConfig)?.includeThoughts===!0&&!this.config.provider.startsWith(`google.vertex.`)&&h.push({type:`other`,message:`The 'includeThoughts' option is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});let _=this.modelId.toLowerCase().startsWith(`gemma-`),{contents:v,systemInstruction:y}=Sd(e,{isGemmaModel:_}),{tools:b,toolConfig:x,toolWarnings:S}=Td({tools:u,toolChoice:d,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:t,temperature:n,topK:i,topP:r,frequencyPenalty:a,presencePenalty:o,stopSequences:s,seed:l,responseMimeType:c?.type===`json`?`application/json`:void 0,responseSchema:c?.type===`json`&&c.schema!=null&&((m=g?.structuredOutputs)??!0)?bd(c.schema):void 0,...g?.audioTimestamp&&{audioTimestamp:g.audioTimestamp},responseModalities:g?.responseModalities,thinkingConfig:g?.thinkingConfig},contents:v,systemInstruction:_?void 0:y,safetySettings:g?.safetySettings,tools:b,toolConfig:x,cachedContent:g?.cachedContent,labels:g?.labels},warnings:[...h,...S]}}async doGenerate(e){var t,n,r,i,a,o,s,c,l,u,d,f;let{args:p,warnings:m}=await this.getArgs(e),h=JSON.stringify(p),g=B(await G(this.config.headers),e.headers),{responseHeaders:_,value:v,rawValue:y}=await U({url:`${this.config.baseURL}/${Cd(this.modelId)}:generateContent`,headers:g,body:p,failedResponseHandler:hd,successfulResponseHandler:K(Bd),abortSignal:e.abortSignal,fetch:this.config.fetch}),b=v.candidates[0],x=[],S=(n=(t=b.content)?.parts)??[],C=v.usageMetadata,w;for(let e of S)if(`executableCode`in e&&(r=e.executableCode)?.code){let t=this.config.generateId();w=t,x.push({type:`tool-call`,toolCallId:t,toolName:`code_execution`,input:JSON.stringify(e.executableCode),providerExecuted:!0})}else `codeExecutionResult`in e&&e.codeExecutionResult?(x.push({type:`tool-result`,toolCallId:w,toolName:`code_execution`,result:{outcome:e.codeExecutionResult.outcome,output:e.codeExecutionResult.output},providerExecuted:!0}),w=void 0):`text`in e&&e.text!=null&&e.text.length>0?x.push({type:e.thought===!0?`reasoning`:`text`,text:e.text,providerMetadata:e.thoughtSignature?{google:{thoughtSignature:e.thoughtSignature}}:void 0}):`functionCall`in e?x.push({type:`tool-call`,toolCallId:this.config.generateId(),toolName:e.functionCall.name,input:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{google:{thoughtSignature:e.thoughtSignature}}:void 0}):`inlineData`in e&&x.push({type:`file`,data:e.inlineData.data,mediaType:e.inlineData.mimeType});let T=(i=Id({groundingMetadata:b.groundingMetadata,generateId:this.config.generateId}))??[];for(let e of T)x.push(e);return{content:x,finishReason:Ed({finishReason:b.finishReason,hasToolCalls:x.some(e=>e.type===`tool-call`)}),usage:{inputTokens:(a=C?.promptTokenCount)??void 0,outputTokens:(o=C?.candidatesTokenCount)??void 0,totalTokens:(s=C?.totalTokenCount)??void 0,reasoningTokens:(c=C?.thoughtsTokenCount)??void 0,cachedInputTokens:(l=C?.cachedContentTokenCount)??void 0},warnings:m,providerMetadata:{google:{groundingMetadata:(u=b.groundingMetadata)??null,urlContextMetadata:(d=b.urlContextMetadata)??null,safetyRatings:(f=b.safetyRatings)??null,usageMetadata:C??null}},request:{body:h},response:{headers:_,body:y}}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r=JSON.stringify(t),i=B(await G(this.config.headers),e.headers),{responseHeaders:a,value:o}=await U({url:`${this.config.baseURL}/${Cd(this.modelId)}:streamGenerateContent?alt=sse`,headers:i,body:t,failedResponseHandler:hd,successfulResponseHandler:St(Vd),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=`unknown`,c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l,u=this.config.generateId,d=!1,f=null,p=null,m=0,h=new Set,g;return{stream:o.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:n})},transform(t,n){var r,i,a,o,_,v,y,b,x,S,C;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let w=t.value,T=w.usageMetadata;T!=null&&(c.inputTokens=(r=T.promptTokenCount)??void 0,c.outputTokens=(i=T.candidatesTokenCount)??void 0,c.totalTokens=(a=T.totalTokenCount)??void 0,c.reasoningTokens=(o=T.thoughtsTokenCount)??void 0,c.cachedInputTokens=(_=T.cachedContentTokenCount)??void 0);let E=(v=w.candidates)?.[0];if(E==null)return;let D=E.content,O=Id({groundingMetadata:E.groundingMetadata,generateId:u});if(O!=null)for(let e of O)e.sourceType===`url`&&!h.has(e.url)&&(h.add(e.url),n.enqueue(e));if(D!=null){let e=(y=D.parts)??[];for(let t of e)if(`executableCode`in t&&(b=t.executableCode)?.code){let e=u();g=e,n.enqueue({type:`tool-call`,toolCallId:e,toolName:`code_execution`,input:JSON.stringify(t.executableCode),providerExecuted:!0}),d=!0}else if(`codeExecutionResult`in t&&t.codeExecutionResult){let e=g;e&&(n.enqueue({type:`tool-result`,toolCallId:e,toolName:`code_execution`,result:{outcome:t.codeExecutionResult.outcome,output:t.codeExecutionResult.output},providerExecuted:!0}),g=void 0)}else `text`in t&&t.text!=null&&t.text.length>0&&(t.thought===!0?(f!==null&&(n.enqueue({type:`text-end`,id:f}),f=null),p===null&&(p=String(m++),n.enqueue({type:`reasoning-start`,id:p,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})),n.enqueue({type:`reasoning-delta`,id:p,delta:t.text,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})):(p!==null&&(n.enqueue({type:`reasoning-end`,id:p}),p=null),f===null&&(f=String(m++),n.enqueue({type:`text-start`,id:f,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})),n.enqueue({type:`text-delta`,id:f,delta:t.text,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})));let t=Fd(D.parts);if(t!=null)for(let e of t)n.enqueue({type:`file`,mediaType:e.inlineData.mimeType,data:e.inlineData.data});let r=Pd({parts:D.parts,generateId:u});if(r!=null)for(let e of r)n.enqueue({type:`tool-input-start`,id:e.toolCallId,toolName:e.toolName,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-input-delta`,id:e.toolCallId,delta:e.args,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-input-end`,id:e.toolCallId,providerMetadata:e.providerMetadata}),n.enqueue({type:`tool-call`,toolCallId:e.toolCallId,toolName:e.toolName,input:e.args,providerMetadata:e.providerMetadata}),d=!0}E.finishReason!=null&&(s=Ed({finishReason:E.finishReason,hasToolCalls:d}),l={google:{groundingMetadata:(x=E.groundingMetadata)??null,urlContextMetadata:(S=E.urlContextMetadata)??null,safetyRatings:(C=E.safetyRatings)??null}},T!=null&&(l.google.usageMetadata=T))},flush(e){f!==null&&e.enqueue({type:`text-end`,id:f}),p!==null&&e.enqueue({type:`reasoning-end`,id:p}),e.enqueue({type:`finish`,finishReason:s,usage:c,providerMetadata:l})}})),response:{headers:a},request:{body:r}}}};function Pd({parts:e,generateId:t}){let n=e?.filter(e=>`functionCall`in e);return n==null||n.length===0?void 0:n.map(e=>({type:`tool-call`,toolCallId:t(),toolName:e.functionCall.name,args:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{google:{thoughtSignature:e.thoughtSignature}}:void 0}))}function Fd(e){return e?.filter(e=>`inlineData`in e)}function Id({groundingMetadata:e,generateId:t}){var n;return(n=e?.groundingChunks)?.filter(e=>e.web!=null).map(e=>({type:`source`,sourceType:`url`,id:t(),url:e.web.uri,title:e.web.title}))}var Ld=n.z.object({parts:n.z.array(n.z.union([n.z.object({functionCall:n.z.object({name:n.z.string(),args:n.z.unknown()}),thoughtSignature:n.z.string().nullish()}),n.z.object({inlineData:n.z.object({mimeType:n.z.string(),data:n.z.string()})}),n.z.object({executableCode:n.z.object({language:n.z.string(),code:n.z.string()}).nullish(),codeExecutionResult:n.z.object({outcome:n.z.string(),output:n.z.string()}).nullish(),text:n.z.string().nullish(),thought:n.z.boolean().nullish(),thoughtSignature:n.z.string().nullish()})])).nullish()}),Rd=n.z.object({category:n.z.string().nullish(),probability:n.z.string().nullish(),probabilityScore:n.z.number().nullish(),severity:n.z.string().nullish(),severityScore:n.z.number().nullish(),blocked:n.z.boolean().nullish()}),zd=n.z.object({cachedContentTokenCount:n.z.number().nullish(),thoughtsTokenCount:n.z.number().nullish(),promptTokenCount:n.z.number().nullish(),candidatesTokenCount:n.z.number().nullish(),totalTokenCount:n.z.number().nullish()}),Bd=n.z.object({candidates:n.z.array(n.z.object({content:Ld.nullish().or(n.z.object({}).strict()),finishReason:n.z.string().nullish(),safetyRatings:n.z.array(Rd).nullish(),groundingMetadata:Od.nullish(),urlContextMetadata:jd.nullish()})),usageMetadata:zd.nullish()}),Vd=n.z.object({candidates:n.z.array(n.z.object({content:Ld.nullish(),finishReason:n.z.string().nullish(),safetyRatings:n.z.array(Rd).nullish(),groundingMetadata:Od.nullish(),urlContextMetadata:jd.nullish()})).nullish(),usageMetadata:zd.nullish()}),Hd=bt({id:`google.code_execution`,name:`code_execution`,inputSchema:n.z.object({language:n.z.string().describe(`The programming language of the code.`),code:n.z.string().describe(`The code to be executed.`)}),outputSchema:n.z.object({outcome:n.z.string().describe(`The outcome of the execution (e.g., "OUTCOME_OK").`),output:n.z.string().describe(`The output from the code execution.`)})}),Ud={googleSearch:kd,urlContext:Md,codeExecution:Hd},Wd=class{constructor(e,t,n){this.modelId=e,this.settings=t,this.config=n,this.specificationVersion=`v2`}get maxImagesPerCall(){var e;return(e=this.settings.maxImagesPerCall)??4}get provider(){return this.config.provider}async doGenerate(e){var t,n,r;let{prompt:i,n:a=1,size:o=`1024x1024`,aspectRatio:s=`1:1`,seed:c,providerOptions:l,headers:u,abortSignal:d}=e,f=[];o!=null&&f.push({type:`unsupported-setting`,setting:`size`,details:"This model does not support the `size` option. Use `aspectRatio` instead."}),c!=null&&f.push({type:`unsupported-setting`,setting:`seed`,details:"This model does not support the `seed` option through this provider."});let p=await H({provider:`google`,providerOptions:l,schema:Kd}),m=(r=(n=(t=this.config._internal)?.currentDate)?.call(t))??new Date,h={sampleCount:a};s!=null&&(h.aspectRatio=s),p&&Object.assign(h,p);let g={instances:[{prompt:i}],parameters:h},{responseHeaders:_,value:v}=await U({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:B(await G(this.config.headers),u),body:g,failedResponseHandler:hd,successfulResponseHandler:K(Gd),abortSignal:d,fetch:this.config.fetch});return{images:v.predictions.map(e=>e.bytesBase64Encoded),warnings:f??[],providerMetadata:{google:{images:v.predictions.map(e=>({}))}},response:{timestamp:m,modelId:this.modelId,headers:_}}}},Gd=n.z.object({predictions:n.z.array(n.z.object({bytesBase64Encoded:n.z.string()})).default([])}),Kd=n.z.object({personGeneration:n.z.enum([`dont_allow`,`allow_adult`,`allow_all`]).nullish(),aspectRatio:n.z.enum([`1:1`,`3:4`,`4:3`,`9:16`,`16:9`]).nullish()});function qd(e={}){var t;let n=(t=Fn(e.baseURL))??`https://generativelanguage.googleapis.com/v1beta`,r=()=>({"x-goog-api-key":Ze({apiKey:e.apiKey,environmentVariableName:`GOOGLE_GENERATIVE_AI_API_KEY`,description:`Google Generative AI`}),...e.headers}),i=t=>{var i;return new Nd(t,{provider:`google.generative-ai`,baseURL:n,headers:r,generateId:(i=e.generateId)??V,supportedUrls:()=>({"*":[RegExp(`^${n}/files/.*$`),RegExp(`^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$`),RegExp(`^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$`)]}),fetch:e.fetch})},a=t=>new _d(t,{provider:`google.generative-ai`,baseURL:n,headers:r,fetch:e.fetch}),o=(t,i={})=>new Wd(t,i,{provider:`google.generative-ai`,baseURL:n,headers:r,fetch:e.fetch}),s=function(e){if(new.target)throw Error(`The Google Generative AI model function cannot be called with the new keyword.`);return i(e)};return s.languageModel=i,s.chat=i,s.generativeAI=i,s.embedding=a,s.textEmbedding=a,s.textEmbeddingModel=a,s.image=o,s.imageModel=o,s.tools=Ud,s}var Jd=qd(),Yd=n.z.object({user:n.z.string().optional(),reasoningEffort:n.z.string().optional()}),Xd=n.z.object({error:n.z.object({message:n.z.string(),type:n.z.string().nullish(),param:n.z.any().nullish(),code:n.z.union([n.z.string(),n.z.number()]).nullish()})}),Zd={errorSchema:Xd,errorToMessage:e=>e.error.message},Qd=n.z.object({prompt_tokens:n.z.number().nullish(),completion_tokens:n.z.number().nullish(),total_tokens:n.z.number().nullish(),prompt_tokens_details:n.z.object({cached_tokens:n.z.number().nullish()}).nullish(),completion_tokens_details:n.z.object({reasoning_tokens:n.z.number().nullish(),accepted_prediction_tokens:n.z.number().nullish(),rejected_prediction_tokens:n.z.number().nullish()}).nullish()}).nullish(),$d=n.z.object({id:n.z.string().nullish(),created:n.z.number().nullish(),model:n.z.string().nullish(),choices:n.z.array(n.z.object({message:n.z.object({role:n.z.literal(`assistant`).nullish(),content:n.z.string().nullish(),reasoning_content:n.z.string().nullish(),reasoning:n.z.string().nullish(),tool_calls:n.z.array(n.z.object({id:n.z.string().nullish(),function:n.z.object({name:n.z.string(),arguments:n.z.string()})})).nullish()}),finish_reason:n.z.string().nullish()})),usage:Qd}),ef=n.z.object({echo:n.z.boolean().optional(),logitBias:n.z.record(n.z.string(),n.z.number()).optional(),suffix:n.z.string().optional(),user:n.z.string().optional()}),tf=n.z.object({prompt_tokens:n.z.number(),completion_tokens:n.z.number(),total_tokens:n.z.number()}),nf=n.z.object({id:n.z.string().nullish(),created:n.z.number().nullish(),model:n.z.string().nullish(),choices:n.z.array(n.z.object({text:n.z.string(),finish_reason:n.z.string()})),usage:tf.nullish()}),rf=n.z.object({dimensions:n.z.number().optional(),user:n.z.string().optional()}),af=n.z.object({data:n.z.array(n.z.object({embedding:n.z.array(n.z.number())})),usage:n.z.object({prompt_tokens:n.z.number()}).nullish(),providerMetadata:n.z.record(n.z.string(),n.z.record(n.z.string(),n.z.any())).optional()}),sf=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion=`v2`,this.maxImagesPerCall=10}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:i,providerOptions:a,headers:o,abortSignal:s}){var c,l,u,d,f;let p=[];r!=null&&p.push({type:`unsupported-setting`,setting:`aspectRatio`,details:"This model does not support aspect ratio. Use `size` instead."}),i!=null&&p.push({type:`unsupported-setting`,setting:`seed`});let m=(u=(l=(c=this.config._internal)?.currentDate)?.call(c))??new Date,{value:h,responseHeaders:g}=await U({url:this.config.url({path:`/images/generations`,modelId:this.modelId}),headers:B(this.config.headers(),o),body:{model:this.modelId,prompt:e,n:t,size:n,...(d=a.openai)??{},response_format:`b64_json`},failedResponseHandler:xt((f=this.config.errorStructure)??Zd),successfulResponseHandler:K(cf),abortSignal:s,fetch:this.config.fetch});return{images:h.data.map(e=>e.b64_json),warnings:p,response:{timestamp:m,modelId:this.modelId,headers:g}}}},cf=n.z.object({data:n.z.array(n.z.object({b64_json:n.z.string()}))});function lf(e){let t=[],n=[];for(let{role:n,content:r}of e)switch(n){case`system`:t.push({role:`system`,content:r});break;case`user`:if(r.length===1&&r[0].type===`text`){t.push({role:`user`,content:r[0].text});break}t.push({role:`user`,content:r.map(e=>{switch(e.type){case`text`:return{type:`text`,text:e.text};case`file`:if(e.mediaType.startsWith(`image/`)){let t=e.mediaType===`image/*`?`image/jpeg`:e.mediaType;return{type:`image_url`,image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${Pn(e.data)}`}}}else throw new z({functionality:`file part media type ${e.mediaType}`})}})});break;case`assistant`:{let e=``,n=[];for(let t of r)switch(t.type){case`text`:e+=t.text;break;case`tool-call`:n.push({id:t.toolCallId,type:`function`,function:{name:t.toolName,arguments:JSON.stringify(t.input)}});break}t.push({role:`assistant`,content:e,tool_calls:n.length>0?n:void 0});break}case`tool`:for(let e of r){let n=e.output,r;switch(n.type){case`text`:case`error-text`:r=n.value;break;case`content`:case`json`:case`error-json`:r=JSON.stringify(n.value);break}t.push({role:`tool`,tool_call_id:e.toolCallId,content:r})}break;default:{let e=n;throw Error(`Unsupported role: ${e}`)}}return{messages:t,warnings:n}}function uf({id:e,model:t,created:n}){return{id:e??void 0,modelId:t??void 0,timestamp:n==null?void 0:new Date(n*1e3)}}function df(e){switch(e){case`stop`:return`stop`;case`length`:return`length`;case`tool_calls`:case`function_call`:return`tool-calls`;case`content_filter`:return`content-filter`;default:return`unknown`}}var ff=n.z.object({type:n.z.literal(`web`),country:n.z.string().length(2).optional(),excludedWebsites:n.z.array(n.z.string()).max(5).optional(),allowedWebsites:n.z.array(n.z.string()).max(5).optional(),safeSearch:n.z.boolean().optional()}),pf=n.z.object({type:n.z.literal(`x`),xHandles:n.z.array(n.z.string()).optional()}),mf=n.z.object({type:n.z.literal(`news`),country:n.z.string().length(2).optional(),excludedWebsites:n.z.array(n.z.string()).max(5).optional(),safeSearch:n.z.boolean().optional()}),hf=n.z.object({type:n.z.literal(`rss`),links:n.z.array(n.z.string().url()).max(1)}),gf=n.z.discriminatedUnion(`type`,[ff,pf,mf,hf]),_f=n.z.object({reasoningEffort:n.z.enum([`low`,`high`]).optional(),searchParameters:n.z.object({mode:n.z.enum([`off`,`auto`,`on`]),returnCitations:n.z.boolean().optional(),fromDate:n.z.string().optional(),toDate:n.z.string().optional(),maxSearchResults:n.z.number().min(1).max(50).optional(),sources:n.z.array(gf).optional()}).optional()}),vf=n.z.object({error:n.z.object({message:n.z.string(),type:n.z.string().nullish(),param:n.z.any().nullish(),code:n.z.union([n.z.string(),n.z.number()]).nullish()})}),yf=xt({errorSchema:vf,errorToMessage:e=>e.error.message});function bf({tools:e,toolChoice:t}){e=e?.length?e:void 0;let n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)t.type===`provider-defined`?n.push({type:`unsupported-tool`,tool:t}):r.push({type:`function`,function:{name:t.name,description:t.description,parameters:t.inputSchema}});if(t==null)return{tools:r,toolChoice:void 0,toolWarnings:n};let i=t.type;switch(i){case`auto`:case`none`:return{tools:r,toolChoice:i,toolWarnings:n};case`required`:return{tools:r,toolChoice:`required`,toolWarnings:n};case`tool`:return{tools:r,toolChoice:{type:`function`,function:{name:t.toolName}},toolWarnings:n};default:{let e=i;throw new z({functionality:`tool choice type: ${e}`})}}}var xf=class{constructor(e,t){this.specificationVersion=`v2`,this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:o,stopSequences:s,seed:c,responseFormat:l,providerOptions:u,tools:d,toolChoice:f}){var p,m,h;let g=[],_=(p=await H({provider:`xai`,providerOptions:u,schema:_f}))??{};i!=null&&g.push({type:`unsupported-setting`,setting:`topK`}),a!=null&&g.push({type:`unsupported-setting`,setting:`frequencyPenalty`}),o!=null&&g.push({type:`unsupported-setting`,setting:`presencePenalty`}),s!=null&&g.push({type:`unsupported-setting`,setting:`stopSequences`}),l!=null&&l.type===`json`&&l.schema!=null&&g.push({type:`unsupported-setting`,setting:`responseFormat`,details:`JSON response format schema is not supported`});let{messages:v,warnings:y}=lf(e);g.push(...y);let{tools:b,toolChoice:x,toolWarnings:S}=bf({tools:d,toolChoice:f});g.push(...S);let C={model:this.modelId,max_tokens:t,temperature:n,top_p:r,seed:c,reasoning_effort:_.reasoningEffort,response_format:l?.type===`json`?l.schema==null?{type:`json_object`}:{type:`json_schema`,json_schema:{name:(m=l.name)??`response`,schema:l.schema,strict:!0}}:void 0,search_parameters:_.searchParameters?{mode:_.searchParameters.mode,return_citations:_.searchParameters.returnCitations,from_date:_.searchParameters.fromDate,to_date:_.searchParameters.toDate,max_search_results:_.searchParameters.maxSearchResults,sources:(h=_.searchParameters.sources)?.map(e=>({type:e.type,...e.type===`web`&&{country:e.country,excluded_websites:e.excludedWebsites,allowed_websites:e.allowedWebsites,safe_search:e.safeSearch},...e.type===`x`&&{x_handles:e.xHandles},...e.type===`news`&&{country:e.country,excluded_websites:e.excludedWebsites,safe_search:e.safeSearch},...e.type===`rss`&&{links:e.links}}))}:void 0,messages:v,tools:b,tool_choice:x};return{args:C,warnings:g}}async doGenerate(e){var t,n,r;let{args:i,warnings:a}=await this.getArgs(e),{responseHeaders:o,value:s,rawValue:c}=await U({url:`${(t=this.config.baseURL)??`https://api.x.ai/v1`}/chat/completions`,headers:B(this.config.headers(),e.headers),body:i,failedResponseHandler:yf,successfulResponseHandler:K(Cf),abortSignal:e.abortSignal,fetch:this.config.fetch}),l=s.choices[0],u=[];if(l.message.content!=null&&l.message.content.length>0){let e=l.message.content,t=i.messages[i.messages.length-1];t?.role===`assistant`&&e===t.content&&(e=``),e.length>0&&u.push({type:`text`,text:e})}if(l.message.reasoning_content!=null&&l.message.reasoning_content.length>0&&u.push({type:`reasoning`,text:l.message.reasoning_content}),l.message.tool_calls!=null)for(let e of l.message.tool_calls)u.push({type:`tool-call`,toolCallId:e.id,toolName:e.function.name,input:e.function.arguments});if(s.citations!=null)for(let e of s.citations)u.push({type:`source`,sourceType:`url`,id:this.config.generateId(),url:e});return{content:u,finishReason:df(l.finish_reason),usage:{inputTokens:s.usage.prompt_tokens,outputTokens:s.usage.completion_tokens,totalTokens:s.usage.total_tokens,reasoningTokens:(r=(n=s.usage.completion_tokens_details)?.reasoning_tokens)??void 0},request:{body:i},response:{...uf(s),headers:o,body:c},warnings:a}}async doStream(e){var t;let{args:n,warnings:r}=await this.getArgs(e),i={...n,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:a,value:o}=await U({url:`${(t=this.config.baseURL)??`https://api.x.ai/v1`}/chat/completions`,headers:B(this.config.headers(),e.headers),body:i,failedResponseHandler:yf,successfulResponseHandler:St(wf),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=`unknown`,c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l={},u={},d=this;return{stream:o.pipeThrough(new TransformStream({start(e){e.enqueue({type:`stream-start`,warnings:r})},transform(t,n){var r,a;if(e.includeRawChunks&&n.enqueue({type:`raw`,rawValue:t.rawValue}),!t.success){n.enqueue({type:`error`,error:t.error});return}let o=t.value;if(n.enqueue({type:`response-metadata`,...uf(o)}),o.citations!=null)for(let e of o.citations)n.enqueue({type:`source`,sourceType:`url`,id:d.config.generateId(),url:e});o.usage!=null&&(c.inputTokens=o.usage.prompt_tokens,c.outputTokens=o.usage.completion_tokens,c.totalTokens=o.usage.total_tokens,c.reasoningTokens=(a=(r=o.usage.completion_tokens_details)?.reasoning_tokens)??void 0);let f=o.choices[0];if(f?.finish_reason!=null&&(s=df(f.finish_reason)),f?.delta==null)return;let p=f.delta,m=f.index;if(p.content!=null&&p.content.length>0){let e=p.content,t=i.messages[i.messages.length-1];if(t?.role===`assistant`&&e===t.content)return;let r=`text-${o.id||m}`;l[r]??(l[r]={type:`text`},n.enqueue({type:`text-start`,id:r})),n.enqueue({type:`text-delta`,id:r,delta:e})}if(p.reasoning_content!=null&&p.reasoning_content.length>0){let e=`reasoning-${o.id||m}`;if(u[e]===p.reasoning_content)return;u[e]=p.reasoning_content,l[e]??(l[e]={type:`reasoning`},n.enqueue({type:`reasoning-start`,id:e})),n.enqueue({type:`reasoning-delta`,id:e,delta:p.reasoning_content})}if(p.tool_calls!=null)for(let e of p.tool_calls){let t=e.id;n.enqueue({type:`tool-input-start`,id:t,toolName:e.function.name}),n.enqueue({type:`tool-input-delta`,id:t,delta:e.function.arguments}),n.enqueue({type:`tool-input-end`,id:t}),n.enqueue({type:`tool-call`,toolCallId:t,toolName:e.function.name,input:e.function.arguments})}},flush(e){for(let[t,n]of Object.entries(l))e.enqueue({type:n.type===`text`?`text-end`:`reasoning-end`,id:t});e.enqueue({type:`finish`,finishReason:s,usage:c})}})),request:{body:i},response:{headers:a}}}},Sf=n.z.object({prompt_tokens:n.z.number(),completion_tokens:n.z.number(),total_tokens:n.z.number(),completion_tokens_details:n.z.object({reasoning_tokens:n.z.number().nullish()}).nullish()}),Cf=n.z.object({id:n.z.string().nullish(),created:n.z.number().nullish(),model:n.z.string().nullish(),choices:n.z.array(n.z.object({message:n.z.object({role:n.z.literal(`assistant`),content:n.z.string().nullish(),reasoning_content:n.z.string().nullish(),tool_calls:n.z.array(n.z.object({id:n.z.string(),type:n.z.literal(`function`),function:n.z.object({name:n.z.string(),arguments:n.z.string()})})).nullish()}),index:n.z.number(),finish_reason:n.z.string().nullish()})),object:n.z.literal(`chat.completion`),usage:Sf,citations:n.z.array(n.z.string().url()).nullish()}),wf=n.z.object({id:n.z.string().nullish(),created:n.z.number().nullish(),model:n.z.string().nullish(),choices:n.z.array(n.z.object({delta:n.z.object({role:n.z.enum([`assistant`]).optional(),content:n.z.string().nullish(),reasoning_content:n.z.string().nullish(),tool_calls:n.z.array(n.z.object({id:n.z.string(),type:n.z.literal(`function`),function:n.z.object({name:n.z.string(),arguments:n.z.string()})})).nullish()}),finish_reason:n.z.string().nullish(),index:n.z.number()})),usage:Sf.nullish(),citations:n.z.array(n.z.string().url()).nullish()}),Tf={errorSchema:vf,errorToMessage:e=>e.error.message};function Ef(e={}){var t;let n=Fn((t=e.baseURL)??`https://api.x.ai/v1`),r=()=>({Authorization:`Bearer ${Ze({apiKey:e.apiKey,environmentVariableName:`XAI_API_KEY`,description:`xAI API key`})}`,...e.headers}),i=t=>new xf(t,{provider:`xai.chat`,baseURL:n,headers:r,generateId:V,fetch:e.fetch}),a=t=>new sf(t,{provider:`xai.image`,url:({path:e})=>`${n}${e}`,headers:r,fetch:e.fetch,errorStructure:Tf}),o=e=>i(e);return o.languageModel=i,o.chat=i,o.textEmbeddingModel=e=>{throw new ye({modelId:e,modelType:`textEmbeddingModel`})},o.imageModel=a,o.image=a,o}var Df=Ef();function Of(e){if(!e.body)throw Error(`Response body is required`);let n=e.headers.get(t.StreamResponseFormatHeader);if(!n||n===`ui-message`)return e.body.pipeThrough(new TextDecoderStream).pipeThrough(new Re).pipeThrough(new TransformStream({async transform(e,t){if(e.data===`[DONE]`)return;let n=await pt({text:e.data});n.success?t.enqueue(n.value):t.error(n.error)}}));let r=e=>Hl({model:e,prompt:[{role:`user`,content:[{type:`text`,text:`Hello, world!`}]}]}).toUIMessageStream();switch(n){case`openai-chat`:return r(gi({apiKey:`ignored`,fetch:(t,n)=>e}).chat(`fake-model`));case`openai-response`:return r(gi({apiKey:`ignored`,fetch:(t,n)=>e}).responses(`fake-model`));case`anthropic`:return r(fd({apiKey:`ignored`,fetch:(t,n)=>e}).chat(`fake-model`));case`google`:return r(qd({apiKey:`ignored`,fetch:(t,n)=>e}).chat(`fake-model`));case`xai`:return r(Ef({apiKey:`ignored`,fetch:(t,n)=>e}).chat(`fake-model`));default:throw Error(`Unsupported response format: ${n}`)}}function kf(e){return new jf(e)}function Af(e){return new jf(`http://agent.local`,{fetch:async(t,n)=>e.fetch(new Request(t,n))})}var jf=class{baseUrl;fetch;constructor(e,t){this.baseUrl=e,this.fetch=t?.fetch??fetch}async sendMessages(e,t){return this.fetch(`${this.baseUrl}/sendMessages`,{method:`POST`,body:JSON.stringify(e),signal:t?.abortSignal})}};Object.defineProperty(exports,`AgentClient`,{enumerable:!0,get:function(){return jf}}),Object.defineProperty(exports,`convertResponseToUIMessageStream`,{enumerable:!0,get:function(){return Of}}),Object.defineProperty(exports,`createClient`,{enumerable:!0,get:function(){return kf}}),Object.defineProperty(exports,`createClientFromAgent`,{enumerable:!0,get:function(){return Af}});