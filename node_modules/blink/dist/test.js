import{__require as e,requireAsCommonJS as t}from"./node-Cu3BjO-f.js";import{createClientFromAgent as n}from"./client-C1l580Un.js";import"./api-Bl9kCFAZ.js";import{mkdir as r,readFile as i,stat as a}from"fs/promises";import{dirname as o,join as s,relative as c}from"path";async function l(e,{outdir:t}={}){t||=await d(e);let n=s(t,`agent.js`),r=m(),i=await r.build({...p,entryPoints:[e],outfile:n});if(i.errors.length>0)throw Error(`Failed to build agent!`);return{outfile:n}}async function u(e){let t=await f(e,`package.json`);if(!t)throw Error(`No package.json found in ${e}`);let n=JSON.parse(await i(t,`utf-8`)),r=n.main;if(!r)throw Error(`"main" is not set in ${c(process.cwd(),t)}. It should be set to the entrypoint of your agent.`);let l=s(o(t),r),u=await a(l);if(!u.isFile())throw Error(`${l} is not a file.`);return l}async function d(e){let t=await f(e,`node_modules`);if(!t){let t=await a(e);return t.isDirectory()?s(e,`.blink`):s(o(e),`.blink`)}let n=s(t,`.blink`);return await r(n,{recursive:!0}),n}async function f(e,t){let n=e;for(;n!==o(n);){let e=s(n,t);try{return await a(e),e}catch{}n=o(n)}}const p={bundle:!0,format:`cjs`,platform:`node`,target:`node18`,sourcemap:`inline`},m=()=>{try{return e(`esbuild`)}catch{throw Error("esbuild is not installed. Please install it with `bun add esbuild`.")}};async function h(e){let r=e?.entrypoint??await u(e?.cwd??process.cwd());if(!r)throw Error(`Unable to locate the entrypoint of the agent. Please specify it manually.`);let i;if(typeof Bun<`u`)i=t(r);else{let{outfile:e}=await l(r);i=t(e)}return n(i)}export{h as create};